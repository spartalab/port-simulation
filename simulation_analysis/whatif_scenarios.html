<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>simulation_analysis.whatif_scenarios API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
<!-- Mobile Menu Toggle -->
<div id="mobile-menu-toggle" style="
    display: none;
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1001;
    width: 40px;
    height: 40px;
    background: #2c3e50;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
">
    <div style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    ">
        <div class="hamburger-line" style="
            width: 24px;
            height: 3px;
            background: white;
            margin: 5px 0;
            transition: 0.3s;
        "></div>
        <div class="hamburger-line" style="
            width: 24px;
            height: 3px;
            background: white;
            margin: 5px 0;
            transition: 0.3s;
        "></div>
        <div class="hamburger-line" style="
            width: 24px;
            height: 3px;
            background: white;
            margin: 5px 0;
            transition: 0.3s;
        "></div>
    </div>
</div>

<!-- Overlay for mobile menu -->
<div id="mobile-overlay" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 999;
"></div>

<!-- Custom Navigation Start -->
<nav id="custom-sidebar" style="
    position: fixed;
    left: 0;
    top: 0;
    width: 260px;
    height: 100vh;
    background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
    color: white;
    overflow-y: auto;
    box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    z-index: 1000;
    transition: transform 0.3s ease;
">
    <!-- Close button for mobile -->
    <div id="mobile-close" style="
        display: none;
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        cursor: pointer;
        color: white;
        font-size: 24px;
        line-height: 30px;
        text-align: center;
    ">×</div>
    
    <div style="padding: 1.5rem; background: rgba(0,0,0,0.2); border-bottom: 2px solid #3498db;">
        <h2 style="margin: 0; font-size: 1.4rem; display: flex; align-items: center; gap: 0.5rem;">
            Modules
        </h2>
    </div>
    <div style="padding: 0.5rem 0;">

        <div style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <a href="../index.html" class="nav-link" style="
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.8rem 1rem;
                color: white;
                text-decoration: none;
                transition: background 0.2s;
                
            " onmouseover="this.style.background='rgba(52,152,219,0.2)'" 
               onmouseout="this.style.background=''">
                <span>🏠</span>
                <span>Overview</span>
            </a>
        </div>

        <div style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div onclick="toggleSection('Port_and_channel')" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.8rem 1rem;
                cursor: pointer;
                background: rgba(0,0,0,0.1);
                transition: background 0.2s;
            " onmouseover="this.style.background='rgba(52,152,219,0.2)'" 
               onmouseout="this.style.background='rgba(0,0,0,0.1)'">
                <span style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>🚢</span>
                    <span>Port and channel</span>
                </span>
                <span id="arrow_Port_and_channel" style="transition: transform 0.2s;">▶</span>
            </div>
            <div id="Port_and_channel" style="display: none; background: rgba(0,0,0,0.2);">

                <a href="../simulation_classes/port.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Port
                </a>

                <a href="../simulation_classes/channel.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Channel
                </a>

            </div>
        </div>

        <div style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div onclick="toggleSection('Terminal')" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.8rem 1rem;
                cursor: pointer;
                background: rgba(0,0,0,0.1);
                transition: background 0.2s;
            " onmouseover="this.style.background='rgba(52,152,219,0.2)'" 
               onmouseout="this.style.background='rgba(0,0,0,0.1)'">
                <span style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>🏗</span>
                    <span>Terminal</span>
                </span>
                <span id="arrow_Terminal" style="transition: transform 0.2s;">▶</span>
            </div>
            <div id="Terminal" style="display: none; background: rgba(0,0,0,0.2);">

                <a href="../simulation_classes/terminal_container.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Container
                </a>

                <a href="../simulation_classes/terminal_drybulk.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Dry bulk
                </a>

                <a href="../simulation_classes/terminal_liquid.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Liquid
                </a>

            </div>
        </div>

        <div style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div onclick="toggleSection('Landside')" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.8rem 1rem;
                cursor: pointer;
                background: rgba(0,0,0,0.1);
                transition: background 0.2s;
            " onmouseover="this.style.background='rgba(52,152,219,0.2)'" 
               onmouseout="this.style.background='rgba(0,0,0,0.1)'">
                <span style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>🚛</span>
                    <span>Landside</span>
                </span>
                <span id="arrow_Landside" style="transition: transform 0.2s;">▶</span>
            </div>
            <div id="Landside" style="display: none; background: rgba(0,0,0,0.2);">

                <a href="../simulation_classes/truck.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Truck
                </a>

                <a href="../simulation_classes/train.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Train
                </a>

                <a href="../simulation_classes/pipeline.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Pipeline
                </a>

            </div>
        </div>

        <div style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div onclick="toggleSection('Simulation_helpers')" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.8rem 1rem;
                cursor: pointer;
                background: rgba(0,0,0,0.1);
                transition: background 0.2s;
            " onmouseover="this.style.background='rgba(52,152,219,0.2)'" 
               onmouseout="this.style.background='rgba(0,0,0,0.1)'">
                <span style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>⚙️</span>
                    <span>Simulation helpers</span>
                </span>
                <span id="arrow_Simulation_helpers" style="transition: transform 0.2s;">▶</span>
            </div>
            <div id="Simulation_helpers" style="display: none; background: rgba(0,0,0,0.2);">

                <a href="../simulation_handler/run_simulation.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Run
                </a>

                <a href="../simulation_handler/generators.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Generators
                </a>

                <a href="../simulation_handler/helpers.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Helpers
                </a>

                <a href="../simulation_handler/preprocess.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Preprocess
                </a>

            </div>
        </div>

        <div style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div onclick="toggleSection('Analysis')" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.8rem 1rem;
                cursor: pointer;
                background: rgba(0,0,0,0.1);
                transition: background 0.2s;
            " onmouseover="this.style.background='rgba(52,152,219,0.2)'" 
               onmouseout="this.style.background='rgba(0,0,0,0.1)'">
                <span style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>📊</span>
                    <span>Analysis</span>
                </span>
                <span id="arrow_Analysis" style="transition: transform 0.2s;">▶</span>
            </div>
            <div id="Analysis" style="display: none; background: rgba(0,0,0,0.2);">

                <a href="../simulation_analysis/capacity.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Capacity
                </a>

                <a href="../simulation_analysis/resource_utilization.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Utilization
                </a>

                <a href="../simulation_analysis/results.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Results
                </a>

                <a href="../simulation_analysis/collate_results.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background=''; this.style.paddingLeft='2.5rem'">
                    Collate
                </a>

                <a href="../simulation_analysis/whatif_scenarios.html" class="nav-link" style="
                    display: block;
                    padding: 0.6rem 1rem 0.6rem 2.5rem;
                    color: rgba(255,255,255,0.9);
                    text-decoration: none;
                    transition: all 0.2s;
                    background: rgba(52, 152, 219, 0.4); font-weight: bold;
                " onmouseover="this.style.background='rgba(52,152,219,0.3)'; this.style.paddingLeft='2.7rem'" 
                   onmouseout="this.style.background='background: rgba(52, 152, 219, 0.4); font-weight: bold;'; this.style.paddingLeft='2.5rem'">
                    What-If
                </a>

            </div>
        </div>

    </div>
</nav>
<!-- Custom Navigation End -->

<script>
function toggleSection(sectionId) {
    var section = document.getElementById(sectionId);
    var arrow = document.getElementById('arrow_' + sectionId);
    if (section.style.display === 'none' || section.style.display === '') {
        section.style.display = 'block';
        arrow.style.transform = 'rotate(90deg)';
    } else {
        section.style.display = 'none';
        arrow.style.transform = 'rotate(0deg)';
    }
}

// Mobile menu functionality
function initMobileMenu() {
    var sidebar = document.getElementById('custom-sidebar');
    var menuToggle = document.getElementById('mobile-menu-toggle');
    var overlay = document.getElementById('mobile-overlay');
    var closeBtn = document.getElementById('mobile-close');
    
    // Toggle menu
    if (menuToggle) {
        menuToggle.addEventListener('click', function() {
            sidebar.style.transform = 'translateX(0)';
            overlay.style.display = 'block';
        });
    }
    
    // Close menu functions
    function closeMenu() {
        sidebar.style.transform = 'translateX(-100%)';
        overlay.style.display = 'none';
    }
    
    if (overlay) {
        overlay.addEventListener('click', closeMenu);
    }
    
    if (closeBtn) {
        closeBtn.addEventListener('click', closeMenu);
    }
    
    // Close menu when clicking on a link (mobile only)
    if (window.innerWidth <= 768) {
        var navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(function(link) {
            link.addEventListener('click', function() {
                setTimeout(closeMenu, 100);
            });
        });
    }
}

// Auto-expand active section
document.addEventListener('DOMContentLoaded', function() {
    // Hide original pdoc navigation
    var originalNav = document.querySelector('body > nav');
    if (originalNav) {
        originalNav.style.display = 'none';
    }
    
    // Adjust main content margin
    var mainContent = document.querySelector('main');
    if (mainContent) {
        mainContent.style.marginLeft = '260px';
        mainContent.style.padding = '2rem';
    }
    
    // Auto-expand sections with active items
    var activeLinks = document.querySelectorAll('a[style*="background: rgba(52, 152, 219, 0.4)"]');
    activeLinks.forEach(function(link) {
        var parentSection = link.parentElement;
        if (parentSection && parentSection.id) {
            parentSection.style.display = 'block';
            var arrow = document.getElementById('arrow_' + parentSection.id);
            if (arrow) {
                arrow.style.transform = 'rotate(90deg)';
            }
        }
    });
    
    // Initialize mobile menu
    initMobileMenu();
    
    // Check if mobile on load
    checkMobile();
});

// Check if mobile and adjust styles
function checkMobile() {
    var sidebar = document.getElementById('custom-sidebar');
    var menuToggle = document.getElementById('mobile-menu-toggle');
    var closeBtn = document.getElementById('mobile-close');
    var mainContent = document.querySelector('main');
    
    if (window.innerWidth <= 768) {
        // Mobile view
        if (sidebar) sidebar.style.transform = 'translateX(-100%)';
        if (menuToggle) menuToggle.style.display = 'block';
        if (closeBtn) closeBtn.style.display = 'block';
        if (mainContent) {
            mainContent.style.marginLeft = '0';
            mainContent.style.padding = '60px 1rem 1rem 1rem';
        }
    } else {
        // Desktop view
        if (sidebar) sidebar.style.transform = 'translateX(0)';
        if (menuToggle) menuToggle.style.display = 'none';
        if (closeBtn) closeBtn.style.display = 'none';
        if (mainContent) {
            mainContent.style.marginLeft = '260px';
            mainContent.style.padding = '2rem';
        }
    }
}

// Listen for window resize
window.addEventListener('resize', checkMobile);
</script>

<style>
/* Additional styles to ensure visibility */
body {
    margin: 0;
    padding: 0;
}

/* Hide pdoc nav */
body > nav.pdoc,
nav.pdoc {
    display: none !important;
}

/* Ensure main content has proper margin and text wrapping */
main.pdoc,
main {
    margin-left: 260px !important;
    padding: 2rem !important;
    max-width: 100%;
    overflow-x: hidden;
}

/* Fix text wrapping for all content */
main * {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

/* Fix code blocks to wrap properly */
pre {
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
    overflow-x: auto !important;
    max-width: 100% !important;
}

code {
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
}

/* Fix tables to be responsive */
table {
    display: block;
    overflow-x: auto;
    max-width: 100%;
}

/* Ensure custom sidebar is visible */
#custom-sidebar {
    display: block !important;
    visibility: visible !important;
}

/* Mobile responsive styles */
@media (max-width: 768px) {
    #custom-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    #mobile-menu-toggle {
        display: block !important;
    }
    
    #mobile-close {
        display: block !important;
    }
    
    main.pdoc,
    main {
        margin-left: 0 !important;
        padding: 60px 1rem 1rem 1rem !important;
    }
    
    /* Ensure content fits on mobile */
    main {
        width: 100%;
        box-sizing: border-box;
    }
    
    /* Fix wide elements on mobile */
    img, video, iframe {
        max-width: 100%;
        height: auto;
    }
    
    /* Adjust font size for better mobile reading */
    body {
        font-size: 14px;
    }
    
    /* Fix code blocks on mobile */
    pre {
        padding: 0.5rem;
        font-size: 12px;
    }
}

/* Tablet responsive */
@media (min-width: 769px) and (max-width: 1024px) {
    main.pdoc,
    main {
        margin-left: 260px !important;
        padding: 1.5rem !important;
    }
}

/* Animation for hamburger menu */
#mobile-menu-toggle:active .hamburger-line {
    background: #3498db;
}
</style>

    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../simulation_analysis.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;simulation_analysis</a>

            <img src="spartaStacked.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#reduce_cranes">reduce_cranes</a>
            </li>
            <li>
                    <a class="function" href="#reduce_pipelines">reduce_pipelines</a>
            </li>
            <li>
                    <a class="function" href="#reduce_conveyors">reduce_conveyors</a>
            </li>
            <li>
                    <a class="function" href="#reduce_berths">reduce_berths</a>
            </li>
            <li>
                    <a class="function" href="#reduce_yard">reduce_yard</a>
            </li>
            <li>
                    <a class="function" href="#reduce_tank_capacity">reduce_tank_capacity</a>
            </li>
            <li>
                    <a class="function" href="#reduce_silo_capacity">reduce_silo_capacity</a>
            </li>
            <li>
                    <a class="function" href="#reduce_bay_capacity">reduce_bay_capacity</a>
            </li>
            <li>
                    <a class="function" href="#reduce_chassis">reduce_chassis</a>
            </li>
            <li>
                    <a class="function" href="#reduce_truck_gates">reduce_truck_gates</a>
            </li>
            <li>
                    <a class="function" href="#adjust_arrival_rate">adjust_arrival_rate</a>
            </li>
            <li>
                    <a class="function" href="#stop_and_bulk_arrival">stop_and_bulk_arrival</a>
            </li>
            <li>
                    <a class="function" href="#filter_data_by_arrival_rate">filter_data_by_arrival_rate</a>
            </li>
            <li>
                    <a class="function" href="#filter_truck_data">filter_truck_data</a>
            </li>
            <li>
                    <a class="function" href="#filter_train_data">filter_train_data</a>
            </li>
            <li>
                    <a class="function" href="#model_hurricane">model_hurricane</a>
            </li>
            <li>
                    <a class="function" href="#disruption_report_smoothed">disruption_report_smoothed</a>
            </li>
            <li>
                    <a class="function" href="#fog_peak_slopes">fog_peak_slopes</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../simulation_analysis.html">simulation_analysis</a><wbr>.whatif_scenarios    </h1>

                        <div class="docstring"><p>This module contains functions to model disruptions in a port simulation environment.</p>
</div>

                        <input id="mod-whatif_scenarios-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-whatif_scenarios-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">This module contains functions to model disruptions in a port simulation environment.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">simulation_classes.port</span><span class="w"> </span><span class="kn">import</span> <span class="n">Crane</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">Conveyor</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">simulation_handler.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_value_by_terminal</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">SEVERE_HURRICANE</span><span class="p">,</span> <span class="n">TROPICAL_STORM</span><span class="p">,</span> <span class="n">HURRICANE_START</span><span class="p">,</span> <span class="n">WARMUP_ITERS</span><span class="p">,</span> <span class="n">NUM_MONTHS</span><span class="p">,</span> <span class="n">NUM_RUNS</span><span class="p">,</span> <span class="n">LOG_NUM</span><span class="p">,</span> <span class="n">INBOUND_CLOSED</span><span class="p">,</span> <span class="n">OUTBOUND_CLOSED</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="n">berths_aff_per</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">    This function reduces the number of cranes in each berth by `change` amount by removing cranes from the berth&#39;s crane store between `time_start` and `time_end`.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">    It also restores the cranes after the reduction period.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">    Args:</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">        change (int): The number of cranes to be removed (negative value) or added (positive value).</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">        terminals (list): List of terminal indices where the cranes will be reduced.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        port_berths_container_terminals (dict): Dictionary containing berth information for container terminals.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">        terminal_data_cache (dict): Cache containing terminal data for crane transfer rates.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">        berths_aff_per (float): Percentage of berths to be affected by the change.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">    Returns:</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">        None</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="n">port_berth_initially</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>        <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>        <span class="k">for</span> <span class="n">berths</span> <span class="ow">in</span> <span class="n">port_berths_container_terminals</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>            <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berths</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> cranes from each berth in terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>                <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">))</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>                    <span class="k">if</span> <span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>                        <span class="n">crane</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>                <span class="k">break</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>                    <span class="n">restored_crane</span> <span class="o">=</span> <span class="n">Crane</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;restored_</span><span class="si">{</span><span class="n">berth</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="n">crane_transfer_rate</span><span class="o">=</span><span class="n">get_value_by_terminal</span><span class="p">(</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>                        <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="s1">&#39;Container&#39;</span><span class="p">,</span> <span class="n">terminal_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;transfer rate per unit&#39;</span><span class="p">))</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>                    <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">restored_crane</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>                <span class="k">break</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="n">berths_aff_per</span><span class="p">):</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">    This function reduces the number of pipelines in each berth by `change` amount by removing pipelines from the berth&#39;s pipeline store between `time_start` and `time_end`.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">    It also restores the pipelines after the reduction period.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">    Args:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        change (int): The number of pipelines to be removed (negative value) or added (positive value).</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">        terminals (list): List of terminal indices where the pipelines will be reduced.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">        port_berth_liquid_terminals (dict): Dictionary containing berth information for liquid terminals.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">        terminal_data_cache (dict): Cache containing terminal data for pipeline transfer rates.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">        berths_aff_per (float): Percentage of berths to be affected by the change.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">    Returns:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        None</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="n">port_berth_initially</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    <span class="k">for</span> <span class="n">terminal_ids</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="n">terminal_idx</span> <span class="o">=</span> <span class="n">terminal_ids</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="k">for</span> <span class="n">berths</span> <span class="ow">in</span> <span class="n">port_berth_liquid_terminals</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berths</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> pipelines from each berth in terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    <span class="k">for</span> <span class="n">terminal_ids</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="n">terminal_idx</span> <span class="o">=</span> <span class="n">terminal_ids</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>                <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">))</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>                    <span class="k">if</span> <span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>                        <span class="n">pipeline</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>                <span class="k">break</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>    <span class="k">for</span> <span class="n">terminal_ids</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="n">terminal_idx</span> <span class="o">=</span> <span class="n">terminal_ids</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>                    <span class="n">restored_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;restored_</span><span class="si">{</span><span class="n">berth</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pump_rate_per_pipeline</span><span class="o">=</span><span class="n">get_value_by_terminal</span><span class="p">(</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>                        <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="s2">&quot;Liquid&quot;</span><span class="p">,</span> <span class="n">terminal_ids</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;transfer rate per unit&quot;</span><span class="p">))</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>                    <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">restored_pipeline</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>                <span class="k">break</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="n">berths_aff_per</span><span class="p">):</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">    This function reduces the number of conveyors in each berth by `change` amount by removing conveyors from the berth&#39;s conveyor store between `time_start` and `time_end`.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">    It also restores the conveyors after the reduction period.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">    Args:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        change (int): The number of conveyors to be removed (negative value) or added (positive value).</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        terminals (list): List of terminal indices where the conveyors will be reduced.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">        time_end (int): The time at which the reduction ends.   </span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        port_berth_drybulk_terminals (dict): Dictionary containing berth information for dry bulk terminals.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        terminal_data_cache (dict): Cache containing terminal data for conveyor transfer rates.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        berths_aff_per (float): Percentage of berths to be affected by the change.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">    Returns:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        None</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="n">port_berth_initially</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>        <span class="k">for</span> <span class="n">berths</span> <span class="ow">in</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berths</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> conveyor from each berth in terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>                <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">))</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>                    <span class="k">if</span> <span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>                        <span class="n">conveyor</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>                <span class="k">break</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                    <span class="n">restored_conveyor</span> <span class="o">=</span> <span class="n">Conveyor</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;restored_</span><span class="si">{</span><span class="n">berth</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">conveyor_rate_per_conveyor</span><span class="o">=</span><span class="n">get_value_by_terminal</span><span class="p">(</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                        <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="s2">&quot;DryBulk&quot;</span><span class="p">,</span> <span class="n">terminal_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;transfer rate per unit&quot;</span><span class="p">))</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>                    <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">restored_conveyor</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                <span class="k">break</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_berths</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berths_terminal</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">    This function reduces the number of berths in each terminal by `change` amount by removing berths from the terminal&#39;s berth store between `time_start` and `time_end`.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">    It also restores the berths after the reduction period.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">    Args:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">        change (int): The number of berths to be removed (negative value) or added (positive value).</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        terminals (list): List of terminal indices where the berths will be reduced.        </span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">        port_berths_terminal (dict): Dictionary containing berth information for the terminals.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">    Returns:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        None</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> berths from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>    <span class="n">removed_berths</span> <span class="o">=</span> <span class="p">{</span><span class="n">terminal</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">}</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>    <span class="c1"># Reduce capacity by taking items out of the store</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>            <span class="c1"># Remove a berth to simulate reduced capacity</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>            <span class="n">berth</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">port_berths_terminal</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="n">removed_berths</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berth</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Berth capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>    <span class="c1"># Restore the removed berths to the store</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">removed_berths</span><span class="p">[</span><span class="n">terminal</span><span class="p">]:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>            <span class="k">yield</span> <span class="n">port_berths_terminal</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">berth</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Berth Capacity restored by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_yard</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_yard_container_terminals</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">    This function reduces the yard capacity in each terminal by `change` amount by adding dummy containers to the terminal&#39;s yard store between `time_start` and `time_end`.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">    It also restores the yard capacity after the reduction period.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">    Args:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        change (int): The number of yard spaces to be removed (negative value) or added (positive value).</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        terminals (list): List of terminal indices where the yard capacity will be reduced.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        port_yard_container_terminals (dict): Dictionary containing yard information for the terminals.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">    Returns:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        None&quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> units yard space from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2"> (Adding dummy containers)&quot;</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="n">dummy_containers</span> <span class="o">=</span> <span class="p">{</span><span class="n">terminal</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">}</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="n">ctr</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">port_yard_container_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="n">dummy_containers</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctr</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Yard capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> ctrs at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="c1"># Restore the removed berths to the store</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">dummy_containers</span><span class="p">[</span><span class="n">terminal</span><span class="p">]:</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>            <span class="k">yield</span> <span class="n">dummy_containers</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">berth</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Yard apacity restored by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_tank_capacity</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">):</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">    This function reduces the tank capacity in each terminal by `change` amount by adding dummy liquid to the terminal&#39;s tank store between `time_start` and `time_end`.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">    It also restores the tank capacity after the reduction period.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">    Args:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">        change (int): The number of tank spaces to be removed (negative value) or added (positive value).</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">        terminals (list): List of terminal indices where the tank capacity will be reduced.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">        port_tanks_liquid_terminals (dict): Dictionary containing tank information for the terminals.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">    Returns:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">        None</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> units tank space from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2"> (Adding dummy liquid)&quot;</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>    <span class="c1"># Reduce the content of the tanks</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="k">yield</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Tank capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="c1"># Restore the content of the tanks</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="k">yield</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Tank capacity effectively increased by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_silo_capacity</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">):</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">    This function reduces the silo capacity in each terminal by `change` amount by adding dummy dry bulk to the terminal&#39;s silo store between `time_start` and `time_end`.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">    It also restores the silo capacity after the reduction period.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">    Args:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        change (int): The number of silo spaces to be removed (negative value) or added (positive value).</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        terminals (list): List of terminal indices where the silo capacity will be reduced.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        port_silos_drybulk_terminals (dict): Dictionary containing silo information for the terminals.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">    Returns:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">        None</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> units silo space from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2"> (Adding dummy dry bulk)&quot;</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>    <span class="c1"># Reduce the content of the silos</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="k">yield</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Silo capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>    <span class="c1"># Restore the content of the silos</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="k">yield</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Silo capacity effectively increased by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_bay_capacity</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">reduction</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">port_loading_bays_liquid_terminals</span><span class="p">):</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">    This function reduces the bay capacity in each terminal by `reduction` amount by holding requests for bays in the terminal&#39;s bay store between `start_time` and `end_time`.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">    It also restores the bay capacity after the reduction period.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">    Args:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        reduction (int): The number of bays to be removed (negative value) or added (positive value).</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        terminals (list): List of terminal indices where the bay capacity will be reduced.</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        start_time (int): The time at which the reduction starts.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        end_time (int): The time at which the reduction ends.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        port_loading_bays_liquid_terminals (dict): Dictionary containing bay information for the terminals.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">    Returns:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">        None</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> bays from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>    <span class="c1"># Request `reduction` number of bays to reduce the effective capacity</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>    <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reduction</span><span class="p">):</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">port_loading_bays_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="k">yield</span> <span class="n">request</span>  <span class="c1"># Hold this request to reduce availability</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>            <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">terminal</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> units of bays removed from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>    <span class="c1"># Release the requests to restore full capacity</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="k">for</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="n">port_loading_bays_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> units of bays restored from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_chassis</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_chassis_container_terminals</span><span class="p">):</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">    This function reduces the chassis capacity in each terminal by `change` amount by removing chassis from the terminal&#39;s chassis store between `time_start` and `time_end`.</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">    It also restores the chassis capacity after the reduction period.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">    Args:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">        change (int): The number of chassis to be removed (negative value) or added (positive value).</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">        terminals (list): List of terminal indices where the chassis capacity will be reduced.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">        port_chassis_container_terminals (dict): Dictionary containing chassis information for the terminals.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">    Returns:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        None</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> chassis from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="c1"># Reduce the content of the silos</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="k">yield</span> <span class="n">port_chassis_container_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Number of chassis reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>    <span class="c1"># Restore the content of the silos</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="k">yield</span> <span class="n">port_chassis_container_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Number of chassis increased by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_truck_gates</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">reduction</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">truck_gates</span><span class="p">):</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">    This function reduces the truck gate capacity in each terminal by `reduction` amount by holding requests for truck gates in the terminal&#39;s truck gate store between `start_time` and `end_time`.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">    It also restores the truck gate capacity after the reduction period.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">    Args:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">        reduction (int): The number of truck gates to be removed (negative value) or added (positive value).</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        terminals (list): List of terminal indices where the truck gate capacity will be reduced.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">        start_time (int): The time at which the reduction starts.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">        end_time (int): The time at which the reduction ends.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        truck_gates (dict): Dictionary containing truck gate information for the terminals.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">    Returns:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        None</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> truck gates from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>    <span class="c1"># Request `reduction` number of bays to reduce the effective capacity</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>    <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reduction</span><span class="p">):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">truck_gates</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="k">yield</span> <span class="n">request</span>  <span class="c1"># Hold this request to reduce availability</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>            <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">terminal</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> truck gates removed from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>    <span class="c1"># Release the requests to restore full capacity</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="k">for</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">truck_gates</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> truck gates restored from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="k">def</span><span class="w"> </span><span class="nf">adjust_arrival_rate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">rate_parameter</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">    This function adjusts the arrival times of ships in the ship data CSV file by a given rate parameter.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">    It modifies the arrival times of ships that fall within the specified time range and saves the updated data back to the CSV file.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">    Args:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">        start_time (float): The start time of the range to adjust arrival times.</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">        end_time (float): The end time of the range to adjust arrival times.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        rate_parameter (float): The factor by which to adjust the arrival times.</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">        run_id (str): The unique identifier for the simulation run.</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        plot_input (bool): Whether to plot the input data before and after adjustment.</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">    returns:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        ship_data_df (pd.DataFrame): The updated ship data DataFrame with adjusted arrival times.</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">        ship_data (dict): The updated ship data as a dictionary.</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>    <span class="n">ship_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/logs/ship_data.csv&quot;</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>    <span class="n">in_time_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>    <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>    <span class="n">ship_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_time_range</span><span class="p">,</span> <span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">rate_parameter</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="n">ship_data_df</span> <span class="o">=</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interarrival&#39;</span><span class="p">])</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>    <span class="n">ship_data_df</span> <span class="o">=</span> <span class="n">ship_data_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;arrival&#39;</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>    <span class="n">output_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/ship_data.csv&#39;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>    <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>    <span class="n">ship_data</span> <span class="o">=</span> <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="k">if</span> <span class="n">plot_input</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">],</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                     <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Old Arrival Times&#39;</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;New Arrival Times&#39;</span><span class="p">)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="n">min_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/plots/scenarios/factor_arrival_scnario_input&quot;</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>    <span class="k">return</span> <span class="n">ship_data_df</span><span class="p">,</span> <span class="n">ship_data</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="k">def</span><span class="w"> </span><span class="nf">stop_and_bulk_arrival</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">    This function modifies the ship arrival times in the ship data CSV file by stopping arrivals between `start_time` and `end_time`.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">    It also simulates a bulk arrival scenario after `end_time` by distributing the arrivals evenly over a recovery period.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="sd">    Args:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        start_time (float): The start time of the range to stop arrivals.</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">        end_time (float): The end time of the range to stop arrivals.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">        run_id (str): The unique identifier for the simulation run.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">        plot_input (bool): Whether to plot the input data before and after adjustment.</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">    returns:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">        ship_data_df (pd.DataFrame): The updated ship data DataFrame with adjusted arrival times.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">        ship_data_dict (dict): The updated ship data as a dictionary.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="n">ship_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/ship_data.csv&#39;</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>    <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>    <span class="n">in_time_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>    <span class="n">num_ships</span> <span class="o">=</span> <span class="n">in_time_range</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>    <span class="n">recovery_period</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">5</span>  <span class="c1"># 5 days</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>    <span class="n">gap</span> <span class="o">=</span> <span class="n">recovery_period</span><span class="o">/</span><span class="n">num_ships</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Stopping arrivals between </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2"> and bulk arrivals after </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2"> with a gap of </span><span class="si">{</span><span class="n">gap</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>    <span class="n">bulk_arrival_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">+</span> <span class="mf">0.1</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>    <span class="n">ship_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_time_range</span><span class="p">,</span> <span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="n">bulk_arrival_time</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">gap</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">in_time_range</span><span class="o">.</span><span class="n">sum</span><span class="p">())]</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="k">if</span> <span class="s1">&#39;interarrival&#39;</span> <span class="ow">in</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="n">ship_data</span> <span class="o">=</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interarrival&#39;</span><span class="p">])</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>    <span class="n">ship_data_df</span> <span class="o">=</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;arrival&#39;</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="n">output_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/ship_data.csv&#39;</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="n">ship_data_dict</span> <span class="o">=</span> <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>    <span class="k">if</span> <span class="n">plot_input</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">],</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>                     <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Old Arrival Times&#39;</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;New Arrival Times&#39;</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="n">min_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/plots/scenarios/bulk_arrival_scenario_input&quot;</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="k">return</span> <span class="n">ship_data_df</span><span class="p">,</span> <span class="n">ship_data_dict</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_data_by_arrival_rate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">,</span> <span class="n">time_column</span><span class="p">):</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">    Filter data based on arrival rate factors for different time periods.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">    </span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">    Parameters:</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">    -----------</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">    data : pd.DataFrame</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">        The dataframe to filter (truck_data or train_data)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">    time_arrival_dict : dict</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">        Dictionary with (start_time, end_time): arrival_rate_factor</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        e.g., {(6.0, 10.0): 0.8, (10.0, 15.0): 0.6}</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        arrival_rate_factor of 0.8 means keep 80% of data (remove 20%)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">    time_column : str</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">        Name of the time column to use for filtering</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        (&#39;arrival_time&#39; for trucks, &#39;arrival at&#39; for trains)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">    </span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">    Returns:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">    --------</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">    pd.DataFrame</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">        Filtered dataframe with specified removal rates applied</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>    
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>    <span class="c1"># Create a copy to avoid modifying original data</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>    
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>    <span class="c1"># Track which rows to keep</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>    <span class="c1"># keep_mask = pd.Series([True] * len(filtered_data))</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>    <span class="n">keep_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">filtered_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>    
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">),</span> <span class="n">arrival_rate_factor</span> <span class="ow">in</span> <span class="n">time_arrival_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="c1"># Find rows in this time window</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="n">time_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="n">rows_in_window</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">time_mask</span><span class="p">]</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows_in_window</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="k">continue</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="c1"># Calculate how many rows to remove</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="n">removal_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">arrival_rate_factor</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_in_window</span><span class="p">)</span> <span class="o">*</span> <span class="n">removal_rate</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="k">if</span> <span class="n">num_to_remove</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>            <span class="c1"># Get indices of rows in this window</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>            <span class="n">window_indices</span> <span class="o">=</span> <span class="n">rows_in_window</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>            
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>            <span class="c1"># Create equispaced removal indices</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="c1"># We remove equispaced samples to maintain temporal distribution</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="n">removal_step</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_indices</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_to_remove</span> <span class="k">if</span> <span class="n">num_to_remove</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_indices</span><span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="n">removal_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                <span class="n">idx_position</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">removal_step</span><span class="p">)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                <span class="k">if</span> <span class="n">idx_position</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_indices</span><span class="p">):</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                    <span class="n">removal_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">window_indices</span><span class="p">[</span><span class="n">idx_position</span><span class="p">])</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>            
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>            <span class="c1"># Mark these indices for removal</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>            <span class="n">keep_mask</span><span class="p">[</span><span class="n">removal_indices</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>    
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>    <span class="c1"># Apply the filter</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>    
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>    <span class="k">return</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_truck_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">):</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">    Filter truck data based on arrival rate factors.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">    </span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">    Parameters:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">    -----------</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">    run_id : str</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        Unique identifier for the simulation run</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">    time_arrival_dict : dict</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        Dictionary with (start_time, end_time): arrival_rate_factor</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">    </span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">    Returns:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">    --------</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">    pd.DataFrame</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        Filtered truck dataframe</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>    <span class="n">truck_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/truck_data.pkl&#39;</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>    <span class="n">updated_truck_data_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/truck_data.pkl&#39;</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">truck_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="n">filtered_truck_data</span> <span class="o">=</span> <span class="n">filter_data_by_arrival_rate</span><span class="p">(</span><span class="n">truck_data</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">,</span> <span class="s1">&#39;arrival&#39;</span><span class="p">)</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>    <span class="n">filtered_truck_data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">updated_truck_data_path</span><span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>    <span class="k">return</span> <span class="n">filtered_truck_data</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_train_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">):</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">    Filter train data based on arrival rate factors.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">    </span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">    Parameters:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">    -----------</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">    run_id : str</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        Unique identifier for the simulation run</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">    time_arrival_dict : dict</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">        Dictionary with (start_time, end_time): arrival_rate_factor</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">    </span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">    Returns:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">    --------</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">    pd.DataFrame</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        Filtered train dataframe</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="n">train_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/train_data.csv&#39;</span><span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>    <span class="n">updated_train_data_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/train_data.csv&#39;</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>    <span class="n">filtered_train_data</span> <span class="o">=</span> <span class="n">filter_data_by_arrival_rate</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">,</span> <span class="s1">&#39;arrival at&#39;</span><span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>    <span class="n">filtered_train_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">updated_train_data_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>    <span class="k">return</span> <span class="n">filtered_train_data</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_hurricane</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">terminal_resouces</span><span class="p">,</span> <span class="n">num_terminals_list</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">    This function models a hurricane scenario by reducing the number of berths, cranes, pipelines, and conveyors in the port terminals.</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">    It simulates the disruption by adjusting the resources available in the terminals between specified time periods.</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">    Specificcally, the following changes are made:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">    - Reduces the number of berths in all container terminals by 1 from time 1165 to 2004.</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">    - Reduces the number of berths in 10% of liquid and dry bulk terminals by 1 from time 1165 to 2004.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">    - Reduces the number of cranes in all container terminals by 1 from time 1165 to 2340.</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">    - Reduces the number of pipelines in 25% of liquid terminals by 1 from time 1165 to 2340.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">    - Reduces the number of conveyors in 25% of dry bulk terminals by 1 from time 1165 to 2340.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">    Args:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">        terminal_resouces (tuple): A tuple containing the resources for the port terminals.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">        num_terminals_list (list): A list containing the number of container, liquid, and dry bulk terminals.</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">        terminal_data (dict): A dictionary containing terminal data for crane transfer rates.</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">        run_id (str): The unique identifier for the simulation run.</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">        seed (int): The random seed for reproducibility.</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">    returns:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">        None</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>    <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">port_yard_container_terminals</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">,</span> \
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">,</span> <span class="n">port_loading_bays_liquid_terminals</span><span class="p">,</span> <span class="n">port_drybulk_bays_drybulk_terminals</span><span class="p">,</span> \
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>        <span class="n">port_chassis_container_terminals</span><span class="p">,</span> <span class="n">truck_gates_ctr</span><span class="p">,</span> <span class="n">truck_gates_liquid</span><span class="p">,</span> <span class="n">truck_gates_dk</span><span class="p">,</span> <span class="n">train_loading_racks_ctr</span><span class="p">,</span> <span class="n">train_loading_racks_liquid</span><span class="p">,</span> \
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="n">train_loading_racks_dk</span><span class="p">,</span> <span class="n">day_pilots</span><span class="p">,</span> <span class="n">night_pilots</span><span class="p">,</span> <span class="n">tugboats</span><span class="p">,</span> <span class="n">channel_scheduler</span> <span class="o">=</span> <span class="n">terminal_resouces</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>    <span class="n">num_container_terminals</span><span class="p">,</span> <span class="n">num_liquid_terminals</span><span class="p">,</span> <span class="n">num_drybulk_terminals</span> <span class="o">=</span> <span class="n">num_terminals_list</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>    <span class="k">if</span> <span class="n">SEVERE_HURRICANE</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">TROPICAL_STORM</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="c1"># stop all arrivals between 1500 and 1665</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="n">time_start</span> <span class="o">=</span> <span class="n">HURRICANE_START</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>        <span class="n">disruption_duration</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">6</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="c1"># No arrivals for 6 days</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>        <span class="n">stop_and_bulk_arrival</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 7 days better</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="c1"># recovery periods</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="n">time_end_1_week</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="c1"># 7 days</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>        <span class="n">time_end_2_week</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="c1"># 7 days</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="n">time_end_3_weeks</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">14</span> <span class="c1"># 14 days</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="n">time_end_4_weeks</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">21</span> <span class="c1"># 21 days</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>         <span class="c1"># For 1st week, 100% of berths have one crane down, 25% of liquid and dry bulk terminals have one pipeline and conveyor down in 50% of berths</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                    <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="n">selected_liquid_terminals</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">num_liquid_terminals</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">num_liquid_terminals</span><span class="p">))</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="n">selected_drybulk_terminals</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">num_drybulk_terminals</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">num_drybulk_terminals</span><span class="p">))</span> 
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>                    <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                    <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="c1"># For 1st week, 100% of berths have one crane down, 25% of liquid and dry bulk terminals have one pipeline and conveyor down in 50% of berths</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                    <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>                    <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>                    <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="c1"># For 2nd week, 25% of berths have one crane down, 25% of (same) liquid and dry bulk terminals have one pipeline and conveyor down in 25% of berths</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>                    <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>                    <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>                    <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="c1"># For 3rd week, 10% of berths have one crane down, 25% of (same) liquid and dry bulk terminals have one pipeline and conveyor down in 10% of berths</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                    <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                    <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                    <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="c1"># For 4th week, 10% of berths have one crane down, 25% of (same) liquid and dry bulk terminals have one pipeline and conveyor down in 10% of berths</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="c1"># env.process(reduce_cranes(env, -1, list(range(num_container_terminals)),</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="c1">#             time_end_3_weeks, time_end_1_month, port_berths_container_terminals, terminal_data, 0.1))</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="c1"># env.process(reduce_pipelines(env, -1, selected_liquid_terminals,</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="c1">#             time_end_3_weeks, time_end_1_month, port_berth_liquid_terminals, terminal_data, 0.1))</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="c1"># env.process(reduce_conveyors(env, -1, selected_drybulk_terminals,</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="c1">#             time_end_3_weeks, time_end_1_month, port_berth_drybulk_terminals, terminal_data, 0.1))</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="c1"># for the first week only 50% of trucks/trains arrive and for the second week only 80% of trucks/trains arrive</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="n">truck_time_arrival_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c1"># no trucks during hurricane</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="p">(</span><span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">):</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="p">(</span><span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">):</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="p">(</span><span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">):</span> <span class="mf">0.5</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="p">}</span>   
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="n">train_time_arrival_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c1"># no trains during hurricane</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="p">(</span><span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="p">(</span><span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">):</span> <span class="mf">0.5</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="p">}</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="n">filter_truck_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">truck_time_arrival_dict</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="n">filter_train_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">train_time_arrival_dict</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>    <span class="k">elif</span> <span class="n">TROPICAL_STORM</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">SEVERE_HURRICANE</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="n">time_start</span> <span class="o">=</span> <span class="n">HURRICANE_START</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="n">disruption_duration</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">4</span> <span class="c1"># 4 days</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">time_end_1_week</span> <span class="o">=</span> <span class="n">HURRICANE_START</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="c1"># 7 days</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="n">time_end_2_week</span> <span class="o">=</span> <span class="n">HURRICANE_START</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">14</span> <span class="c1"># 14 days</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="c1"># No damage to port facilities</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="c1"># No vessel arrivals for 1 week</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="n">stop_and_bulk_arrival</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="c1"># for the first week only 70% of trucks arrive and no change to trains</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="n">truck_time_arrival_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            <span class="p">(</span><span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">):</span> <span class="mf">0.8</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="p">}</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="n">filter_truck_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">truck_time_arrival_dict</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>    <span class="k">elif</span> <span class="n">SEVERE_HURRICANE</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">TROPICAL_STORM</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Both SEVERE_HURRICANE and TROPICAL_STORM flags cannot be True at the same time; update the config file.&quot;</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="k">def</span><span class="w"> </span><span class="nf">disruption_report_smoothed</span><span class="p">(</span><span class="n">smooth_window_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">plot_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">    Inputs:</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        - smooth_window_points: window size (odd integer) for rolling mean smoothing of raw queue</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">    Outputs (returned as a formatted string):</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">        1) times: onset, queue_in_point, mobilisation, peak, recovery</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        2) a blank line</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        3) durations: onset→queue_in_point, queue_in_point→mobilisation, mobilisation→peak, peak→recovery</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">        4) a blank line</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">        5) areas: positive (above baseline), negative (below baseline)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">    Note: All event times are identified on RAW data, but areas are computed using SMOOTHED data.</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>    <span class="n">warmup_time</span> <span class="o">=</span> <span class="n">WARMUP_ITERS</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="n">onset_time</span> <span class="o">=</span> <span class="n">HURRICANE_START</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>    <span class="n">logfileid</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">NUM_MONTHS</span><span class="p">)</span><span class="si">}</span><span class="s2">_months_</span><span class="si">{</span><span class="n">NUM_RUNS</span><span class="si">}</span><span class="s2">_runs_run_</span><span class="si">{</span><span class="n">LOG_NUM</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="n">df_location</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/data/all_queue.csv&#39;</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">df_location</span><span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">df_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;time&quot;</span><span class="p">})</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="n">time_col</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>    <span class="n">queue_col</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[[</span><span class="n">time_col</span><span class="p">,</span> <span class="n">queue_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">time_col</span><span class="p">:</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">,</span> <span class="n">queue_col</span><span class="p">:</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">})</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time_hr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>    <span class="c1"># Smoothing for areas only</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">smooth_window_points</span><span class="p">)</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_smooth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>    <span class="c1"># Baseline from [1000, 1500] on RAW</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">warmup_time</span><span class="p">,</span> <span class="n">onset_time</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>    <span class="n">base_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t1</span><span class="p">)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>    <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_mask</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>    <span class="c1"># A: onset</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="n">idx_A</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">onset_time</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">())</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="n">A_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_A</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">A_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_A</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>    <span class="c1"># t_queue_in_point: point where queue starts to increase (2 positive slopes)</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="n">dQdt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="n">idx_queue_in</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">dQdt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dQdt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="n">idx_queue_in</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="k">if</span> <span class="n">idx_queue_in</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">idx_queue_in</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx_A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="n">t_queue_in</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_queue_in</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">q_queue_in</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_queue_in</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>    <span class="c1"># B: mobilisation (first upward crossing to baseline after t_queue_in_point)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>    <span class="n">idx_B</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_queue_in</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">baseline</span><span class="p">:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="n">idx_B</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="k">if</span> <span class="n">idx_B</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">idx_B</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>    <span class="n">B_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_B</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">B_q</span> <span class="o">=</span> <span class="n">baseline</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>    <span class="c1"># C: peak (raw max after mobilisation)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="n">idx_C</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">B_t</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="n">C_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">C_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>    <span class="c1"># D: recovery (first downward crossing to baseline after C; linear interpolation on RAW)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>    <span class="c1"># D_t, D_q = None, None</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>    <span class="c1"># for i in range(idx_C, len(df) - 1):</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>    <span class="c1">#     y0, y1 = df.at[i, &quot;q_raw&quot;], df.at[i + 1, &quot;q_raw&quot;]</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>    <span class="c1">#     x0, x1 = df.at[i, &quot;time_hr&quot;], df.at[i + 1, &quot;time_hr&quot;]</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>    <span class="c1">#     if (y0 &gt; baseline) and (y1 &lt;= baseline):</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>    <span class="c1">#         D_t = float(x0 + (baseline - y0) * (x1 - x0) / (y1 - y0)) if y1 != y0 else float(x1)</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="c1">#         D_q = baseline</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="c1">#         break</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="c1"># if D_t is None:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>    <span class="c1">#     D_t = float(df.at[len(df) - 1, &quot;time_hr&quot;]); D_q = float(df.at[len(df) - 1, &quot;q_raw&quot;])</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>    <span class="c1"># D: recovery (average queue over 2 weeks post-recovery point is &lt;= baseline)</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>    <span class="n">two_weeks_in_hours</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">*</span> <span class="mi">24</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>    <span class="n">D_t</span><span class="p">,</span> <span class="n">D_q</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_C</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="c1"># Calculate the end point of the 2-week window</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">two_weeks_in_hours</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="c1"># Get the subset of data for the 2-week window</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>        <span class="n">window_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="n">window_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">window_mask</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="c1"># If there&#39;s enough data for a full 2-week window, check the average</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Ensure there is at least one data point</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>            <span class="n">avg_queue</span> <span class="o">=</span> <span class="n">window_data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>            <span class="k">if</span> <span class="n">avg_queue</span> <span class="o">&lt;=</span> <span class="n">baseline</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                <span class="n">D_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>                <span class="n">D_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>                <span class="k">break</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>    <span class="c1"># Fallback in case no such point is found</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>    <span class="k">if</span> <span class="n">D_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>        <span class="n">D_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">D_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="c1"># Durations</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>    <span class="n">dur_A_queue_in</span> <span class="o">=</span> <span class="n">t_queue_in</span> <span class="o">-</span> <span class="n">A_t</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>    <span class="n">dur_queue_in_B</span> <span class="o">=</span> <span class="n">B_t</span> <span class="o">-</span> <span class="n">t_queue_in</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>    <span class="n">dur_B_C</span> <span class="o">=</span> <span class="n">C_t</span> <span class="o">-</span> <span class="n">B_t</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>    <span class="n">dur_C_D</span> <span class="o">=</span> <span class="n">D_t</span> <span class="o">-</span> <span class="n">C_t</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>    <span class="c1"># Areas between A and D using q_smooth</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="n">mask_AD</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">A_t</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">D_t</span><span class="p">)</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>    <span class="n">xs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_AD</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>    <span class="n">ys_sm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_AD</span><span class="p">,</span> <span class="s2">&quot;q_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>    <span class="k">if</span> <span class="n">xs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">D_t</span><span class="p">:</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">D_t</span><span class="p">);</span> <span class="n">ys_sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ys_sm</span><span class="p">,</span> <span class="n">baseline</span><span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>    <span class="n">area_pos</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ys_sm</span> <span class="o">-</span> <span class="n">baseline</span><span class="p">),</span> <span class="n">xs</span><span class="p">))</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>    <span class="n">area_neg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">baseline</span> <span class="o">-</span> <span class="n">ys_sm</span><span class="p">),</span> <span class="n">xs</span><span class="p">))</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>    <span class="c1"># Calculate new metrics</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>    <span class="c1"># Robustness (R): R = Q(t_min) / Q_0_bar</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>    <span class="n">idx_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">A_t</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t_queue_in</span><span class="p">),</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">())</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>    <span class="n">q_min</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_min</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>    <span class="n">robustness</span> <span class="o">=</span> <span class="n">q_min</span> <span class="o">/</span> <span class="n">baseline</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>    <span class="c1"># Mobilization (M): M = time from onset to mobilisation</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>    <span class="n">mobilization</span> <span class="o">=</span> <span class="n">B_t</span> <span class="o">-</span> <span class="n">A_t</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>    <span class="c1"># Peak Queue Increase (P): P = (Q(t_max) - Q_0_bar) / Q_0_bar</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>    <span class="n">peak_increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">C_q</span> <span class="o">-</span> <span class="n">baseline</span><span class="p">)</span> <span class="o">/</span> <span class="n">baseline</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>    <span class="c1"># Max Recovery Rate (m_max): slope of the next &#39;n&#39; points from the peak</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>    <span class="c1"># Initialize variables to store the most negative slope and the corresponding lookahead</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>    <span class="n">max_negative_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>    <span class="n">best_lookahead</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>    <span class="n">best_lookahead_idx</span> <span class="o">=</span> <span class="n">idx_C</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="c1"># Loop through lookahead values from 5 to 50</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>    <span class="k">for</span> <span class="n">recovery_rate_lookahead</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">51</span><span class="p">):</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="n">idx_C_plus_n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx_C</span> <span class="o">+</span> <span class="n">recovery_rate_lookahead</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="k">if</span> <span class="n">idx_C_plus_n</span> <span class="o">&gt;</span> <span class="n">idx_C</span><span class="p">:</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C_plus_n</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">C_q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C_plus_n</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">C_t</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="n">rate</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="c1"># Check if the current rate is more negative than the current maximum negative rate</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="k">if</span> <span class="n">rate</span> <span class="o">&lt;</span> <span class="n">max_negative_rate</span><span class="p">:</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">max_negative_rate</span> <span class="o">=</span> <span class="n">rate</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">best_lookahead</span> <span class="o">=</span> <span class="n">recovery_rate_lookahead</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="n">best_lookahead_idx</span> <span class="o">=</span> <span class="n">idx_C_plus_n</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>    <span class="c1"># drop lat 200 points to avoid edge effects in smoothing</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>    <span class="c1"># Plot (PDF): raw &amp; smoothed; shading from smoothed</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="n">logfileid</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">NUM_MONTHS</span><span class="p">)</span><span class="si">}</span><span class="s2">_months_</span><span class="si">{</span><span class="n">NUM_RUNS</span><span class="si">}</span><span class="s2">_runs_run_</span><span class="si">{</span><span class="n">LOG_NUM</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="n">pdf_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/hurricane_report.pdf&#39;</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">))</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Queue (raw)&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_smooth&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Queue (smoothed)&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys_sm</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">ys_sm</span> <span class="o">&lt;</span> <span class="n">baseline</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lost service&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys_sm</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">ys_sm</span> <span class="o">&gt;</span> <span class="n">baseline</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Excess queuing&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    <span class="c1"># shade the warmup period</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">warmup_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Warmup period&quot;</span><span class="p">)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>    <span class="c1"># Plot the max recovery rate line segment</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>    <span class="n">x_rate</span> <span class="o">=</span> <span class="p">[</span><span class="n">C_t</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">best_lookahead_idx</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]]</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>    <span class="n">y_rate</span> <span class="o">=</span> <span class="p">[</span><span class="n">C_q</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">best_lookahead_idx</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]]</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_rate</span><span class="p">,</span> <span class="n">y_rate</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Max recovery rate&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yv</span><span class="p">),</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="p">[((</span><span class="n">A_t</span><span class="p">,</span> <span class="n">A_q</span><span class="p">),</span> <span class="s2">&quot;Onset&quot;</span><span class="p">),</span> <span class="p">((</span><span class="n">B_t</span><span class="p">,</span> <span class="n">B_q</span><span class="p">),</span> <span class="s2">&quot;Mobilisation&quot;</span><span class="p">),</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                         <span class="p">((</span><span class="n">C_t</span><span class="p">,</span> <span class="n">C_q</span><span class="p">),</span> <span class="s2">&quot;Peak&quot;</span><span class="p">),</span> <span class="p">((</span><span class="n">D_t</span><span class="p">,</span> <span class="n">D_q</span><span class="p">),</span> <span class="s2">&quot;Recovery&quot;</span><span class="p">)]:</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">xt</span><span class="p">],</span> <span class="p">[</span><span class="n">yv</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (hr)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Queue length&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="k">if</span> <span class="n">plot_legend</span><span class="p">:</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="sa">f</span><span class="s2">&quot;onset: </span><span class="si">{</span><span class="n">A_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="sa">f</span><span class="s2">&quot;queue-in-point: </span><span class="si">{</span><span class="n">t_queue_in</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="sa">f</span><span class="s2">&quot;mobilisation: </span><span class="si">{</span><span class="n">B_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="sa">f</span><span class="s2">&quot;peak: </span><span class="si">{</span><span class="n">C_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>        <span class="sa">f</span><span class="s2">&quot;recovery: </span><span class="si">{</span><span class="n">D_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="sa">f</span><span class="s2">&quot;time onset to queue-in-point (days): </span><span class="si">{</span><span class="n">dur_A_queue_in</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="sa">f</span><span class="s2">&quot;time queue-in-point to mobilisation (days): </span><span class="si">{</span><span class="n">dur_queue_in_B</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="sa">f</span><span class="s2">&quot;time mobilisation to peak (days): </span><span class="si">{</span><span class="n">dur_B_C</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="sa">f</span><span class="s2">&quot;time peak to recovery (days): </span><span class="si">{</span><span class="n">dur_C_D</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="sa">f</span><span class="s2">&quot;area above baseline (vessel days): </span><span class="si">{</span><span class="n">area_pos</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="sa">f</span><span class="s2">&quot;area below baseline (vessel days): </span><span class="si">{</span><span class="n">area_neg</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="sa">f</span><span class="s2">&quot;Robustness: </span><span class="si">{</span><span class="n">robustness</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="sa">f</span><span class="s2">&quot;Mobilization: </span><span class="si">{</span><span class="n">mobilization</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="sa">f</span><span class="s2">&quot;Peak Queue Increase: </span><span class="si">{</span><span class="n">peak_increase</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="sa">f</span><span class="s2">&quot;Max Recovery Rate: </span><span class="si">{</span><span class="n">max_negative_rate</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>    <span class="p">]</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/hurricane_report.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fog_peak_slopes</span><span class="p">(</span><span class="n">slope_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">baseline_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">7</span><span class="o">*</span><span class="mi">14</span><span class="p">):</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">    - Shades inbound/outbound closure windows.</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">    - For each pair i, finds the raw peak within the union window [min(in_i, out_i), max(in_i, out_i)].</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">    - Computes slope from peak -&gt; next `slope_steps` points: (q[t+k]-q[t])/(time[t+k]-time[t]).</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">    - Produces TWO plots:</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        1) Full view: queue with inbound/outbound shaded (no slope segments).</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">        2) Zoomed to [first_closure_start, last_closure_end]: queue with closures shaded AND slope segments.</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">    - Prints a compact table (no CSV) with: i, peak_time, peak_queue, slope_peak_to_nextK.</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">    Uses default Matplotlib colors; markers are circles; no text annotations.</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>    <span class="c1"># ---- Load data ----</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>    <span class="n">warmup_time</span> <span class="o">=</span> <span class="n">WARMUP_ITERS</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>    <span class="n">inbound_closed</span> <span class="o">=</span> <span class="n">INBOUND_CLOSED</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>    <span class="n">outbound_closed</span> <span class="o">=</span> <span class="n">OUTBOUND_CLOSED</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>    <span class="n">logfileid</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">NUM_MONTHS</span><span class="p">)</span><span class="si">}</span><span class="s2">_months_</span><span class="si">{</span><span class="n">NUM_RUNS</span><span class="si">}</span><span class="s2">_runs_run_</span><span class="si">{</span><span class="n">LOG_NUM</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>    <span class="n">df_location</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/data/all_queue.csv&#39;</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">df_location</span><span class="p">)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">df_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;time&quot;</span><span class="p">})</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>    <span class="n">time_col</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="n">mean_col</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[[</span><span class="n">time_col</span><span class="p">,</span> <span class="n">mean_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">time_col</span><span class="p">:</span><span class="s2">&quot;time_hr&quot;</span><span class="p">,</span> <span class="n">mean_col</span><span class="p">:</span><span class="s2">&quot;q_raw&quot;</span><span class="p">})</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time_hr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">,</span><span class="s2">&quot;q_raw&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>    <span class="c1"># Baseline from 1000 to 1500 (raw)</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>    <span class="n">base_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">warmup_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">baseline_end</span><span class="p">)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>    <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_mask</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>    <span class="c1"># ---- Per-pair peak and slope to next K steps ----</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inbound_closed</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">outbound_closed</span><span class="p">))</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">inbound_closed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">outbound_closed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="n">win_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="n">win_end</span>   <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="n">mask_win</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">win_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">win_end</span><span class="p">)</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        <span class="k">if</span> <span class="n">mask_win</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>            <span class="k">continue</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">idx_peak</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_win</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="n">t_peak</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_peak</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">q_peak</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_peak</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="c1"># Check if the queue decreases after the peak</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="n">idx_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx_peak</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">slope_steps</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="n">t_k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_k</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="n">q_k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_k</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>        <span class="c1"># Only calculate and append the result if the queue decreases</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="n">q_k</span> <span class="o">&lt;=</span> <span class="n">q_peak</span><span class="p">:</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">q_k</span> <span class="o">-</span> <span class="n">q_peak</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">t_k</span> <span class="o">-</span> <span class="n">t_peak</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">t_k</span> <span class="o">-</span> <span class="n">t_peak</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="n">t_peak</span><span class="p">,</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                <span class="s2">&quot;peak_queue&quot;</span><span class="p">:</span> <span class="n">q_peak</span><span class="p">,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>                <span class="s2">&quot;nextK_time&quot;</span><span class="p">:</span> <span class="n">t_k</span><span class="p">,</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                <span class="s2">&quot;nextK_queue&quot;</span><span class="p">:</span> <span class="n">q_k</span><span class="p">,</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                <span class="s2">&quot;slope_peak_to_nextK&quot;</span><span class="p">:</span> <span class="n">slope</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>            <span class="p">})</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>    <span class="c1"># ---- PLOTS ----</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>    <span class="c1"># 1) Full view: open/closed only</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>    <span class="n">pdf_full</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/fog_report_full.pdf&#39;</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>    <span class="n">export_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/fog_report&#39;</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>    
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Queue&quot;</span><span class="p">)</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">)</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">:</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Inbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">inbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">:</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Outbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">outbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (hr)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Queue length&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_full</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>    <span class="c1"># 2) Zoomed: show slopes too</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>    <span class="n">pdf_zoom</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_prefix</span><span class="si">}</span><span class="s2">_zoom.pdf&quot;</span><span class="p">)</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="n">fog_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">))</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>    <span class="n">fog_end</span>   <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">))</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">fog_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">fog_end</span><span class="p">)</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Queue&quot;</span><span class="p">)</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">)</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">:</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="k">if</span> <span class="n">e</span><span class="o">&gt;=</span><span class="n">fog_start</span> <span class="ow">and</span> <span class="n">s</span><span class="o">&lt;=</span><span class="n">fog_end</span><span class="p">:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Inbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">inbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">:</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="k">if</span> <span class="n">e</span><span class="o">&gt;=</span><span class="n">fog_start</span> <span class="ow">and</span> <span class="n">s</span><span class="o">&lt;=</span><span class="n">fog_end</span><span class="p">:</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Outbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">outbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>    <span class="c1"># circle markers + slope segments</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="k">if</span> <span class="n">fog_start</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">fog_end</span><span class="p">:</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_queue&quot;</span><span class="p">]],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;nextK_time&quot;</span><span class="p">]],</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                     <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_queue&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;nextK_queue&quot;</span><span class="p">]],</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>                     <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (hr)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Queue length&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>           <span class="c1"># anchor relative to top center</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span>  <span class="c1"># shift it below the axes</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>        <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span>                        <span class="c1"># optional: spread entries into multiple columns</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>    <span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_zoom</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>    <span class="c1"># ---- PRINT TABLE ----</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;i, peak_time, peak_queue, slope_peak_to_nextK&quot;</span><span class="p">)</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_queue&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;slope_peak_to_nextK&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Average slope is&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;slope_peak_to_nextK&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]))</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>    <span class="c1"># save results as a text file</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/fog_report.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;i, peak_time, peak_queue, slope_peak_to_nextK</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_queue&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;slope_peak_to_nextK&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>            
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_full</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_zoom</span><span class="p">)</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>              
</span></pre></div>


            </section>
                <section id="reduce_cranes">
                            <input id="reduce_cranes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_cranes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">change</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">time_start</span>,</span><span class="param">	<span class="n">time_end</span>,</span><span class="param">	<span class="n">port_berths_container_terminals</span>,</span><span class="param">	<span class="n">terminal_data_cache</span>,</span><span class="param">	<span class="n">berths_aff_per</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_cranes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_cranes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_cranes-20"><a href="#reduce_cranes-20"><span class="linenos">20</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="n">berths_aff_per</span><span class="p">):</span>
</span><span id="reduce_cranes-21"><a href="#reduce_cranes-21"><span class="linenos">21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_cranes-22"><a href="#reduce_cranes-22"><span class="linenos">22</span></a><span class="sd">    This function reduces the number of cranes in each berth by `change` amount by removing cranes from the berth&#39;s crane store between `time_start` and `time_end`.</span>
</span><span id="reduce_cranes-23"><a href="#reduce_cranes-23"><span class="linenos">23</span></a><span class="sd">    It also restores the cranes after the reduction period.</span>
</span><span id="reduce_cranes-24"><a href="#reduce_cranes-24"><span class="linenos">24</span></a><span class="sd">    Args:</span>
</span><span id="reduce_cranes-25"><a href="#reduce_cranes-25"><span class="linenos">25</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_cranes-26"><a href="#reduce_cranes-26"><span class="linenos">26</span></a><span class="sd">        change (int): The number of cranes to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_cranes-27"><a href="#reduce_cranes-27"><span class="linenos">27</span></a><span class="sd">        terminals (list): List of terminal indices where the cranes will be reduced.</span>
</span><span id="reduce_cranes-28"><a href="#reduce_cranes-28"><span class="linenos">28</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_cranes-29"><a href="#reduce_cranes-29"><span class="linenos">29</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="reduce_cranes-30"><a href="#reduce_cranes-30"><span class="linenos">30</span></a><span class="sd">        port_berths_container_terminals (dict): Dictionary containing berth information for container terminals.</span>
</span><span id="reduce_cranes-31"><a href="#reduce_cranes-31"><span class="linenos">31</span></a><span class="sd">        terminal_data_cache (dict): Cache containing terminal data for crane transfer rates.</span>
</span><span id="reduce_cranes-32"><a href="#reduce_cranes-32"><span class="linenos">32</span></a><span class="sd">        berths_aff_per (float): Percentage of berths to be affected by the change.</span>
</span><span id="reduce_cranes-33"><a href="#reduce_cranes-33"><span class="linenos">33</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_cranes-34"><a href="#reduce_cranes-34"><span class="linenos">34</span></a><span class="sd">        None</span>
</span><span id="reduce_cranes-35"><a href="#reduce_cranes-35"><span class="linenos">35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_cranes-36"><a href="#reduce_cranes-36"><span class="linenos">36</span></a>    <span class="n">port_berth_initially</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="reduce_cranes-37"><a href="#reduce_cranes-37"><span class="linenos">37</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_cranes-38"><a href="#reduce_cranes-38"><span class="linenos">38</span></a>        <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="reduce_cranes-39"><a href="#reduce_cranes-39"><span class="linenos">39</span></a>        <span class="k">for</span> <span class="n">berths</span> <span class="ow">in</span> <span class="n">port_berths_container_terminals</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="reduce_cranes-40"><a href="#reduce_cranes-40"><span class="linenos">40</span></a>            <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berths</span><span class="p">)</span>
</span><span id="reduce_cranes-41"><a href="#reduce_cranes-41"><span class="linenos">41</span></a>
</span><span id="reduce_cranes-42"><a href="#reduce_cranes-42"><span class="linenos">42</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_cranes-43"><a href="#reduce_cranes-43"><span class="linenos">43</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> cranes from each berth in terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_cranes-44"><a href="#reduce_cranes-44"><span class="linenos">44</span></a>
</span><span id="reduce_cranes-45"><a href="#reduce_cranes-45"><span class="linenos">45</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_cranes-46"><a href="#reduce_cranes-46"><span class="linenos">46</span></a>
</span><span id="reduce_cranes-47"><a href="#reduce_cranes-47"><span class="linenos">47</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_cranes-48"><a href="#reduce_cranes-48"><span class="linenos">48</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="reduce_cranes-49"><a href="#reduce_cranes-49"><span class="linenos">49</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="reduce_cranes-50"><a href="#reduce_cranes-50"><span class="linenos">50</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="reduce_cranes-51"><a href="#reduce_cranes-51"><span class="linenos">51</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="reduce_cranes-52"><a href="#reduce_cranes-52"><span class="linenos">52</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="reduce_cranes-53"><a href="#reduce_cranes-53"><span class="linenos">53</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="reduce_cranes-54"><a href="#reduce_cranes-54"><span class="linenos">54</span></a>                <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">))</span>
</span><span id="reduce_cranes-55"><a href="#reduce_cranes-55"><span class="linenos">55</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="reduce_cranes-56"><a href="#reduce_cranes-56"><span class="linenos">56</span></a>                    <span class="k">if</span> <span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="reduce_cranes-57"><a href="#reduce_cranes-57"><span class="linenos">57</span></a>                        <span class="n">crane</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="reduce_cranes-58"><a href="#reduce_cranes-58"><span class="linenos">58</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="reduce_cranes-59"><a href="#reduce_cranes-59"><span class="linenos">59</span></a>                <span class="k">break</span>
</span><span id="reduce_cranes-60"><a href="#reduce_cranes-60"><span class="linenos">60</span></a>
</span><span id="reduce_cranes-61"><a href="#reduce_cranes-61"><span class="linenos">61</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_cranes-62"><a href="#reduce_cranes-62"><span class="linenos">62</span></a>
</span><span id="reduce_cranes-63"><a href="#reduce_cranes-63"><span class="linenos">63</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_cranes-64"><a href="#reduce_cranes-64"><span class="linenos">64</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="reduce_cranes-65"><a href="#reduce_cranes-65"><span class="linenos">65</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="reduce_cranes-66"><a href="#reduce_cranes-66"><span class="linenos">66</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="reduce_cranes-67"><a href="#reduce_cranes-67"><span class="linenos">67</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="reduce_cranes-68"><a href="#reduce_cranes-68"><span class="linenos">68</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="reduce_cranes-69"><a href="#reduce_cranes-69"><span class="linenos">69</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="reduce_cranes-70"><a href="#reduce_cranes-70"><span class="linenos">70</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="reduce_cranes-71"><a href="#reduce_cranes-71"><span class="linenos">71</span></a>                    <span class="n">restored_crane</span> <span class="o">=</span> <span class="n">Crane</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;restored_</span><span class="si">{</span><span class="n">berth</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="n">crane_transfer_rate</span><span class="o">=</span><span class="n">get_value_by_terminal</span><span class="p">(</span>
</span><span id="reduce_cranes-72"><a href="#reduce_cranes-72"><span class="linenos">72</span></a>                        <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="s1">&#39;Container&#39;</span><span class="p">,</span> <span class="n">terminal_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;transfer rate per unit&#39;</span><span class="p">))</span>
</span><span id="reduce_cranes-73"><a href="#reduce_cranes-73"><span class="linenos">73</span></a>                    <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">cranes</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">restored_crane</span><span class="p">)</span>
</span><span id="reduce_cranes-74"><a href="#reduce_cranes-74"><span class="linenos">74</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="reduce_cranes-75"><a href="#reduce_cranes-75"><span class="linenos">75</span></a>                <span class="k">break</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the number of cranes in each berth by <code>change</code> amount by removing cranes from the berth's crane store between <code>time_start</code> and <code>time_end</code>.
It also restores the cranes after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of cranes to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the cranes will be reduced.</li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_berths_container_terminals (dict):</strong>  Dictionary containing berth information for container terminals.</li>
<li><strong>terminal_data_cache (dict):</strong>  Cache containing terminal data for crane transfer rates.</li>
<li><strong>berths_aff_per (float):</strong>  Percentage of berths to be affected by the change.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_pipelines">
                            <input id="reduce_pipelines-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_pipelines</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">change</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">time_start</span>,</span><span class="param">	<span class="n">time_end</span>,</span><span class="param">	<span class="n">port_berth_liquid_terminals</span>,</span><span class="param">	<span class="n">terminal_data_cache</span>,</span><span class="param">	<span class="n">berths_aff_per</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_pipelines-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_pipelines"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_pipelines-78"><a href="#reduce_pipelines-78"><span class="linenos"> 78</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="n">berths_aff_per</span><span class="p">):</span>
</span><span id="reduce_pipelines-79"><a href="#reduce_pipelines-79"><span class="linenos"> 79</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_pipelines-80"><a href="#reduce_pipelines-80"><span class="linenos"> 80</span></a><span class="sd">    This function reduces the number of pipelines in each berth by `change` amount by removing pipelines from the berth&#39;s pipeline store between `time_start` and `time_end`.</span>
</span><span id="reduce_pipelines-81"><a href="#reduce_pipelines-81"><span class="linenos"> 81</span></a><span class="sd">    It also restores the pipelines after the reduction period.</span>
</span><span id="reduce_pipelines-82"><a href="#reduce_pipelines-82"><span class="linenos"> 82</span></a><span class="sd">    Args:</span>
</span><span id="reduce_pipelines-83"><a href="#reduce_pipelines-83"><span class="linenos"> 83</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_pipelines-84"><a href="#reduce_pipelines-84"><span class="linenos"> 84</span></a><span class="sd">        change (int): The number of pipelines to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_pipelines-85"><a href="#reduce_pipelines-85"><span class="linenos"> 85</span></a><span class="sd">        terminals (list): List of terminal indices where the pipelines will be reduced.</span>
</span><span id="reduce_pipelines-86"><a href="#reduce_pipelines-86"><span class="linenos"> 86</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_pipelines-87"><a href="#reduce_pipelines-87"><span class="linenos"> 87</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="reduce_pipelines-88"><a href="#reduce_pipelines-88"><span class="linenos"> 88</span></a><span class="sd">        port_berth_liquid_terminals (dict): Dictionary containing berth information for liquid terminals.</span>
</span><span id="reduce_pipelines-89"><a href="#reduce_pipelines-89"><span class="linenos"> 89</span></a><span class="sd">        terminal_data_cache (dict): Cache containing terminal data for pipeline transfer rates.</span>
</span><span id="reduce_pipelines-90"><a href="#reduce_pipelines-90"><span class="linenos"> 90</span></a><span class="sd">        berths_aff_per (float): Percentage of berths to be affected by the change.</span>
</span><span id="reduce_pipelines-91"><a href="#reduce_pipelines-91"><span class="linenos"> 91</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_pipelines-92"><a href="#reduce_pipelines-92"><span class="linenos"> 92</span></a><span class="sd">        None</span>
</span><span id="reduce_pipelines-93"><a href="#reduce_pipelines-93"><span class="linenos"> 93</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_pipelines-94"><a href="#reduce_pipelines-94"><span class="linenos"> 94</span></a>    <span class="n">port_berth_initially</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="reduce_pipelines-95"><a href="#reduce_pipelines-95"><span class="linenos"> 95</span></a>    <span class="k">for</span> <span class="n">terminal_ids</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_pipelines-96"><a href="#reduce_pipelines-96"><span class="linenos"> 96</span></a>        <span class="n">terminal_idx</span> <span class="o">=</span> <span class="n">terminal_ids</span><span class="o">-</span><span class="mi">1</span>
</span><span id="reduce_pipelines-97"><a href="#reduce_pipelines-97"><span class="linenos"> 97</span></a>        <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="reduce_pipelines-98"><a href="#reduce_pipelines-98"><span class="linenos"> 98</span></a>        <span class="k">for</span> <span class="n">berths</span> <span class="ow">in</span> <span class="n">port_berth_liquid_terminals</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="reduce_pipelines-99"><a href="#reduce_pipelines-99"><span class="linenos"> 99</span></a>            <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berths</span><span class="p">)</span>
</span><span id="reduce_pipelines-100"><a href="#reduce_pipelines-100"><span class="linenos">100</span></a>
</span><span id="reduce_pipelines-101"><a href="#reduce_pipelines-101"><span class="linenos">101</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_pipelines-102"><a href="#reduce_pipelines-102"><span class="linenos">102</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> pipelines from each berth in terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_pipelines-103"><a href="#reduce_pipelines-103"><span class="linenos">103</span></a>
</span><span id="reduce_pipelines-104"><a href="#reduce_pipelines-104"><span class="linenos">104</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_pipelines-105"><a href="#reduce_pipelines-105"><span class="linenos">105</span></a>
</span><span id="reduce_pipelines-106"><a href="#reduce_pipelines-106"><span class="linenos">106</span></a>    <span class="k">for</span> <span class="n">terminal_ids</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_pipelines-107"><a href="#reduce_pipelines-107"><span class="linenos">107</span></a>        <span class="n">terminal_idx</span> <span class="o">=</span> <span class="n">terminal_ids</span><span class="o">-</span><span class="mi">1</span>
</span><span id="reduce_pipelines-108"><a href="#reduce_pipelines-108"><span class="linenos">108</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="reduce_pipelines-109"><a href="#reduce_pipelines-109"><span class="linenos">109</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="reduce_pipelines-110"><a href="#reduce_pipelines-110"><span class="linenos">110</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="reduce_pipelines-111"><a href="#reduce_pipelines-111"><span class="linenos">111</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="reduce_pipelines-112"><a href="#reduce_pipelines-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="reduce_pipelines-113"><a href="#reduce_pipelines-113"><span class="linenos">113</span></a>                <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">))</span>
</span><span id="reduce_pipelines-114"><a href="#reduce_pipelines-114"><span class="linenos">114</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="reduce_pipelines-115"><a href="#reduce_pipelines-115"><span class="linenos">115</span></a>                    <span class="k">if</span> <span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="reduce_pipelines-116"><a href="#reduce_pipelines-116"><span class="linenos">116</span></a>                        <span class="n">pipeline</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="reduce_pipelines-117"><a href="#reduce_pipelines-117"><span class="linenos">117</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="reduce_pipelines-118"><a href="#reduce_pipelines-118"><span class="linenos">118</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="reduce_pipelines-119"><a href="#reduce_pipelines-119"><span class="linenos">119</span></a>                <span class="k">break</span>
</span><span id="reduce_pipelines-120"><a href="#reduce_pipelines-120"><span class="linenos">120</span></a>
</span><span id="reduce_pipelines-121"><a href="#reduce_pipelines-121"><span class="linenos">121</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_pipelines-122"><a href="#reduce_pipelines-122"><span class="linenos">122</span></a>
</span><span id="reduce_pipelines-123"><a href="#reduce_pipelines-123"><span class="linenos">123</span></a>    <span class="k">for</span> <span class="n">terminal_ids</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_pipelines-124"><a href="#reduce_pipelines-124"><span class="linenos">124</span></a>        <span class="n">terminal_idx</span> <span class="o">=</span> <span class="n">terminal_ids</span><span class="o">-</span><span class="mi">1</span>
</span><span id="reduce_pipelines-125"><a href="#reduce_pipelines-125"><span class="linenos">125</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="reduce_pipelines-126"><a href="#reduce_pipelines-126"><span class="linenos">126</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="reduce_pipelines-127"><a href="#reduce_pipelines-127"><span class="linenos">127</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="reduce_pipelines-128"><a href="#reduce_pipelines-128"><span class="linenos">128</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="reduce_pipelines-129"><a href="#reduce_pipelines-129"><span class="linenos">129</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="reduce_pipelines-130"><a href="#reduce_pipelines-130"><span class="linenos">130</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="reduce_pipelines-131"><a href="#reduce_pipelines-131"><span class="linenos">131</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="reduce_pipelines-132"><a href="#reduce_pipelines-132"><span class="linenos">132</span></a>                    <span class="n">restored_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;restored_</span><span class="si">{</span><span class="n">berth</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pump_rate_per_pipeline</span><span class="o">=</span><span class="n">get_value_by_terminal</span><span class="p">(</span>
</span><span id="reduce_pipelines-133"><a href="#reduce_pipelines-133"><span class="linenos">133</span></a>                        <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="s2">&quot;Liquid&quot;</span><span class="p">,</span> <span class="n">terminal_ids</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;transfer rate per unit&quot;</span><span class="p">))</span>
</span><span id="reduce_pipelines-134"><a href="#reduce_pipelines-134"><span class="linenos">134</span></a>
</span><span id="reduce_pipelines-135"><a href="#reduce_pipelines-135"><span class="linenos">135</span></a>                    <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">restored_pipeline</span><span class="p">)</span>
</span><span id="reduce_pipelines-136"><a href="#reduce_pipelines-136"><span class="linenos">136</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="reduce_pipelines-137"><a href="#reduce_pipelines-137"><span class="linenos">137</span></a>                <span class="k">break</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the number of pipelines in each berth by <code>change</code> amount by removing pipelines from the berth's pipeline store between <code>time_start</code> and <code>time_end</code>.
It also restores the pipelines after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of pipelines to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the pipelines will be reduced.</li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_berth_liquid_terminals (dict):</strong>  Dictionary containing berth information for liquid terminals.</li>
<li><strong>terminal_data_cache (dict):</strong>  Cache containing terminal data for pipeline transfer rates.</li>
<li><strong>berths_aff_per (float):</strong>  Percentage of berths to be affected by the change.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_conveyors">
                            <input id="reduce_conveyors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_conveyors</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">change</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">time_start</span>,</span><span class="param">	<span class="n">time_end</span>,</span><span class="param">	<span class="n">port_berth_drybulk_terminals</span>,</span><span class="param">	<span class="n">terminal_data_cache</span>,</span><span class="param">	<span class="n">berths_aff_per</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_conveyors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_conveyors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_conveyors-140"><a href="#reduce_conveyors-140"><span class="linenos">140</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="n">berths_aff_per</span><span class="p">):</span>
</span><span id="reduce_conveyors-141"><a href="#reduce_conveyors-141"><span class="linenos">141</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_conveyors-142"><a href="#reduce_conveyors-142"><span class="linenos">142</span></a><span class="sd">    This function reduces the number of conveyors in each berth by `change` amount by removing conveyors from the berth&#39;s conveyor store between `time_start` and `time_end`.</span>
</span><span id="reduce_conveyors-143"><a href="#reduce_conveyors-143"><span class="linenos">143</span></a><span class="sd">    It also restores the conveyors after the reduction period.</span>
</span><span id="reduce_conveyors-144"><a href="#reduce_conveyors-144"><span class="linenos">144</span></a><span class="sd">    Args:</span>
</span><span id="reduce_conveyors-145"><a href="#reduce_conveyors-145"><span class="linenos">145</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_conveyors-146"><a href="#reduce_conveyors-146"><span class="linenos">146</span></a><span class="sd">        change (int): The number of conveyors to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_conveyors-147"><a href="#reduce_conveyors-147"><span class="linenos">147</span></a><span class="sd">        terminals (list): List of terminal indices where the conveyors will be reduced.</span>
</span><span id="reduce_conveyors-148"><a href="#reduce_conveyors-148"><span class="linenos">148</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_conveyors-149"><a href="#reduce_conveyors-149"><span class="linenos">149</span></a><span class="sd">        time_end (int): The time at which the reduction ends.   </span>
</span><span id="reduce_conveyors-150"><a href="#reduce_conveyors-150"><span class="linenos">150</span></a><span class="sd">        port_berth_drybulk_terminals (dict): Dictionary containing berth information for dry bulk terminals.</span>
</span><span id="reduce_conveyors-151"><a href="#reduce_conveyors-151"><span class="linenos">151</span></a><span class="sd">        terminal_data_cache (dict): Cache containing terminal data for conveyor transfer rates.</span>
</span><span id="reduce_conveyors-152"><a href="#reduce_conveyors-152"><span class="linenos">152</span></a><span class="sd">        berths_aff_per (float): Percentage of berths to be affected by the change.</span>
</span><span id="reduce_conveyors-153"><a href="#reduce_conveyors-153"><span class="linenos">153</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_conveyors-154"><a href="#reduce_conveyors-154"><span class="linenos">154</span></a><span class="sd">        None</span>
</span><span id="reduce_conveyors-155"><a href="#reduce_conveyors-155"><span class="linenos">155</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_conveyors-156"><a href="#reduce_conveyors-156"><span class="linenos">156</span></a>    <span class="n">port_berth_initially</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="reduce_conveyors-157"><a href="#reduce_conveyors-157"><span class="linenos">157</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_conveyors-158"><a href="#reduce_conveyors-158"><span class="linenos">158</span></a>        <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="reduce_conveyors-159"><a href="#reduce_conveyors-159"><span class="linenos">159</span></a>        <span class="k">for</span> <span class="n">berths</span> <span class="ow">in</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="reduce_conveyors-160"><a href="#reduce_conveyors-160"><span class="linenos">160</span></a>            <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berths</span><span class="p">)</span>
</span><span id="reduce_conveyors-161"><a href="#reduce_conveyors-161"><span class="linenos">161</span></a>
</span><span id="reduce_conveyors-162"><a href="#reduce_conveyors-162"><span class="linenos">162</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_conveyors-163"><a href="#reduce_conveyors-163"><span class="linenos">163</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> conveyor from each berth in terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_conveyors-164"><a href="#reduce_conveyors-164"><span class="linenos">164</span></a>
</span><span id="reduce_conveyors-165"><a href="#reduce_conveyors-165"><span class="linenos">165</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_conveyors-166"><a href="#reduce_conveyors-166"><span class="linenos">166</span></a>
</span><span id="reduce_conveyors-167"><a href="#reduce_conveyors-167"><span class="linenos">167</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_conveyors-168"><a href="#reduce_conveyors-168"><span class="linenos">168</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="reduce_conveyors-169"><a href="#reduce_conveyors-169"><span class="linenos">169</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="reduce_conveyors-170"><a href="#reduce_conveyors-170"><span class="linenos">170</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="reduce_conveyors-171"><a href="#reduce_conveyors-171"><span class="linenos">171</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="reduce_conveyors-172"><a href="#reduce_conveyors-172"><span class="linenos">172</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="reduce_conveyors-173"><a href="#reduce_conveyors-173"><span class="linenos">173</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="reduce_conveyors-174"><a href="#reduce_conveyors-174"><span class="linenos">174</span></a>                <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">))</span>
</span><span id="reduce_conveyors-175"><a href="#reduce_conveyors-175"><span class="linenos">175</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="reduce_conveyors-176"><a href="#reduce_conveyors-176"><span class="linenos">176</span></a>                    <span class="k">if</span> <span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
</span><span id="reduce_conveyors-177"><a href="#reduce_conveyors-177"><span class="linenos">177</span></a>                        <span class="n">conveyor</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="reduce_conveyors-178"><a href="#reduce_conveyors-178"><span class="linenos">178</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="reduce_conveyors-179"><a href="#reduce_conveyors-179"><span class="linenos">179</span></a>                <span class="k">break</span>
</span><span id="reduce_conveyors-180"><a href="#reduce_conveyors-180"><span class="linenos">180</span></a>
</span><span id="reduce_conveyors-181"><a href="#reduce_conveyors-181"><span class="linenos">181</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_conveyors-182"><a href="#reduce_conveyors-182"><span class="linenos">182</span></a>
</span><span id="reduce_conveyors-183"><a href="#reduce_conveyors-183"><span class="linenos">183</span></a>    <span class="k">for</span> <span class="n">terminal_idx</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_conveyors-184"><a href="#reduce_conveyors-184"><span class="linenos">184</span></a>        <span class="n">num_berths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">])</span>
</span><span id="reduce_conveyors-185"><a href="#reduce_conveyors-185"><span class="linenos">185</span></a>        <span class="n">berths_aff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">berths_aff_per</span><span class="o">*</span><span class="n">num_berths</span><span class="p">)</span>
</span><span id="reduce_conveyors-186"><a href="#reduce_conveyors-186"><span class="linenos">186</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="reduce_conveyors-187"><a href="#reduce_conveyors-187"><span class="linenos">187</span></a>
</span><span id="reduce_conveyors-188"><a href="#reduce_conveyors-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">port_berth_initially</span><span class="p">[</span><span class="n">terminal_idx</span><span class="p">]:</span>
</span><span id="reduce_conveyors-189"><a href="#reduce_conveyors-189"><span class="linenos">189</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="reduce_conveyors-190"><a href="#reduce_conveyors-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="reduce_conveyors-191"><a href="#reduce_conveyors-191"><span class="linenos">191</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="reduce_conveyors-192"><a href="#reduce_conveyors-192"><span class="linenos">192</span></a>                    <span class="n">restored_conveyor</span> <span class="o">=</span> <span class="n">Conveyor</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;restored_</span><span class="si">{</span><span class="n">berth</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">conveyor_rate_per_conveyor</span><span class="o">=</span><span class="n">get_value_by_terminal</span><span class="p">(</span>
</span><span id="reduce_conveyors-193"><a href="#reduce_conveyors-193"><span class="linenos">193</span></a>                        <span class="n">terminal_data_cache</span><span class="p">,</span> <span class="s2">&quot;DryBulk&quot;</span><span class="p">,</span> <span class="n">terminal_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;transfer rate per unit&quot;</span><span class="p">))</span>
</span><span id="reduce_conveyors-194"><a href="#reduce_conveyors-194"><span class="linenos">194</span></a>                    <span class="k">yield</span> <span class="n">berth</span><span class="o">.</span><span class="n">conveyors</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">restored_conveyor</span><span class="p">)</span>
</span><span id="reduce_conveyors-195"><a href="#reduce_conveyors-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">berths_aff</span><span class="p">:</span>
</span><span id="reduce_conveyors-196"><a href="#reduce_conveyors-196"><span class="linenos">196</span></a>                <span class="k">break</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the number of conveyors in each berth by <code>change</code> amount by removing conveyors from the berth's conveyor store between <code>time_start</code> and <code>time_end</code>.
It also restores the conveyors after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of conveyors to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the conveyors will be reduced.</li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.   </li>
<li><strong>port_berth_drybulk_terminals (dict):</strong>  Dictionary containing berth information for dry bulk terminals.</li>
<li><strong>terminal_data_cache (dict):</strong>  Cache containing terminal data for conveyor transfer rates.</li>
<li><strong>berths_aff_per (float):</strong>  Percentage of berths to be affected by the change.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_berths">
                            <input id="reduce_berths-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_berths</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">env</span>, </span><span class="param"><span class="n">change</span>, </span><span class="param"><span class="n">terminals</span>, </span><span class="param"><span class="n">time_start</span>, </span><span class="param"><span class="n">time_end</span>, </span><span class="param"><span class="n">port_berths_terminal</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_berths-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_berths"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_berths-199"><a href="#reduce_berths-199"><span class="linenos">199</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_berths</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_berths_terminal</span><span class="p">):</span>
</span><span id="reduce_berths-200"><a href="#reduce_berths-200"><span class="linenos">200</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_berths-201"><a href="#reduce_berths-201"><span class="linenos">201</span></a><span class="sd">    This function reduces the number of berths in each terminal by `change` amount by removing berths from the terminal&#39;s berth store between `time_start` and `time_end`.</span>
</span><span id="reduce_berths-202"><a href="#reduce_berths-202"><span class="linenos">202</span></a><span class="sd">    It also restores the berths after the reduction period.</span>
</span><span id="reduce_berths-203"><a href="#reduce_berths-203"><span class="linenos">203</span></a><span class="sd">    Args:</span>
</span><span id="reduce_berths-204"><a href="#reduce_berths-204"><span class="linenos">204</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_berths-205"><a href="#reduce_berths-205"><span class="linenos">205</span></a><span class="sd">        change (int): The number of berths to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_berths-206"><a href="#reduce_berths-206"><span class="linenos">206</span></a><span class="sd">        terminals (list): List of terminal indices where the berths will be reduced.        </span>
</span><span id="reduce_berths-207"><a href="#reduce_berths-207"><span class="linenos">207</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_berths-208"><a href="#reduce_berths-208"><span class="linenos">208</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="reduce_berths-209"><a href="#reduce_berths-209"><span class="linenos">209</span></a><span class="sd">        port_berths_terminal (dict): Dictionary containing berth information for the terminals.</span>
</span><span id="reduce_berths-210"><a href="#reduce_berths-210"><span class="linenos">210</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_berths-211"><a href="#reduce_berths-211"><span class="linenos">211</span></a><span class="sd">        None</span>
</span><span id="reduce_berths-212"><a href="#reduce_berths-212"><span class="linenos">212</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_berths-213"><a href="#reduce_berths-213"><span class="linenos">213</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_berths-214"><a href="#reduce_berths-214"><span class="linenos">214</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> berths from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_berths-215"><a href="#reduce_berths-215"><span class="linenos">215</span></a>
</span><span id="reduce_berths-216"><a href="#reduce_berths-216"><span class="linenos">216</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_berths-217"><a href="#reduce_berths-217"><span class="linenos">217</span></a>
</span><span id="reduce_berths-218"><a href="#reduce_berths-218"><span class="linenos">218</span></a>    <span class="n">removed_berths</span> <span class="o">=</span> <span class="p">{</span><span class="n">terminal</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">}</span>
</span><span id="reduce_berths-219"><a href="#reduce_berths-219"><span class="linenos">219</span></a>
</span><span id="reduce_berths-220"><a href="#reduce_berths-220"><span class="linenos">220</span></a>    <span class="c1"># Reduce capacity by taking items out of the store</span>
</span><span id="reduce_berths-221"><a href="#reduce_berths-221"><span class="linenos">221</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_berths-222"><a href="#reduce_berths-222"><span class="linenos">222</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="reduce_berths-223"><a href="#reduce_berths-223"><span class="linenos">223</span></a>            <span class="c1"># Remove a berth to simulate reduced capacity</span>
</span><span id="reduce_berths-224"><a href="#reduce_berths-224"><span class="linenos">224</span></a>            <span class="n">berth</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">port_berths_terminal</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="reduce_berths-225"><a href="#reduce_berths-225"><span class="linenos">225</span></a>            <span class="n">removed_berths</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">berth</span><span class="p">)</span>
</span><span id="reduce_berths-226"><a href="#reduce_berths-226"><span class="linenos">226</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_berths-227"><a href="#reduce_berths-227"><span class="linenos">227</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Berth capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_berths-228"><a href="#reduce_berths-228"><span class="linenos">228</span></a>
</span><span id="reduce_berths-229"><a href="#reduce_berths-229"><span class="linenos">229</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_berths-230"><a href="#reduce_berths-230"><span class="linenos">230</span></a>
</span><span id="reduce_berths-231"><a href="#reduce_berths-231"><span class="linenos">231</span></a>    <span class="c1"># Restore the removed berths to the store</span>
</span><span id="reduce_berths-232"><a href="#reduce_berths-232"><span class="linenos">232</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_berths-233"><a href="#reduce_berths-233"><span class="linenos">233</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">removed_berths</span><span class="p">[</span><span class="n">terminal</span><span class="p">]:</span>
</span><span id="reduce_berths-234"><a href="#reduce_berths-234"><span class="linenos">234</span></a>            <span class="k">yield</span> <span class="n">port_berths_terminal</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">berth</span><span class="p">)</span>
</span><span id="reduce_berths-235"><a href="#reduce_berths-235"><span class="linenos">235</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_berths-236"><a href="#reduce_berths-236"><span class="linenos">236</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Berth Capacity restored by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the number of berths in each terminal by <code>change</code> amount by removing berths from the terminal's berth store between <code>time_start</code> and <code>time_end</code>.
It also restores the berths after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of berths to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the berths will be reduced.        </li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_berths_terminal (dict):</strong>  Dictionary containing berth information for the terminals.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_yard">
                            <input id="reduce_yard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_yard</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">change</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">time_start</span>,</span><span class="param">	<span class="n">time_end</span>,</span><span class="param">	<span class="n">port_yard_container_terminals</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_yard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_yard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_yard-239"><a href="#reduce_yard-239"><span class="linenos">239</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_yard</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_yard_container_terminals</span><span class="p">):</span>
</span><span id="reduce_yard-240"><a href="#reduce_yard-240"><span class="linenos">240</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_yard-241"><a href="#reduce_yard-241"><span class="linenos">241</span></a><span class="sd">    This function reduces the yard capacity in each terminal by `change` amount by adding dummy containers to the terminal&#39;s yard store between `time_start` and `time_end`.</span>
</span><span id="reduce_yard-242"><a href="#reduce_yard-242"><span class="linenos">242</span></a><span class="sd">    It also restores the yard capacity after the reduction period.</span>
</span><span id="reduce_yard-243"><a href="#reduce_yard-243"><span class="linenos">243</span></a><span class="sd">    Args:</span>
</span><span id="reduce_yard-244"><a href="#reduce_yard-244"><span class="linenos">244</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_yard-245"><a href="#reduce_yard-245"><span class="linenos">245</span></a><span class="sd">        change (int): The number of yard spaces to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_yard-246"><a href="#reduce_yard-246"><span class="linenos">246</span></a><span class="sd">        terminals (list): List of terminal indices where the yard capacity will be reduced.</span>
</span><span id="reduce_yard-247"><a href="#reduce_yard-247"><span class="linenos">247</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_yard-248"><a href="#reduce_yard-248"><span class="linenos">248</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="reduce_yard-249"><a href="#reduce_yard-249"><span class="linenos">249</span></a><span class="sd">        port_yard_container_terminals (dict): Dictionary containing yard information for the terminals.</span>
</span><span id="reduce_yard-250"><a href="#reduce_yard-250"><span class="linenos">250</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_yard-251"><a href="#reduce_yard-251"><span class="linenos">251</span></a><span class="sd">        None&quot;&quot;&quot;</span>
</span><span id="reduce_yard-252"><a href="#reduce_yard-252"><span class="linenos">252</span></a>
</span><span id="reduce_yard-253"><a href="#reduce_yard-253"><span class="linenos">253</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_yard-254"><a href="#reduce_yard-254"><span class="linenos">254</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> units yard space from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2"> (Adding dummy containers)&quot;</span><span class="p">)</span>
</span><span id="reduce_yard-255"><a href="#reduce_yard-255"><span class="linenos">255</span></a>
</span><span id="reduce_yard-256"><a href="#reduce_yard-256"><span class="linenos">256</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_yard-257"><a href="#reduce_yard-257"><span class="linenos">257</span></a>
</span><span id="reduce_yard-258"><a href="#reduce_yard-258"><span class="linenos">258</span></a>    <span class="n">dummy_containers</span> <span class="o">=</span> <span class="p">{</span><span class="n">terminal</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">}</span>
</span><span id="reduce_yard-259"><a href="#reduce_yard-259"><span class="linenos">259</span></a>
</span><span id="reduce_yard-260"><a href="#reduce_yard-260"><span class="linenos">260</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_yard-261"><a href="#reduce_yard-261"><span class="linenos">261</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)):</span>
</span><span id="reduce_yard-262"><a href="#reduce_yard-262"><span class="linenos">262</span></a>            <span class="n">ctr</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">port_yard_container_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
</span><span id="reduce_yard-263"><a href="#reduce_yard-263"><span class="linenos">263</span></a>            <span class="n">dummy_containers</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctr</span><span class="p">)</span>
</span><span id="reduce_yard-264"><a href="#reduce_yard-264"><span class="linenos">264</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_yard-265"><a href="#reduce_yard-265"><span class="linenos">265</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Yard capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> ctrs at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_yard-266"><a href="#reduce_yard-266"><span class="linenos">266</span></a>
</span><span id="reduce_yard-267"><a href="#reduce_yard-267"><span class="linenos">267</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_yard-268"><a href="#reduce_yard-268"><span class="linenos">268</span></a>
</span><span id="reduce_yard-269"><a href="#reduce_yard-269"><span class="linenos">269</span></a>    <span class="c1"># Restore the removed berths to the store</span>
</span><span id="reduce_yard-270"><a href="#reduce_yard-270"><span class="linenos">270</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_yard-271"><a href="#reduce_yard-271"><span class="linenos">271</span></a>        <span class="k">for</span> <span class="n">berth</span> <span class="ow">in</span> <span class="n">dummy_containers</span><span class="p">[</span><span class="n">terminal</span><span class="p">]:</span>
</span><span id="reduce_yard-272"><a href="#reduce_yard-272"><span class="linenos">272</span></a>            <span class="k">yield</span> <span class="n">dummy_containers</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">berth</span><span class="p">)</span>
</span><span id="reduce_yard-273"><a href="#reduce_yard-273"><span class="linenos">273</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_yard-274"><a href="#reduce_yard-274"><span class="linenos">274</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Yard apacity restored by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the yard capacity in each terminal by <code>change</code> amount by adding dummy containers to the terminal's yard store between <code>time_start</code> and <code>time_end</code>.
It also restores the yard capacity after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of yard spaces to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the yard capacity will be reduced.</li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_yard_container_terminals (dict):</strong>  Dictionary containing yard information for the terminals.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_tank_capacity">
                            <input id="reduce_tank_capacity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_tank_capacity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">change</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">time_start</span>,</span><span class="param">	<span class="n">time_end</span>,</span><span class="param">	<span class="n">port_tanks_liquid_terminals</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_tank_capacity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_tank_capacity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_tank_capacity-277"><a href="#reduce_tank_capacity-277"><span class="linenos">277</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_tank_capacity</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">):</span>
</span><span id="reduce_tank_capacity-278"><a href="#reduce_tank_capacity-278"><span class="linenos">278</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_tank_capacity-279"><a href="#reduce_tank_capacity-279"><span class="linenos">279</span></a><span class="sd">    This function reduces the tank capacity in each terminal by `change` amount by adding dummy liquid to the terminal&#39;s tank store between `time_start` and `time_end`.</span>
</span><span id="reduce_tank_capacity-280"><a href="#reduce_tank_capacity-280"><span class="linenos">280</span></a><span class="sd">    It also restores the tank capacity after the reduction period.</span>
</span><span id="reduce_tank_capacity-281"><a href="#reduce_tank_capacity-281"><span class="linenos">281</span></a><span class="sd">    Args:</span>
</span><span id="reduce_tank_capacity-282"><a href="#reduce_tank_capacity-282"><span class="linenos">282</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_tank_capacity-283"><a href="#reduce_tank_capacity-283"><span class="linenos">283</span></a><span class="sd">        change (int): The number of tank spaces to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_tank_capacity-284"><a href="#reduce_tank_capacity-284"><span class="linenos">284</span></a><span class="sd">        terminals (list): List of terminal indices where the tank capacity will be reduced.</span>
</span><span id="reduce_tank_capacity-285"><a href="#reduce_tank_capacity-285"><span class="linenos">285</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_tank_capacity-286"><a href="#reduce_tank_capacity-286"><span class="linenos">286</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="reduce_tank_capacity-287"><a href="#reduce_tank_capacity-287"><span class="linenos">287</span></a><span class="sd">        port_tanks_liquid_terminals (dict): Dictionary containing tank information for the terminals.</span>
</span><span id="reduce_tank_capacity-288"><a href="#reduce_tank_capacity-288"><span class="linenos">288</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_tank_capacity-289"><a href="#reduce_tank_capacity-289"><span class="linenos">289</span></a><span class="sd">        None</span>
</span><span id="reduce_tank_capacity-290"><a href="#reduce_tank_capacity-290"><span class="linenos">290</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_tank_capacity-291"><a href="#reduce_tank_capacity-291"><span class="linenos">291</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_tank_capacity-292"><a href="#reduce_tank_capacity-292"><span class="linenos">292</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> units tank space from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2"> (Adding dummy liquid)&quot;</span><span class="p">)</span>
</span><span id="reduce_tank_capacity-293"><a href="#reduce_tank_capacity-293"><span class="linenos">293</span></a>
</span><span id="reduce_tank_capacity-294"><a href="#reduce_tank_capacity-294"><span class="linenos">294</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_tank_capacity-295"><a href="#reduce_tank_capacity-295"><span class="linenos">295</span></a>
</span><span id="reduce_tank_capacity-296"><a href="#reduce_tank_capacity-296"><span class="linenos">296</span></a>    <span class="c1"># Reduce the content of the tanks</span>
</span><span id="reduce_tank_capacity-297"><a href="#reduce_tank_capacity-297"><span class="linenos">297</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_tank_capacity-298"><a href="#reduce_tank_capacity-298"><span class="linenos">298</span></a>        <span class="k">yield</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="reduce_tank_capacity-299"><a href="#reduce_tank_capacity-299"><span class="linenos">299</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_tank_capacity-300"><a href="#reduce_tank_capacity-300"><span class="linenos">300</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Tank capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_tank_capacity-301"><a href="#reduce_tank_capacity-301"><span class="linenos">301</span></a>
</span><span id="reduce_tank_capacity-302"><a href="#reduce_tank_capacity-302"><span class="linenos">302</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_tank_capacity-303"><a href="#reduce_tank_capacity-303"><span class="linenos">303</span></a>
</span><span id="reduce_tank_capacity-304"><a href="#reduce_tank_capacity-304"><span class="linenos">304</span></a>    <span class="c1"># Restore the content of the tanks</span>
</span><span id="reduce_tank_capacity-305"><a href="#reduce_tank_capacity-305"><span class="linenos">305</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_tank_capacity-306"><a href="#reduce_tank_capacity-306"><span class="linenos">306</span></a>        <span class="k">yield</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="reduce_tank_capacity-307"><a href="#reduce_tank_capacity-307"><span class="linenos">307</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_tank_capacity-308"><a href="#reduce_tank_capacity-308"><span class="linenos">308</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Tank capacity effectively increased by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the tank capacity in each terminal by <code>change</code> amount by adding dummy liquid to the terminal's tank store between <code>time_start</code> and <code>time_end</code>.
It also restores the tank capacity after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of tank spaces to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the tank capacity will be reduced.</li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_tanks_liquid_terminals (dict):</strong>  Dictionary containing tank information for the terminals.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_silo_capacity">
                            <input id="reduce_silo_capacity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_silo_capacity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">change</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">time_start</span>,</span><span class="param">	<span class="n">time_end</span>,</span><span class="param">	<span class="n">port_silos_drybulk_terminals</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_silo_capacity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_silo_capacity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_silo_capacity-311"><a href="#reduce_silo_capacity-311"><span class="linenos">311</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_silo_capacity</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">):</span>
</span><span id="reduce_silo_capacity-312"><a href="#reduce_silo_capacity-312"><span class="linenos">312</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_silo_capacity-313"><a href="#reduce_silo_capacity-313"><span class="linenos">313</span></a><span class="sd">    This function reduces the silo capacity in each terminal by `change` amount by adding dummy dry bulk to the terminal&#39;s silo store between `time_start` and `time_end`.</span>
</span><span id="reduce_silo_capacity-314"><a href="#reduce_silo_capacity-314"><span class="linenos">314</span></a><span class="sd">    It also restores the silo capacity after the reduction period.</span>
</span><span id="reduce_silo_capacity-315"><a href="#reduce_silo_capacity-315"><span class="linenos">315</span></a><span class="sd">    Args:</span>
</span><span id="reduce_silo_capacity-316"><a href="#reduce_silo_capacity-316"><span class="linenos">316</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_silo_capacity-317"><a href="#reduce_silo_capacity-317"><span class="linenos">317</span></a><span class="sd">        change (int): The number of silo spaces to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_silo_capacity-318"><a href="#reduce_silo_capacity-318"><span class="linenos">318</span></a><span class="sd">        terminals (list): List of terminal indices where the silo capacity will be reduced.</span>
</span><span id="reduce_silo_capacity-319"><a href="#reduce_silo_capacity-319"><span class="linenos">319</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_silo_capacity-320"><a href="#reduce_silo_capacity-320"><span class="linenos">320</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="reduce_silo_capacity-321"><a href="#reduce_silo_capacity-321"><span class="linenos">321</span></a><span class="sd">        port_silos_drybulk_terminals (dict): Dictionary containing silo information for the terminals.</span>
</span><span id="reduce_silo_capacity-322"><a href="#reduce_silo_capacity-322"><span class="linenos">322</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_silo_capacity-323"><a href="#reduce_silo_capacity-323"><span class="linenos">323</span></a><span class="sd">        None</span>
</span><span id="reduce_silo_capacity-324"><a href="#reduce_silo_capacity-324"><span class="linenos">324</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_silo_capacity-325"><a href="#reduce_silo_capacity-325"><span class="linenos">325</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_silo_capacity-326"><a href="#reduce_silo_capacity-326"><span class="linenos">326</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> units silo space from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2"> (Adding dummy dry bulk)&quot;</span><span class="p">)</span>
</span><span id="reduce_silo_capacity-327"><a href="#reduce_silo_capacity-327"><span class="linenos">327</span></a>
</span><span id="reduce_silo_capacity-328"><a href="#reduce_silo_capacity-328"><span class="linenos">328</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_silo_capacity-329"><a href="#reduce_silo_capacity-329"><span class="linenos">329</span></a>
</span><span id="reduce_silo_capacity-330"><a href="#reduce_silo_capacity-330"><span class="linenos">330</span></a>    <span class="c1"># Reduce the content of the silos</span>
</span><span id="reduce_silo_capacity-331"><a href="#reduce_silo_capacity-331"><span class="linenos">331</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_silo_capacity-332"><a href="#reduce_silo_capacity-332"><span class="linenos">332</span></a>        <span class="k">yield</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="reduce_silo_capacity-333"><a href="#reduce_silo_capacity-333"><span class="linenos">333</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_silo_capacity-334"><a href="#reduce_silo_capacity-334"><span class="linenos">334</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Silo capacity effectively reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_silo_capacity-335"><a href="#reduce_silo_capacity-335"><span class="linenos">335</span></a>
</span><span id="reduce_silo_capacity-336"><a href="#reduce_silo_capacity-336"><span class="linenos">336</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_silo_capacity-337"><a href="#reduce_silo_capacity-337"><span class="linenos">337</span></a>
</span><span id="reduce_silo_capacity-338"><a href="#reduce_silo_capacity-338"><span class="linenos">338</span></a>    <span class="c1"># Restore the content of the silos</span>
</span><span id="reduce_silo_capacity-339"><a href="#reduce_silo_capacity-339"><span class="linenos">339</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_silo_capacity-340"><a href="#reduce_silo_capacity-340"><span class="linenos">340</span></a>        <span class="k">yield</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="reduce_silo_capacity-341"><a href="#reduce_silo_capacity-341"><span class="linenos">341</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_silo_capacity-342"><a href="#reduce_silo_capacity-342"><span class="linenos">342</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Silo capacity effectively increased by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the silo capacity in each terminal by <code>change</code> amount by adding dummy dry bulk to the terminal's silo store between <code>time_start</code> and <code>time_end</code>.
It also restores the silo capacity after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of silo spaces to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the silo capacity will be reduced.</li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_silos_drybulk_terminals (dict):</strong>  Dictionary containing silo information for the terminals.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_bay_capacity">
                            <input id="reduce_bay_capacity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_bay_capacity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">reduction</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">start_time</span>,</span><span class="param">	<span class="n">end_time</span>,</span><span class="param">	<span class="n">port_loading_bays_liquid_terminals</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_bay_capacity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_bay_capacity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_bay_capacity-345"><a href="#reduce_bay_capacity-345"><span class="linenos">345</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_bay_capacity</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">reduction</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">port_loading_bays_liquid_terminals</span><span class="p">):</span>
</span><span id="reduce_bay_capacity-346"><a href="#reduce_bay_capacity-346"><span class="linenos">346</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_bay_capacity-347"><a href="#reduce_bay_capacity-347"><span class="linenos">347</span></a><span class="sd">    This function reduces the bay capacity in each terminal by `reduction` amount by holding requests for bays in the terminal&#39;s bay store between `start_time` and `end_time`.</span>
</span><span id="reduce_bay_capacity-348"><a href="#reduce_bay_capacity-348"><span class="linenos">348</span></a><span class="sd">    It also restores the bay capacity after the reduction period.</span>
</span><span id="reduce_bay_capacity-349"><a href="#reduce_bay_capacity-349"><span class="linenos">349</span></a><span class="sd">    Args:</span>
</span><span id="reduce_bay_capacity-350"><a href="#reduce_bay_capacity-350"><span class="linenos">350</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_bay_capacity-351"><a href="#reduce_bay_capacity-351"><span class="linenos">351</span></a><span class="sd">        reduction (int): The number of bays to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_bay_capacity-352"><a href="#reduce_bay_capacity-352"><span class="linenos">352</span></a><span class="sd">        terminals (list): List of terminal indices where the bay capacity will be reduced.</span>
</span><span id="reduce_bay_capacity-353"><a href="#reduce_bay_capacity-353"><span class="linenos">353</span></a><span class="sd">        start_time (int): The time at which the reduction starts.</span>
</span><span id="reduce_bay_capacity-354"><a href="#reduce_bay_capacity-354"><span class="linenos">354</span></a><span class="sd">        end_time (int): The time at which the reduction ends.</span>
</span><span id="reduce_bay_capacity-355"><a href="#reduce_bay_capacity-355"><span class="linenos">355</span></a><span class="sd">        port_loading_bays_liquid_terminals (dict): Dictionary containing bay information for the terminals.</span>
</span><span id="reduce_bay_capacity-356"><a href="#reduce_bay_capacity-356"><span class="linenos">356</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_bay_capacity-357"><a href="#reduce_bay_capacity-357"><span class="linenos">357</span></a><span class="sd">        None</span>
</span><span id="reduce_bay_capacity-358"><a href="#reduce_bay_capacity-358"><span class="linenos">358</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_bay_capacity-359"><a href="#reduce_bay_capacity-359"><span class="linenos">359</span></a>
</span><span id="reduce_bay_capacity-360"><a href="#reduce_bay_capacity-360"><span class="linenos">360</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_bay_capacity-361"><a href="#reduce_bay_capacity-361"><span class="linenos">361</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> bays from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_bay_capacity-362"><a href="#reduce_bay_capacity-362"><span class="linenos">362</span></a>
</span><span id="reduce_bay_capacity-363"><a href="#reduce_bay_capacity-363"><span class="linenos">363</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="reduce_bay_capacity-364"><a href="#reduce_bay_capacity-364"><span class="linenos">364</span></a>
</span><span id="reduce_bay_capacity-365"><a href="#reduce_bay_capacity-365"><span class="linenos">365</span></a>    <span class="c1"># Request `reduction` number of bays to reduce the effective capacity</span>
</span><span id="reduce_bay_capacity-366"><a href="#reduce_bay_capacity-366"><span class="linenos">366</span></a>    <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="reduce_bay_capacity-367"><a href="#reduce_bay_capacity-367"><span class="linenos">367</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_bay_capacity-368"><a href="#reduce_bay_capacity-368"><span class="linenos">368</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reduction</span><span class="p">):</span>
</span><span id="reduce_bay_capacity-369"><a href="#reduce_bay_capacity-369"><span class="linenos">369</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">port_loading_bays_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
</span><span id="reduce_bay_capacity-370"><a href="#reduce_bay_capacity-370"><span class="linenos">370</span></a>            <span class="k">yield</span> <span class="n">request</span>  <span class="c1"># Hold this request to reduce availability</span>
</span><span id="reduce_bay_capacity-371"><a href="#reduce_bay_capacity-371"><span class="linenos">371</span></a>            <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">terminal</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</span><span id="reduce_bay_capacity-372"><a href="#reduce_bay_capacity-372"><span class="linenos">372</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_bay_capacity-373"><a href="#reduce_bay_capacity-373"><span class="linenos">373</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> units of bays removed from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_bay_capacity-374"><a href="#reduce_bay_capacity-374"><span class="linenos">374</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="reduce_bay_capacity-375"><a href="#reduce_bay_capacity-375"><span class="linenos">375</span></a>
</span><span id="reduce_bay_capacity-376"><a href="#reduce_bay_capacity-376"><span class="linenos">376</span></a>    <span class="c1"># Release the requests to restore full capacity</span>
</span><span id="reduce_bay_capacity-377"><a href="#reduce_bay_capacity-377"><span class="linenos">377</span></a>    <span class="k">for</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
</span><span id="reduce_bay_capacity-378"><a href="#reduce_bay_capacity-378"><span class="linenos">378</span></a>        <span class="n">port_loading_bays_liquid_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="reduce_bay_capacity-379"><a href="#reduce_bay_capacity-379"><span class="linenos">379</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_bay_capacity-380"><a href="#reduce_bay_capacity-380"><span class="linenos">380</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> units of bays restored from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the bay capacity in each terminal by <code>reduction</code> amount by holding requests for bays in the terminal's bay store between <code>start_time</code> and <code>end_time</code>.
It also restores the bay capacity after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>reduction (int):</strong>  The number of bays to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the bay capacity will be reduced.</li>
<li><strong>start_time (int):</strong>  The time at which the reduction starts.</li>
<li><strong>end_time (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_loading_bays_liquid_terminals (dict):</strong>  Dictionary containing bay information for the terminals.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_chassis">
                            <input id="reduce_chassis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_chassis</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">change</span>,</span><span class="param">	<span class="n">terminals</span>,</span><span class="param">	<span class="n">time_start</span>,</span><span class="param">	<span class="n">time_end</span>,</span><span class="param">	<span class="n">port_chassis_container_terminals</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_chassis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_chassis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_chassis-383"><a href="#reduce_chassis-383"><span class="linenos">383</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_chassis</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="n">port_chassis_container_terminals</span><span class="p">):</span>
</span><span id="reduce_chassis-384"><a href="#reduce_chassis-384"><span class="linenos">384</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_chassis-385"><a href="#reduce_chassis-385"><span class="linenos">385</span></a><span class="sd">    This function reduces the chassis capacity in each terminal by `change` amount by removing chassis from the terminal&#39;s chassis store between `time_start` and `time_end`.</span>
</span><span id="reduce_chassis-386"><a href="#reduce_chassis-386"><span class="linenos">386</span></a><span class="sd">    It also restores the chassis capacity after the reduction period.</span>
</span><span id="reduce_chassis-387"><a href="#reduce_chassis-387"><span class="linenos">387</span></a><span class="sd">    Args:</span>
</span><span id="reduce_chassis-388"><a href="#reduce_chassis-388"><span class="linenos">388</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_chassis-389"><a href="#reduce_chassis-389"><span class="linenos">389</span></a><span class="sd">        change (int): The number of chassis to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_chassis-390"><a href="#reduce_chassis-390"><span class="linenos">390</span></a><span class="sd">        terminals (list): List of terminal indices where the chassis capacity will be reduced.</span>
</span><span id="reduce_chassis-391"><a href="#reduce_chassis-391"><span class="linenos">391</span></a><span class="sd">        time_start (int): The time at which the reduction starts.</span>
</span><span id="reduce_chassis-392"><a href="#reduce_chassis-392"><span class="linenos">392</span></a><span class="sd">        time_end (int): The time at which the reduction ends.</span>
</span><span id="reduce_chassis-393"><a href="#reduce_chassis-393"><span class="linenos">393</span></a><span class="sd">        port_chassis_container_terminals (dict): Dictionary containing chassis information for the terminals.</span>
</span><span id="reduce_chassis-394"><a href="#reduce_chassis-394"><span class="linenos">394</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_chassis-395"><a href="#reduce_chassis-395"><span class="linenos">395</span></a><span class="sd">        None</span>
</span><span id="reduce_chassis-396"><a href="#reduce_chassis-396"><span class="linenos">396</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_chassis-397"><a href="#reduce_chassis-397"><span class="linenos">397</span></a>
</span><span id="reduce_chassis-398"><a href="#reduce_chassis-398"><span class="linenos">398</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_chassis-399"><a href="#reduce_chassis-399"><span class="linenos">399</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">change</span><span class="si">}</span><span class="s2"> chassis from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_chassis-400"><a href="#reduce_chassis-400"><span class="linenos">400</span></a>
</span><span id="reduce_chassis-401"><a href="#reduce_chassis-401"><span class="linenos">401</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_chassis-402"><a href="#reduce_chassis-402"><span class="linenos">402</span></a>
</span><span id="reduce_chassis-403"><a href="#reduce_chassis-403"><span class="linenos">403</span></a>    <span class="c1"># Reduce the content of the silos</span>
</span><span id="reduce_chassis-404"><a href="#reduce_chassis-404"><span class="linenos">404</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_chassis-405"><a href="#reduce_chassis-405"><span class="linenos">405</span></a>        <span class="k">yield</span> <span class="n">port_chassis_container_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="reduce_chassis-406"><a href="#reduce_chassis-406"><span class="linenos">406</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_chassis-407"><a href="#reduce_chassis-407"><span class="linenos">407</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Number of chassis reduced by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_chassis-408"><a href="#reduce_chassis-408"><span class="linenos">408</span></a>
</span><span id="reduce_chassis-409"><a href="#reduce_chassis-409"><span class="linenos">409</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">)</span>
</span><span id="reduce_chassis-410"><a href="#reduce_chassis-410"><span class="linenos">410</span></a>
</span><span id="reduce_chassis-411"><a href="#reduce_chassis-411"><span class="linenos">411</span></a>    <span class="c1"># Restore the content of the silos</span>
</span><span id="reduce_chassis-412"><a href="#reduce_chassis-412"><span class="linenos">412</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_chassis-413"><a href="#reduce_chassis-413"><span class="linenos">413</span></a>        <span class="k">yield</span> <span class="n">port_chassis_container_terminals</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
</span><span id="reduce_chassis-414"><a href="#reduce_chassis-414"><span class="linenos">414</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_chassis-415"><a href="#reduce_chassis-415"><span class="linenos">415</span></a>            <span class="sa">f</span><span class="s2">&quot;Terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2">: Number of chassis increased by </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span><span class="si">}</span><span class="s2"> at time </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the chassis capacity in each terminal by <code>change</code> amount by removing chassis from the terminal's chassis store between <code>time_start</code> and <code>time_end</code>.
It also restores the chassis capacity after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>change (int):</strong>  The number of chassis to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the chassis capacity will be reduced.</li>
<li><strong>time_start (int):</strong>  The time at which the reduction starts.</li>
<li><strong>time_end (int):</strong>  The time at which the reduction ends.</li>
<li><strong>port_chassis_container_terminals (dict):</strong>  Dictionary containing chassis information for the terminals.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="reduce_truck_gates">
                            <input id="reduce_truck_gates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce_truck_gates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">env</span>, </span><span class="param"><span class="n">reduction</span>, </span><span class="param"><span class="n">terminals</span>, </span><span class="param"><span class="n">start_time</span>, </span><span class="param"><span class="n">end_time</span>, </span><span class="param"><span class="n">truck_gates</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="reduce_truck_gates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce_truck_gates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce_truck_gates-418"><a href="#reduce_truck_gates-418"><span class="linenos">418</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce_truck_gates</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">reduction</span><span class="p">,</span> <span class="n">terminals</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">truck_gates</span><span class="p">):</span>
</span><span id="reduce_truck_gates-419"><a href="#reduce_truck_gates-419"><span class="linenos">419</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="reduce_truck_gates-420"><a href="#reduce_truck_gates-420"><span class="linenos">420</span></a><span class="sd">    This function reduces the truck gate capacity in each terminal by `reduction` amount by holding requests for truck gates in the terminal&#39;s truck gate store between `start_time` and `end_time`.</span>
</span><span id="reduce_truck_gates-421"><a href="#reduce_truck_gates-421"><span class="linenos">421</span></a><span class="sd">    It also restores the truck gate capacity after the reduction period.</span>
</span><span id="reduce_truck_gates-422"><a href="#reduce_truck_gates-422"><span class="linenos">422</span></a><span class="sd">    Args:</span>
</span><span id="reduce_truck_gates-423"><a href="#reduce_truck_gates-423"><span class="linenos">423</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="reduce_truck_gates-424"><a href="#reduce_truck_gates-424"><span class="linenos">424</span></a><span class="sd">        reduction (int): The number of truck gates to be removed (negative value) or added (positive value).</span>
</span><span id="reduce_truck_gates-425"><a href="#reduce_truck_gates-425"><span class="linenos">425</span></a><span class="sd">        terminals (list): List of terminal indices where the truck gate capacity will be reduced.</span>
</span><span id="reduce_truck_gates-426"><a href="#reduce_truck_gates-426"><span class="linenos">426</span></a><span class="sd">        start_time (int): The time at which the reduction starts.</span>
</span><span id="reduce_truck_gates-427"><a href="#reduce_truck_gates-427"><span class="linenos">427</span></a><span class="sd">        end_time (int): The time at which the reduction ends.</span>
</span><span id="reduce_truck_gates-428"><a href="#reduce_truck_gates-428"><span class="linenos">428</span></a><span class="sd">        truck_gates (dict): Dictionary containing truck gate information for the terminals.</span>
</span><span id="reduce_truck_gates-429"><a href="#reduce_truck_gates-429"><span class="linenos">429</span></a><span class="sd">    Returns:</span>
</span><span id="reduce_truck_gates-430"><a href="#reduce_truck_gates-430"><span class="linenos">430</span></a><span class="sd">        None</span>
</span><span id="reduce_truck_gates-431"><a href="#reduce_truck_gates-431"><span class="linenos">431</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce_truck_gates-432"><a href="#reduce_truck_gates-432"><span class="linenos">432</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_truck_gates-433"><a href="#reduce_truck_gates-433"><span class="linenos">433</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Attempting to remove </span><span class="si">{</span><span class="o">-</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> truck gates from terminals </span><span class="si">{</span><span class="n">terminals</span><span class="si">}</span><span class="s2"> from time </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_truck_gates-434"><a href="#reduce_truck_gates-434"><span class="linenos">434</span></a>
</span><span id="reduce_truck_gates-435"><a href="#reduce_truck_gates-435"><span class="linenos">435</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="reduce_truck_gates-436"><a href="#reduce_truck_gates-436"><span class="linenos">436</span></a>
</span><span id="reduce_truck_gates-437"><a href="#reduce_truck_gates-437"><span class="linenos">437</span></a>    <span class="c1"># Request `reduction` number of bays to reduce the effective capacity</span>
</span><span id="reduce_truck_gates-438"><a href="#reduce_truck_gates-438"><span class="linenos">438</span></a>    <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="reduce_truck_gates-439"><a href="#reduce_truck_gates-439"><span class="linenos">439</span></a>    <span class="k">for</span> <span class="n">terminal</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
</span><span id="reduce_truck_gates-440"><a href="#reduce_truck_gates-440"><span class="linenos">440</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reduction</span><span class="p">):</span>
</span><span id="reduce_truck_gates-441"><a href="#reduce_truck_gates-441"><span class="linenos">441</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">truck_gates</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
</span><span id="reduce_truck_gates-442"><a href="#reduce_truck_gates-442"><span class="linenos">442</span></a>            <span class="k">yield</span> <span class="n">request</span>  <span class="c1"># Hold this request to reduce availability</span>
</span><span id="reduce_truck_gates-443"><a href="#reduce_truck_gates-443"><span class="linenos">443</span></a>            <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">terminal</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</span><span id="reduce_truck_gates-444"><a href="#reduce_truck_gates-444"><span class="linenos">444</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_truck_gates-445"><a href="#reduce_truck_gates-445"><span class="linenos">445</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> truck gates removed from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="reduce_truck_gates-446"><a href="#reduce_truck_gates-446"><span class="linenos">446</span></a>    <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span><span id="reduce_truck_gates-447"><a href="#reduce_truck_gates-447"><span class="linenos">447</span></a>
</span><span id="reduce_truck_gates-448"><a href="#reduce_truck_gates-448"><span class="linenos">448</span></a>    <span class="c1"># Release the requests to restore full capacity</span>
</span><span id="reduce_truck_gates-449"><a href="#reduce_truck_gates-449"><span class="linenos">449</span></a>    <span class="k">for</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
</span><span id="reduce_truck_gates-450"><a href="#reduce_truck_gates-450"><span class="linenos">450</span></a>        <span class="n">truck_gates</span><span class="p">[</span><span class="n">terminal</span><span class="p">]</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="reduce_truck_gates-451"><a href="#reduce_truck_gates-451"><span class="linenos">451</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="reduce_truck_gates-452"><a href="#reduce_truck_gates-452"><span class="linenos">452</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduction</span><span class="si">}</span><span class="s2"> truck gates restored from terminal </span><span class="si">{</span><span class="n">terminal</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function reduces the truck gate capacity in each terminal by <code>reduction</code> amount by holding requests for truck gates in the terminal's truck gate store between <code>start_time</code> and <code>end_time</code>.
It also restores the truck gate capacity after the reduction period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>reduction (int):</strong>  The number of truck gates to be removed (negative value) or added (positive value).</li>
<li><strong>terminals (list):</strong>  List of terminal indices where the truck gate capacity will be reduced.</li>
<li><strong>start_time (int):</strong>  The time at which the reduction starts.</li>
<li><strong>end_time (int):</strong>  The time at which the reduction ends.</li>
<li><strong>truck_gates (dict):</strong>  Dictionary containing truck gate information for the terminals.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="adjust_arrival_rate">
                            <input id="adjust_arrival_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adjust_arrival_rate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">start_time</span>, </span><span class="param"><span class="n">end_time</span>, </span><span class="param"><span class="n">rate_parameter</span>, </span><span class="param"><span class="n">run_id</span>, </span><span class="param"><span class="n">plot_input</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="adjust_arrival_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#adjust_arrival_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="adjust_arrival_rate-455"><a href="#adjust_arrival_rate-455"><span class="linenos">455</span></a><span class="k">def</span><span class="w"> </span><span class="nf">adjust_arrival_rate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">rate_parameter</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="adjust_arrival_rate-456"><a href="#adjust_arrival_rate-456"><span class="linenos">456</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="adjust_arrival_rate-457"><a href="#adjust_arrival_rate-457"><span class="linenos">457</span></a><span class="sd">    This function adjusts the arrival times of ships in the ship data CSV file by a given rate parameter.</span>
</span><span id="adjust_arrival_rate-458"><a href="#adjust_arrival_rate-458"><span class="linenos">458</span></a><span class="sd">    It modifies the arrival times of ships that fall within the specified time range and saves the updated data back to the CSV file.</span>
</span><span id="adjust_arrival_rate-459"><a href="#adjust_arrival_rate-459"><span class="linenos">459</span></a><span class="sd">    Args:</span>
</span><span id="adjust_arrival_rate-460"><a href="#adjust_arrival_rate-460"><span class="linenos">460</span></a><span class="sd">        start_time (float): The start time of the range to adjust arrival times.</span>
</span><span id="adjust_arrival_rate-461"><a href="#adjust_arrival_rate-461"><span class="linenos">461</span></a><span class="sd">        end_time (float): The end time of the range to adjust arrival times.</span>
</span><span id="adjust_arrival_rate-462"><a href="#adjust_arrival_rate-462"><span class="linenos">462</span></a><span class="sd">        rate_parameter (float): The factor by which to adjust the arrival times.</span>
</span><span id="adjust_arrival_rate-463"><a href="#adjust_arrival_rate-463"><span class="linenos">463</span></a><span class="sd">        run_id (str): The unique identifier for the simulation run.</span>
</span><span id="adjust_arrival_rate-464"><a href="#adjust_arrival_rate-464"><span class="linenos">464</span></a><span class="sd">        plot_input (bool): Whether to plot the input data before and after adjustment.</span>
</span><span id="adjust_arrival_rate-465"><a href="#adjust_arrival_rate-465"><span class="linenos">465</span></a><span class="sd">    returns:</span>
</span><span id="adjust_arrival_rate-466"><a href="#adjust_arrival_rate-466"><span class="linenos">466</span></a><span class="sd">        ship_data_df (pd.DataFrame): The updated ship data DataFrame with adjusted arrival times.</span>
</span><span id="adjust_arrival_rate-467"><a href="#adjust_arrival_rate-467"><span class="linenos">467</span></a><span class="sd">        ship_data (dict): The updated ship data as a dictionary.</span>
</span><span id="adjust_arrival_rate-468"><a href="#adjust_arrival_rate-468"><span class="linenos">468</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="adjust_arrival_rate-469"><a href="#adjust_arrival_rate-469"><span class="linenos">469</span></a>
</span><span id="adjust_arrival_rate-470"><a href="#adjust_arrival_rate-470"><span class="linenos">470</span></a>    <span class="n">ship_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/logs/ship_data.csv&quot;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-471"><a href="#adjust_arrival_rate-471"><span class="linenos">471</span></a>    <span class="n">in_time_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="adjust_arrival_rate-472"><a href="#adjust_arrival_rate-472"><span class="linenos">472</span></a>        <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-473"><a href="#adjust_arrival_rate-473"><span class="linenos">473</span></a>    <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span>
</span><span id="adjust_arrival_rate-474"><a href="#adjust_arrival_rate-474"><span class="linenos">474</span></a>    <span class="n">ship_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_time_range</span><span class="p">,</span> <span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">rate_parameter</span>
</span><span id="adjust_arrival_rate-475"><a href="#adjust_arrival_rate-475"><span class="linenos">475</span></a>
</span><span id="adjust_arrival_rate-476"><a href="#adjust_arrival_rate-476"><span class="linenos">476</span></a>    <span class="n">ship_data_df</span> <span class="o">=</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interarrival&#39;</span><span class="p">])</span>
</span><span id="adjust_arrival_rate-477"><a href="#adjust_arrival_rate-477"><span class="linenos">477</span></a>    <span class="n">ship_data_df</span> <span class="o">=</span> <span class="n">ship_data_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;arrival&#39;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-478"><a href="#adjust_arrival_rate-478"><span class="linenos">478</span></a>    <span class="n">output_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/ship_data.csv&#39;</span>
</span><span id="adjust_arrival_rate-479"><a href="#adjust_arrival_rate-479"><span class="linenos">479</span></a>    <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-480"><a href="#adjust_arrival_rate-480"><span class="linenos">480</span></a>    <span class="n">ship_data</span> <span class="o">=</span> <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-481"><a href="#adjust_arrival_rate-481"><span class="linenos">481</span></a>
</span><span id="adjust_arrival_rate-482"><a href="#adjust_arrival_rate-482"><span class="linenos">482</span></a>    <span class="k">if</span> <span class="n">plot_input</span><span class="p">:</span>
</span><span id="adjust_arrival_rate-483"><a href="#adjust_arrival_rate-483"><span class="linenos">483</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="adjust_arrival_rate-484"><a href="#adjust_arrival_rate-484"><span class="linenos">484</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">],</span>
</span><span id="adjust_arrival_rate-485"><a href="#adjust_arrival_rate-485"><span class="linenos">485</span></a>                     <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-486"><a href="#adjust_arrival_rate-486"><span class="linenos">486</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-487"><a href="#adjust_arrival_rate-487"><span class="linenos">487</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-488"><a href="#adjust_arrival_rate-488"><span class="linenos">488</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Old Arrival Times&#39;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-489"><a href="#adjust_arrival_rate-489"><span class="linenos">489</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="adjust_arrival_rate-490"><a href="#adjust_arrival_rate-490"><span class="linenos">490</span></a>                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-491"><a href="#adjust_arrival_rate-491"><span class="linenos">491</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-492"><a href="#adjust_arrival_rate-492"><span class="linenos">492</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-493"><a href="#adjust_arrival_rate-493"><span class="linenos">493</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;New Arrival Times&#39;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-494"><a href="#adjust_arrival_rate-494"><span class="linenos">494</span></a>        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="adjust_arrival_rate-495"><a href="#adjust_arrival_rate-495"><span class="linenos">495</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="adjust_arrival_rate-496"><a href="#adjust_arrival_rate-496"><span class="linenos">496</span></a>        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="adjust_arrival_rate-497"><a href="#adjust_arrival_rate-497"><span class="linenos">497</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="adjust_arrival_rate-498"><a href="#adjust_arrival_rate-498"><span class="linenos">498</span></a>        <span class="n">min_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="adjust_arrival_rate-499"><a href="#adjust_arrival_rate-499"><span class="linenos">499</span></a>        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="adjust_arrival_rate-500"><a href="#adjust_arrival_rate-500"><span class="linenos">500</span></a>
</span><span id="adjust_arrival_rate-501"><a href="#adjust_arrival_rate-501"><span class="linenos">501</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="adjust_arrival_rate-502"><a href="#adjust_arrival_rate-502"><span class="linenos">502</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-503"><a href="#adjust_arrival_rate-503"><span class="linenos">503</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-504"><a href="#adjust_arrival_rate-504"><span class="linenos">504</span></a>
</span><span id="adjust_arrival_rate-505"><a href="#adjust_arrival_rate-505"><span class="linenos">505</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="adjust_arrival_rate-506"><a href="#adjust_arrival_rate-506"><span class="linenos">506</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/plots/scenarios/factor_arrival_scnario_input&quot;</span><span class="p">)</span>
</span><span id="adjust_arrival_rate-507"><a href="#adjust_arrival_rate-507"><span class="linenos">507</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="adjust_arrival_rate-508"><a href="#adjust_arrival_rate-508"><span class="linenos">508</span></a>
</span><span id="adjust_arrival_rate-509"><a href="#adjust_arrival_rate-509"><span class="linenos">509</span></a>    <span class="k">return</span> <span class="n">ship_data_df</span><span class="p">,</span> <span class="n">ship_data</span>
</span></pre></div>


            <div class="docstring"><p>This function adjusts the arrival times of ships in the ship data CSV file by a given rate parameter.
It modifies the arrival times of ships that fall within the specified time range and saves the updated data back to the CSV file.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>start_time (float):</strong>  The start time of the range to adjust arrival times.</li>
<li><strong>end_time (float):</strong>  The end time of the range to adjust arrival times.</li>
<li><strong>rate_parameter (float):</strong>  The factor by which to adjust the arrival times.</li>
<li><strong>run_id (str):</strong>  The unique identifier for the simulation run.</li>
<li><strong>plot_input (bool):</strong>  Whether to plot the input data before and after adjustment.</li>
</ul>

<p>returns:
    ship_data_df (pd.DataFrame): The updated ship data DataFrame with adjusted arrival times.
    ship_data (dict): The updated ship data as a dictionary.</p>
</div>


                </section>
                <section id="stop_and_bulk_arrival">
                            <input id="stop_and_bulk_arrival-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_and_bulk_arrival</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">start_time</span>, </span><span class="param"><span class="n">end_time</span>, </span><span class="param"><span class="n">run_id</span>, </span><span class="param"><span class="n">plot_input</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="stop_and_bulk_arrival-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stop_and_bulk_arrival"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stop_and_bulk_arrival-512"><a href="#stop_and_bulk_arrival-512"><span class="linenos">512</span></a><span class="k">def</span><span class="w"> </span><span class="nf">stop_and_bulk_arrival</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="stop_and_bulk_arrival-513"><a href="#stop_and_bulk_arrival-513"><span class="linenos">513</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="stop_and_bulk_arrival-514"><a href="#stop_and_bulk_arrival-514"><span class="linenos">514</span></a><span class="sd">    This function modifies the ship arrival times in the ship data CSV file by stopping arrivals between `start_time` and `end_time`.</span>
</span><span id="stop_and_bulk_arrival-515"><a href="#stop_and_bulk_arrival-515"><span class="linenos">515</span></a><span class="sd">    It also simulates a bulk arrival scenario after `end_time` by distributing the arrivals evenly over a recovery period.</span>
</span><span id="stop_and_bulk_arrival-516"><a href="#stop_and_bulk_arrival-516"><span class="linenos">516</span></a><span class="sd">    Args:</span>
</span><span id="stop_and_bulk_arrival-517"><a href="#stop_and_bulk_arrival-517"><span class="linenos">517</span></a><span class="sd">        start_time (float): The start time of the range to stop arrivals.</span>
</span><span id="stop_and_bulk_arrival-518"><a href="#stop_and_bulk_arrival-518"><span class="linenos">518</span></a><span class="sd">        end_time (float): The end time of the range to stop arrivals.</span>
</span><span id="stop_and_bulk_arrival-519"><a href="#stop_and_bulk_arrival-519"><span class="linenos">519</span></a><span class="sd">        run_id (str): The unique identifier for the simulation run.</span>
</span><span id="stop_and_bulk_arrival-520"><a href="#stop_and_bulk_arrival-520"><span class="linenos">520</span></a><span class="sd">        plot_input (bool): Whether to plot the input data before and after adjustment.</span>
</span><span id="stop_and_bulk_arrival-521"><a href="#stop_and_bulk_arrival-521"><span class="linenos">521</span></a><span class="sd">    returns:</span>
</span><span id="stop_and_bulk_arrival-522"><a href="#stop_and_bulk_arrival-522"><span class="linenos">522</span></a><span class="sd">        ship_data_df (pd.DataFrame): The updated ship data DataFrame with adjusted arrival times.</span>
</span><span id="stop_and_bulk_arrival-523"><a href="#stop_and_bulk_arrival-523"><span class="linenos">523</span></a><span class="sd">        ship_data_dict (dict): The updated ship data as a dictionary.</span>
</span><span id="stop_and_bulk_arrival-524"><a href="#stop_and_bulk_arrival-524"><span class="linenos">524</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="stop_and_bulk_arrival-525"><a href="#stop_and_bulk_arrival-525"><span class="linenos">525</span></a>
</span><span id="stop_and_bulk_arrival-526"><a href="#stop_and_bulk_arrival-526"><span class="linenos">526</span></a>    <span class="n">ship_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/ship_data.csv&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-527"><a href="#stop_and_bulk_arrival-527"><span class="linenos">527</span></a>    <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span>
</span><span id="stop_and_bulk_arrival-528"><a href="#stop_and_bulk_arrival-528"><span class="linenos">528</span></a>    <span class="n">in_time_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="stop_and_bulk_arrival-529"><a href="#stop_and_bulk_arrival-529"><span class="linenos">529</span></a>        <span class="n">ship_data</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-530"><a href="#stop_and_bulk_arrival-530"><span class="linenos">530</span></a>
</span><span id="stop_and_bulk_arrival-531"><a href="#stop_and_bulk_arrival-531"><span class="linenos">531</span></a>    <span class="n">num_ships</span> <span class="o">=</span> <span class="n">in_time_range</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="stop_and_bulk_arrival-532"><a href="#stop_and_bulk_arrival-532"><span class="linenos">532</span></a>    <span class="n">recovery_period</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">5</span>  <span class="c1"># 5 days</span>
</span><span id="stop_and_bulk_arrival-533"><a href="#stop_and_bulk_arrival-533"><span class="linenos">533</span></a>    <span class="n">gap</span> <span class="o">=</span> <span class="n">recovery_period</span><span class="o">/</span><span class="n">num_ships</span>
</span><span id="stop_and_bulk_arrival-534"><a href="#stop_and_bulk_arrival-534"><span class="linenos">534</span></a>    <span class="nb">print</span><span class="p">(</span>
</span><span id="stop_and_bulk_arrival-535"><a href="#stop_and_bulk_arrival-535"><span class="linenos">535</span></a>        <span class="sa">f</span><span class="s2">&quot;Modelling disruption: Stopping arrivals between </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2"> and bulk arrivals after </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2"> with a gap of </span><span class="si">{</span><span class="n">gap</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-536"><a href="#stop_and_bulk_arrival-536"><span class="linenos">536</span></a>
</span><span id="stop_and_bulk_arrival-537"><a href="#stop_and_bulk_arrival-537"><span class="linenos">537</span></a>    <span class="n">bulk_arrival_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">+</span> <span class="mf">0.1</span>
</span><span id="stop_and_bulk_arrival-538"><a href="#stop_and_bulk_arrival-538"><span class="linenos">538</span></a>    <span class="n">ship_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_time_range</span><span class="p">,</span> <span class="s1">&#39;arrival&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="stop_and_bulk_arrival-539"><a href="#stop_and_bulk_arrival-539"><span class="linenos">539</span></a>        <span class="n">bulk_arrival_time</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">gap</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">in_time_range</span><span class="o">.</span><span class="n">sum</span><span class="p">())]</span>
</span><span id="stop_and_bulk_arrival-540"><a href="#stop_and_bulk_arrival-540"><span class="linenos">540</span></a>    <span class="k">if</span> <span class="s1">&#39;interarrival&#39;</span> <span class="ow">in</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="stop_and_bulk_arrival-541"><a href="#stop_and_bulk_arrival-541"><span class="linenos">541</span></a>        <span class="n">ship_data</span> <span class="o">=</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interarrival&#39;</span><span class="p">])</span>
</span><span id="stop_and_bulk_arrival-542"><a href="#stop_and_bulk_arrival-542"><span class="linenos">542</span></a>    <span class="n">ship_data_df</span> <span class="o">=</span> <span class="n">ship_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;arrival&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-543"><a href="#stop_and_bulk_arrival-543"><span class="linenos">543</span></a>    <span class="n">output_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/ship_data.csv&#39;</span>
</span><span id="stop_and_bulk_arrival-544"><a href="#stop_and_bulk_arrival-544"><span class="linenos">544</span></a>    <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-545"><a href="#stop_and_bulk_arrival-545"><span class="linenos">545</span></a>    <span class="n">ship_data_dict</span> <span class="o">=</span> <span class="n">ship_data_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-546"><a href="#stop_and_bulk_arrival-546"><span class="linenos">546</span></a>
</span><span id="stop_and_bulk_arrival-547"><a href="#stop_and_bulk_arrival-547"><span class="linenos">547</span></a>    <span class="k">if</span> <span class="n">plot_input</span><span class="p">:</span>
</span><span id="stop_and_bulk_arrival-548"><a href="#stop_and_bulk_arrival-548"><span class="linenos">548</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="stop_and_bulk_arrival-549"><a href="#stop_and_bulk_arrival-549"><span class="linenos">549</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">],</span>
</span><span id="stop_and_bulk_arrival-550"><a href="#stop_and_bulk_arrival-550"><span class="linenos">550</span></a>                     <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-551"><a href="#stop_and_bulk_arrival-551"><span class="linenos">551</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-552"><a href="#stop_and_bulk_arrival-552"><span class="linenos">552</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-553"><a href="#stop_and_bulk_arrival-553"><span class="linenos">553</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Old Arrival Times&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-554"><a href="#stop_and_bulk_arrival-554"><span class="linenos">554</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span id="stop_and_bulk_arrival-555"><a href="#stop_and_bulk_arrival-555"><span class="linenos">555</span></a>                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-556"><a href="#stop_and_bulk_arrival-556"><span class="linenos">556</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Arrival Time&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-557"><a href="#stop_and_bulk_arrival-557"><span class="linenos">557</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-558"><a href="#stop_and_bulk_arrival-558"><span class="linenos">558</span></a>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;New Arrival Times&#39;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-559"><a href="#stop_and_bulk_arrival-559"><span class="linenos">559</span></a>        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="stop_and_bulk_arrival-560"><a href="#stop_and_bulk_arrival-560"><span class="linenos">560</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="stop_and_bulk_arrival-561"><a href="#stop_and_bulk_arrival-561"><span class="linenos">561</span></a>        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;old_arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="stop_and_bulk_arrival-562"><a href="#stop_and_bulk_arrival-562"><span class="linenos">562</span></a>                    <span class="n">ship_data_df</span><span class="p">[</span><span class="s1">&#39;arrival&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="stop_and_bulk_arrival-563"><a href="#stop_and_bulk_arrival-563"><span class="linenos">563</span></a>        <span class="n">min_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="stop_and_bulk_arrival-564"><a href="#stop_and_bulk_arrival-564"><span class="linenos">564</span></a>        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="stop_and_bulk_arrival-565"><a href="#stop_and_bulk_arrival-565"><span class="linenos">565</span></a>
</span><span id="stop_and_bulk_arrival-566"><a href="#stop_and_bulk_arrival-566"><span class="linenos">566</span></a>        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
</span><span id="stop_and_bulk_arrival-567"><a href="#stop_and_bulk_arrival-567"><span class="linenos">567</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-568"><a href="#stop_and_bulk_arrival-568"><span class="linenos">568</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-569"><a href="#stop_and_bulk_arrival-569"><span class="linenos">569</span></a>
</span><span id="stop_and_bulk_arrival-570"><a href="#stop_and_bulk_arrival-570"><span class="linenos">570</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="stop_and_bulk_arrival-571"><a href="#stop_and_bulk_arrival-571"><span class="linenos">571</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2">/plots/scenarios/bulk_arrival_scenario_input&quot;</span><span class="p">)</span>
</span><span id="stop_and_bulk_arrival-572"><a href="#stop_and_bulk_arrival-572"><span class="linenos">572</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="stop_and_bulk_arrival-573"><a href="#stop_and_bulk_arrival-573"><span class="linenos">573</span></a>
</span><span id="stop_and_bulk_arrival-574"><a href="#stop_and_bulk_arrival-574"><span class="linenos">574</span></a>    <span class="k">return</span> <span class="n">ship_data_df</span><span class="p">,</span> <span class="n">ship_data_dict</span>
</span></pre></div>


            <div class="docstring"><p>This function modifies the ship arrival times in the ship data CSV file by stopping arrivals between <code>start_time</code> and <code>end_time</code>.
It also simulates a bulk arrival scenario after <code>end_time</code> by distributing the arrivals evenly over a recovery period.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>start_time (float):</strong>  The start time of the range to stop arrivals.</li>
<li><strong>end_time (float):</strong>  The end time of the range to stop arrivals.</li>
<li><strong>run_id (str):</strong>  The unique identifier for the simulation run.</li>
<li><strong>plot_input (bool):</strong>  Whether to plot the input data before and after adjustment.</li>
</ul>

<p>returns:
    ship_data_df (pd.DataFrame): The updated ship data DataFrame with adjusted arrival times.
    ship_data_dict (dict): The updated ship data as a dictionary.</p>
</div>


                </section>
                <section id="filter_data_by_arrival_rate">
                            <input id="filter_data_by_arrival_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_data_by_arrival_rate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">time_arrival_dict</span>, </span><span class="param"><span class="n">time_column</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="filter_data_by_arrival_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#filter_data_by_arrival_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="filter_data_by_arrival_rate-577"><a href="#filter_data_by_arrival_rate-577"><span class="linenos">577</span></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_data_by_arrival_rate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">,</span> <span class="n">time_column</span><span class="p">):</span>
</span><span id="filter_data_by_arrival_rate-578"><a href="#filter_data_by_arrival_rate-578"><span class="linenos">578</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="filter_data_by_arrival_rate-579"><a href="#filter_data_by_arrival_rate-579"><span class="linenos">579</span></a><span class="sd">    Filter data based on arrival rate factors for different time periods.</span>
</span><span id="filter_data_by_arrival_rate-580"><a href="#filter_data_by_arrival_rate-580"><span class="linenos">580</span></a><span class="sd">    </span>
</span><span id="filter_data_by_arrival_rate-581"><a href="#filter_data_by_arrival_rate-581"><span class="linenos">581</span></a><span class="sd">    Parameters:</span>
</span><span id="filter_data_by_arrival_rate-582"><a href="#filter_data_by_arrival_rate-582"><span class="linenos">582</span></a><span class="sd">    -----------</span>
</span><span id="filter_data_by_arrival_rate-583"><a href="#filter_data_by_arrival_rate-583"><span class="linenos">583</span></a><span class="sd">    data : pd.DataFrame</span>
</span><span id="filter_data_by_arrival_rate-584"><a href="#filter_data_by_arrival_rate-584"><span class="linenos">584</span></a><span class="sd">        The dataframe to filter (truck_data or train_data)</span>
</span><span id="filter_data_by_arrival_rate-585"><a href="#filter_data_by_arrival_rate-585"><span class="linenos">585</span></a><span class="sd">    time_arrival_dict : dict</span>
</span><span id="filter_data_by_arrival_rate-586"><a href="#filter_data_by_arrival_rate-586"><span class="linenos">586</span></a><span class="sd">        Dictionary with (start_time, end_time): arrival_rate_factor</span>
</span><span id="filter_data_by_arrival_rate-587"><a href="#filter_data_by_arrival_rate-587"><span class="linenos">587</span></a><span class="sd">        e.g., {(6.0, 10.0): 0.8, (10.0, 15.0): 0.6}</span>
</span><span id="filter_data_by_arrival_rate-588"><a href="#filter_data_by_arrival_rate-588"><span class="linenos">588</span></a><span class="sd">        arrival_rate_factor of 0.8 means keep 80% of data (remove 20%)</span>
</span><span id="filter_data_by_arrival_rate-589"><a href="#filter_data_by_arrival_rate-589"><span class="linenos">589</span></a><span class="sd">    time_column : str</span>
</span><span id="filter_data_by_arrival_rate-590"><a href="#filter_data_by_arrival_rate-590"><span class="linenos">590</span></a><span class="sd">        Name of the time column to use for filtering</span>
</span><span id="filter_data_by_arrival_rate-591"><a href="#filter_data_by_arrival_rate-591"><span class="linenos">591</span></a><span class="sd">        (&#39;arrival_time&#39; for trucks, &#39;arrival at&#39; for trains)</span>
</span><span id="filter_data_by_arrival_rate-592"><a href="#filter_data_by_arrival_rate-592"><span class="linenos">592</span></a><span class="sd">    </span>
</span><span id="filter_data_by_arrival_rate-593"><a href="#filter_data_by_arrival_rate-593"><span class="linenos">593</span></a><span class="sd">    Returns:</span>
</span><span id="filter_data_by_arrival_rate-594"><a href="#filter_data_by_arrival_rate-594"><span class="linenos">594</span></a><span class="sd">    --------</span>
</span><span id="filter_data_by_arrival_rate-595"><a href="#filter_data_by_arrival_rate-595"><span class="linenos">595</span></a><span class="sd">    pd.DataFrame</span>
</span><span id="filter_data_by_arrival_rate-596"><a href="#filter_data_by_arrival_rate-596"><span class="linenos">596</span></a><span class="sd">        Filtered dataframe with specified removal rates applied</span>
</span><span id="filter_data_by_arrival_rate-597"><a href="#filter_data_by_arrival_rate-597"><span class="linenos">597</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="filter_data_by_arrival_rate-598"><a href="#filter_data_by_arrival_rate-598"><span class="linenos">598</span></a>    
</span><span id="filter_data_by_arrival_rate-599"><a href="#filter_data_by_arrival_rate-599"><span class="linenos">599</span></a>    <span class="c1"># Create a copy to avoid modifying original data</span>
</span><span id="filter_data_by_arrival_rate-600"><a href="#filter_data_by_arrival_rate-600"><span class="linenos">600</span></a>    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="filter_data_by_arrival_rate-601"><a href="#filter_data_by_arrival_rate-601"><span class="linenos">601</span></a>    
</span><span id="filter_data_by_arrival_rate-602"><a href="#filter_data_by_arrival_rate-602"><span class="linenos">602</span></a>    <span class="c1"># Track which rows to keep</span>
</span><span id="filter_data_by_arrival_rate-603"><a href="#filter_data_by_arrival_rate-603"><span class="linenos">603</span></a>    <span class="c1"># keep_mask = pd.Series([True] * len(filtered_data))</span>
</span><span id="filter_data_by_arrival_rate-604"><a href="#filter_data_by_arrival_rate-604"><span class="linenos">604</span></a>
</span><span id="filter_data_by_arrival_rate-605"><a href="#filter_data_by_arrival_rate-605"><span class="linenos">605</span></a>    <span class="n">keep_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">filtered_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="filter_data_by_arrival_rate-606"><a href="#filter_data_by_arrival_rate-606"><span class="linenos">606</span></a>
</span><span id="filter_data_by_arrival_rate-607"><a href="#filter_data_by_arrival_rate-607"><span class="linenos">607</span></a>    
</span><span id="filter_data_by_arrival_rate-608"><a href="#filter_data_by_arrival_rate-608"><span class="linenos">608</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">),</span> <span class="n">arrival_rate_factor</span> <span class="ow">in</span> <span class="n">time_arrival_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="filter_data_by_arrival_rate-609"><a href="#filter_data_by_arrival_rate-609"><span class="linenos">609</span></a>        <span class="c1"># Find rows in this time window</span>
</span><span id="filter_data_by_arrival_rate-610"><a href="#filter_data_by_arrival_rate-610"><span class="linenos">610</span></a>        <span class="n">time_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">filtered_data</span><span class="p">[</span><span class="n">time_column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="filter_data_by_arrival_rate-611"><a href="#filter_data_by_arrival_rate-611"><span class="linenos">611</span></a>        <span class="n">rows_in_window</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">time_mask</span><span class="p">]</span>
</span><span id="filter_data_by_arrival_rate-612"><a href="#filter_data_by_arrival_rate-612"><span class="linenos">612</span></a>        
</span><span id="filter_data_by_arrival_rate-613"><a href="#filter_data_by_arrival_rate-613"><span class="linenos">613</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows_in_window</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="filter_data_by_arrival_rate-614"><a href="#filter_data_by_arrival_rate-614"><span class="linenos">614</span></a>            <span class="k">continue</span>
</span><span id="filter_data_by_arrival_rate-615"><a href="#filter_data_by_arrival_rate-615"><span class="linenos">615</span></a>        
</span><span id="filter_data_by_arrival_rate-616"><a href="#filter_data_by_arrival_rate-616"><span class="linenos">616</span></a>        <span class="c1"># Calculate how many rows to remove</span>
</span><span id="filter_data_by_arrival_rate-617"><a href="#filter_data_by_arrival_rate-617"><span class="linenos">617</span></a>        <span class="n">removal_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">arrival_rate_factor</span>
</span><span id="filter_data_by_arrival_rate-618"><a href="#filter_data_by_arrival_rate-618"><span class="linenos">618</span></a>        <span class="n">num_to_remove</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_in_window</span><span class="p">)</span> <span class="o">*</span> <span class="n">removal_rate</span><span class="p">)</span>
</span><span id="filter_data_by_arrival_rate-619"><a href="#filter_data_by_arrival_rate-619"><span class="linenos">619</span></a>        
</span><span id="filter_data_by_arrival_rate-620"><a href="#filter_data_by_arrival_rate-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="n">num_to_remove</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="filter_data_by_arrival_rate-621"><a href="#filter_data_by_arrival_rate-621"><span class="linenos">621</span></a>            <span class="c1"># Get indices of rows in this window</span>
</span><span id="filter_data_by_arrival_rate-622"><a href="#filter_data_by_arrival_rate-622"><span class="linenos">622</span></a>            <span class="n">window_indices</span> <span class="o">=</span> <span class="n">rows_in_window</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="filter_data_by_arrival_rate-623"><a href="#filter_data_by_arrival_rate-623"><span class="linenos">623</span></a>            
</span><span id="filter_data_by_arrival_rate-624"><a href="#filter_data_by_arrival_rate-624"><span class="linenos">624</span></a>            <span class="c1"># Create equispaced removal indices</span>
</span><span id="filter_data_by_arrival_rate-625"><a href="#filter_data_by_arrival_rate-625"><span class="linenos">625</span></a>            <span class="c1"># We remove equispaced samples to maintain temporal distribution</span>
</span><span id="filter_data_by_arrival_rate-626"><a href="#filter_data_by_arrival_rate-626"><span class="linenos">626</span></a>            <span class="n">removal_step</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_indices</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_to_remove</span> <span class="k">if</span> <span class="n">num_to_remove</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_indices</span><span class="p">)</span>
</span><span id="filter_data_by_arrival_rate-627"><a href="#filter_data_by_arrival_rate-627"><span class="linenos">627</span></a>            <span class="n">removal_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="filter_data_by_arrival_rate-628"><a href="#filter_data_by_arrival_rate-628"><span class="linenos">628</span></a>            
</span><span id="filter_data_by_arrival_rate-629"><a href="#filter_data_by_arrival_rate-629"><span class="linenos">629</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_remove</span><span class="p">):</span>
</span><span id="filter_data_by_arrival_rate-630"><a href="#filter_data_by_arrival_rate-630"><span class="linenos">630</span></a>                <span class="n">idx_position</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">removal_step</span><span class="p">)</span>
</span><span id="filter_data_by_arrival_rate-631"><a href="#filter_data_by_arrival_rate-631"><span class="linenos">631</span></a>                <span class="k">if</span> <span class="n">idx_position</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_indices</span><span class="p">):</span>
</span><span id="filter_data_by_arrival_rate-632"><a href="#filter_data_by_arrival_rate-632"><span class="linenos">632</span></a>                    <span class="n">removal_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">window_indices</span><span class="p">[</span><span class="n">idx_position</span><span class="p">])</span>
</span><span id="filter_data_by_arrival_rate-633"><a href="#filter_data_by_arrival_rate-633"><span class="linenos">633</span></a>            
</span><span id="filter_data_by_arrival_rate-634"><a href="#filter_data_by_arrival_rate-634"><span class="linenos">634</span></a>            <span class="c1"># Mark these indices for removal</span>
</span><span id="filter_data_by_arrival_rate-635"><a href="#filter_data_by_arrival_rate-635"><span class="linenos">635</span></a>            <span class="n">keep_mask</span><span class="p">[</span><span class="n">removal_indices</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="filter_data_by_arrival_rate-636"><a href="#filter_data_by_arrival_rate-636"><span class="linenos">636</span></a>    
</span><span id="filter_data_by_arrival_rate-637"><a href="#filter_data_by_arrival_rate-637"><span class="linenos">637</span></a>    <span class="c1"># Apply the filter</span>
</span><span id="filter_data_by_arrival_rate-638"><a href="#filter_data_by_arrival_rate-638"><span class="linenos">638</span></a>    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
</span><span id="filter_data_by_arrival_rate-639"><a href="#filter_data_by_arrival_rate-639"><span class="linenos">639</span></a>    
</span><span id="filter_data_by_arrival_rate-640"><a href="#filter_data_by_arrival_rate-640"><span class="linenos">640</span></a>    <span class="k">return</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Filter data based on arrival rate factors for different time periods.</p>

<h2 id="parameters">Parameters:</h2>

<p>data : pd.DataFrame
    The dataframe to filter (truck_data or train_data)
time_arrival_dict : dict
    Dictionary with (start_time, end_time): arrival_rate_factor
    e.g., {(6.0, 10.0): 0.8, (10.0, 15.0): 0.6}
    arrival_rate_factor of 0.8 means keep 80% of data (remove 20%)
time_column : str
    Name of the time column to use for filtering
    ('arrival_time' for trucks, 'arrival at' for trains)</p>

<h2 id="returns">Returns:</h2>

<p>pd.DataFrame
    Filtered dataframe with specified removal rates applied</p>
</div>


                </section>
                <section id="filter_truck_data">
                            <input id="filter_truck_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_truck_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">run_id</span>, </span><span class="param"><span class="n">time_arrival_dict</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="filter_truck_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#filter_truck_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="filter_truck_data-642"><a href="#filter_truck_data-642"><span class="linenos">642</span></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_truck_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">):</span>
</span><span id="filter_truck_data-643"><a href="#filter_truck_data-643"><span class="linenos">643</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="filter_truck_data-644"><a href="#filter_truck_data-644"><span class="linenos">644</span></a><span class="sd">    Filter truck data based on arrival rate factors.</span>
</span><span id="filter_truck_data-645"><a href="#filter_truck_data-645"><span class="linenos">645</span></a><span class="sd">    </span>
</span><span id="filter_truck_data-646"><a href="#filter_truck_data-646"><span class="linenos">646</span></a><span class="sd">    Parameters:</span>
</span><span id="filter_truck_data-647"><a href="#filter_truck_data-647"><span class="linenos">647</span></a><span class="sd">    -----------</span>
</span><span id="filter_truck_data-648"><a href="#filter_truck_data-648"><span class="linenos">648</span></a><span class="sd">    run_id : str</span>
</span><span id="filter_truck_data-649"><a href="#filter_truck_data-649"><span class="linenos">649</span></a><span class="sd">        Unique identifier for the simulation run</span>
</span><span id="filter_truck_data-650"><a href="#filter_truck_data-650"><span class="linenos">650</span></a><span class="sd">    time_arrival_dict : dict</span>
</span><span id="filter_truck_data-651"><a href="#filter_truck_data-651"><span class="linenos">651</span></a><span class="sd">        Dictionary with (start_time, end_time): arrival_rate_factor</span>
</span><span id="filter_truck_data-652"><a href="#filter_truck_data-652"><span class="linenos">652</span></a><span class="sd">    </span>
</span><span id="filter_truck_data-653"><a href="#filter_truck_data-653"><span class="linenos">653</span></a><span class="sd">    Returns:</span>
</span><span id="filter_truck_data-654"><a href="#filter_truck_data-654"><span class="linenos">654</span></a><span class="sd">    --------</span>
</span><span id="filter_truck_data-655"><a href="#filter_truck_data-655"><span class="linenos">655</span></a><span class="sd">    pd.DataFrame</span>
</span><span id="filter_truck_data-656"><a href="#filter_truck_data-656"><span class="linenos">656</span></a><span class="sd">        Filtered truck dataframe</span>
</span><span id="filter_truck_data-657"><a href="#filter_truck_data-657"><span class="linenos">657</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="filter_truck_data-658"><a href="#filter_truck_data-658"><span class="linenos">658</span></a>    <span class="n">truck_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/truck_data.pkl&#39;</span><span class="p">)</span>
</span><span id="filter_truck_data-659"><a href="#filter_truck_data-659"><span class="linenos">659</span></a>    <span class="n">updated_truck_data_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/truck_data.pkl&#39;</span>
</span><span id="filter_truck_data-660"><a href="#filter_truck_data-660"><span class="linenos">660</span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">truck_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="filter_truck_data-661"><a href="#filter_truck_data-661"><span class="linenos">661</span></a>    <span class="n">filtered_truck_data</span> <span class="o">=</span> <span class="n">filter_data_by_arrival_rate</span><span class="p">(</span><span class="n">truck_data</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">,</span> <span class="s1">&#39;arrival&#39;</span><span class="p">)</span>
</span><span id="filter_truck_data-662"><a href="#filter_truck_data-662"><span class="linenos">662</span></a>    <span class="n">filtered_truck_data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">updated_truck_data_path</span><span class="p">)</span>
</span><span id="filter_truck_data-663"><a href="#filter_truck_data-663"><span class="linenos">663</span></a>    <span class="k">return</span> <span class="n">filtered_truck_data</span>
</span></pre></div>


            <div class="docstring"><p>Filter truck data based on arrival rate factors.</p>

<h2 id="parameters">Parameters:</h2>

<p>run_id : str
    Unique identifier for the simulation run
time_arrival_dict : dict
    Dictionary with (start_time, end_time): arrival_rate_factor</p>

<h2 id="returns">Returns:</h2>

<p>pd.DataFrame
    Filtered truck dataframe</p>
</div>


                </section>
                <section id="filter_train_data">
                            <input id="filter_train_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_train_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">run_id</span>, </span><span class="param"><span class="n">time_arrival_dict</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="filter_train_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#filter_train_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="filter_train_data-665"><a href="#filter_train_data-665"><span class="linenos">665</span></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_train_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">):</span>
</span><span id="filter_train_data-666"><a href="#filter_train_data-666"><span class="linenos">666</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="filter_train_data-667"><a href="#filter_train_data-667"><span class="linenos">667</span></a><span class="sd">    Filter train data based on arrival rate factors.</span>
</span><span id="filter_train_data-668"><a href="#filter_train_data-668"><span class="linenos">668</span></a><span class="sd">    </span>
</span><span id="filter_train_data-669"><a href="#filter_train_data-669"><span class="linenos">669</span></a><span class="sd">    Parameters:</span>
</span><span id="filter_train_data-670"><a href="#filter_train_data-670"><span class="linenos">670</span></a><span class="sd">    -----------</span>
</span><span id="filter_train_data-671"><a href="#filter_train_data-671"><span class="linenos">671</span></a><span class="sd">    run_id : str</span>
</span><span id="filter_train_data-672"><a href="#filter_train_data-672"><span class="linenos">672</span></a><span class="sd">        Unique identifier for the simulation run</span>
</span><span id="filter_train_data-673"><a href="#filter_train_data-673"><span class="linenos">673</span></a><span class="sd">    time_arrival_dict : dict</span>
</span><span id="filter_train_data-674"><a href="#filter_train_data-674"><span class="linenos">674</span></a><span class="sd">        Dictionary with (start_time, end_time): arrival_rate_factor</span>
</span><span id="filter_train_data-675"><a href="#filter_train_data-675"><span class="linenos">675</span></a><span class="sd">    </span>
</span><span id="filter_train_data-676"><a href="#filter_train_data-676"><span class="linenos">676</span></a><span class="sd">    Returns:</span>
</span><span id="filter_train_data-677"><a href="#filter_train_data-677"><span class="linenos">677</span></a><span class="sd">    --------</span>
</span><span id="filter_train_data-678"><a href="#filter_train_data-678"><span class="linenos">678</span></a><span class="sd">    pd.DataFrame</span>
</span><span id="filter_train_data-679"><a href="#filter_train_data-679"><span class="linenos">679</span></a><span class="sd">        Filtered train dataframe</span>
</span><span id="filter_train_data-680"><a href="#filter_train_data-680"><span class="linenos">680</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="filter_train_data-681"><a href="#filter_train_data-681"><span class="linenos">681</span></a>    <span class="n">train_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/train_data.csv&#39;</span><span class="p">)</span>
</span><span id="filter_train_data-682"><a href="#filter_train_data-682"><span class="linenos">682</span></a>    <span class="n">updated_train_data_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s1">/logs/train_data.csv&#39;</span>
</span><span id="filter_train_data-683"><a href="#filter_train_data-683"><span class="linenos">683</span></a>    <span class="n">filtered_train_data</span> <span class="o">=</span> <span class="n">filter_data_by_arrival_rate</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">time_arrival_dict</span><span class="p">,</span> <span class="s1">&#39;arrival at&#39;</span><span class="p">)</span>
</span><span id="filter_train_data-684"><a href="#filter_train_data-684"><span class="linenos">684</span></a>    <span class="n">filtered_train_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">updated_train_data_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="filter_train_data-685"><a href="#filter_train_data-685"><span class="linenos">685</span></a>    <span class="k">return</span> <span class="n">filtered_train_data</span>
</span></pre></div>


            <div class="docstring"><p>Filter train data based on arrival rate factors.</p>

<h2 id="parameters">Parameters:</h2>

<p>run_id : str
    Unique identifier for the simulation run
time_arrival_dict : dict
    Dictionary with (start_time, end_time): arrival_rate_factor</p>

<h2 id="returns">Returns:</h2>

<p>pd.DataFrame
    Filtered train dataframe</p>
</div>


                </section>
                <section id="model_hurricane">
                            <input id="model_hurricane-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">model_hurricane</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">env</span>,</span><span class="param">	<span class="n">terminal_resouces</span>,</span><span class="param">	<span class="n">num_terminals_list</span>,</span><span class="param">	<span class="n">terminal_data</span>,</span><span class="param">	<span class="n">run_id</span>,</span><span class="param">	<span class="n">seed</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="model_hurricane-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#model_hurricane"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="model_hurricane-687"><a href="#model_hurricane-687"><span class="linenos">687</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_hurricane</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">terminal_resouces</span><span class="p">,</span> <span class="n">num_terminals_list</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
</span><span id="model_hurricane-688"><a href="#model_hurricane-688"><span class="linenos">688</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="model_hurricane-689"><a href="#model_hurricane-689"><span class="linenos">689</span></a><span class="sd">    This function models a hurricane scenario by reducing the number of berths, cranes, pipelines, and conveyors in the port terminals.</span>
</span><span id="model_hurricane-690"><a href="#model_hurricane-690"><span class="linenos">690</span></a><span class="sd">    It simulates the disruption by adjusting the resources available in the terminals between specified time periods.</span>
</span><span id="model_hurricane-691"><a href="#model_hurricane-691"><span class="linenos">691</span></a><span class="sd">    Specificcally, the following changes are made:</span>
</span><span id="model_hurricane-692"><a href="#model_hurricane-692"><span class="linenos">692</span></a><span class="sd">    - Reduces the number of berths in all container terminals by 1 from time 1165 to 2004.</span>
</span><span id="model_hurricane-693"><a href="#model_hurricane-693"><span class="linenos">693</span></a><span class="sd">    - Reduces the number of berths in 10% of liquid and dry bulk terminals by 1 from time 1165 to 2004.</span>
</span><span id="model_hurricane-694"><a href="#model_hurricane-694"><span class="linenos">694</span></a><span class="sd">    - Reduces the number of cranes in all container terminals by 1 from time 1165 to 2340.</span>
</span><span id="model_hurricane-695"><a href="#model_hurricane-695"><span class="linenos">695</span></a><span class="sd">    - Reduces the number of pipelines in 25% of liquid terminals by 1 from time 1165 to 2340.</span>
</span><span id="model_hurricane-696"><a href="#model_hurricane-696"><span class="linenos">696</span></a><span class="sd">    - Reduces the number of conveyors in 25% of dry bulk terminals by 1 from time 1165 to 2340.</span>
</span><span id="model_hurricane-697"><a href="#model_hurricane-697"><span class="linenos">697</span></a><span class="sd">    Args:</span>
</span><span id="model_hurricane-698"><a href="#model_hurricane-698"><span class="linenos">698</span></a><span class="sd">        env (simpy.Environment): The simulation environment.</span>
</span><span id="model_hurricane-699"><a href="#model_hurricane-699"><span class="linenos">699</span></a><span class="sd">        terminal_resouces (tuple): A tuple containing the resources for the port terminals.</span>
</span><span id="model_hurricane-700"><a href="#model_hurricane-700"><span class="linenos">700</span></a><span class="sd">        num_terminals_list (list): A list containing the number of container, liquid, and dry bulk terminals.</span>
</span><span id="model_hurricane-701"><a href="#model_hurricane-701"><span class="linenos">701</span></a><span class="sd">        terminal_data (dict): A dictionary containing terminal data for crane transfer rates.</span>
</span><span id="model_hurricane-702"><a href="#model_hurricane-702"><span class="linenos">702</span></a><span class="sd">        run_id (str): The unique identifier for the simulation run.</span>
</span><span id="model_hurricane-703"><a href="#model_hurricane-703"><span class="linenos">703</span></a><span class="sd">        seed (int): The random seed for reproducibility.</span>
</span><span id="model_hurricane-704"><a href="#model_hurricane-704"><span class="linenos">704</span></a><span class="sd">    returns:</span>
</span><span id="model_hurricane-705"><a href="#model_hurricane-705"><span class="linenos">705</span></a><span class="sd">        None</span>
</span><span id="model_hurricane-706"><a href="#model_hurricane-706"><span class="linenos">706</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="model_hurricane-707"><a href="#model_hurricane-707"><span class="linenos">707</span></a>
</span><span id="model_hurricane-708"><a href="#model_hurricane-708"><span class="linenos">708</span></a>    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="model_hurricane-709"><a href="#model_hurricane-709"><span class="linenos">709</span></a>
</span><span id="model_hurricane-710"><a href="#model_hurricane-710"><span class="linenos">710</span></a>    <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">port_yard_container_terminals</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">port_tanks_liquid_terminals</span><span class="p">,</span> \
</span><span id="model_hurricane-711"><a href="#model_hurricane-711"><span class="linenos">711</span></a>        <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">port_silos_drybulk_terminals</span><span class="p">,</span> <span class="n">port_loading_bays_liquid_terminals</span><span class="p">,</span> <span class="n">port_drybulk_bays_drybulk_terminals</span><span class="p">,</span> \
</span><span id="model_hurricane-712"><a href="#model_hurricane-712"><span class="linenos">712</span></a>        <span class="n">port_chassis_container_terminals</span><span class="p">,</span> <span class="n">truck_gates_ctr</span><span class="p">,</span> <span class="n">truck_gates_liquid</span><span class="p">,</span> <span class="n">truck_gates_dk</span><span class="p">,</span> <span class="n">train_loading_racks_ctr</span><span class="p">,</span> <span class="n">train_loading_racks_liquid</span><span class="p">,</span> \
</span><span id="model_hurricane-713"><a href="#model_hurricane-713"><span class="linenos">713</span></a>        <span class="n">train_loading_racks_dk</span><span class="p">,</span> <span class="n">day_pilots</span><span class="p">,</span> <span class="n">night_pilots</span><span class="p">,</span> <span class="n">tugboats</span><span class="p">,</span> <span class="n">channel_scheduler</span> <span class="o">=</span> <span class="n">terminal_resouces</span>
</span><span id="model_hurricane-714"><a href="#model_hurricane-714"><span class="linenos">714</span></a>
</span><span id="model_hurricane-715"><a href="#model_hurricane-715"><span class="linenos">715</span></a>    <span class="n">num_container_terminals</span><span class="p">,</span> <span class="n">num_liquid_terminals</span><span class="p">,</span> <span class="n">num_drybulk_terminals</span> <span class="o">=</span> <span class="n">num_terminals_list</span>
</span><span id="model_hurricane-716"><a href="#model_hurricane-716"><span class="linenos">716</span></a>
</span><span id="model_hurricane-717"><a href="#model_hurricane-717"><span class="linenos">717</span></a>    <span class="k">if</span> <span class="n">SEVERE_HURRICANE</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">TROPICAL_STORM</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="model_hurricane-718"><a href="#model_hurricane-718"><span class="linenos">718</span></a>
</span><span id="model_hurricane-719"><a href="#model_hurricane-719"><span class="linenos">719</span></a>        <span class="c1"># stop all arrivals between 1500 and 1665</span>
</span><span id="model_hurricane-720"><a href="#model_hurricane-720"><span class="linenos">720</span></a>        <span class="n">time_start</span> <span class="o">=</span> <span class="n">HURRICANE_START</span>
</span><span id="model_hurricane-721"><a href="#model_hurricane-721"><span class="linenos">721</span></a>        <span class="n">disruption_duration</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">6</span>
</span><span id="model_hurricane-722"><a href="#model_hurricane-722"><span class="linenos">722</span></a>
</span><span id="model_hurricane-723"><a href="#model_hurricane-723"><span class="linenos">723</span></a>        <span class="c1"># No arrivals for 6 days</span>
</span><span id="model_hurricane-724"><a href="#model_hurricane-724"><span class="linenos">724</span></a>        <span class="n">stop_and_bulk_arrival</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 7 days better</span>
</span><span id="model_hurricane-725"><a href="#model_hurricane-725"><span class="linenos">725</span></a>
</span><span id="model_hurricane-726"><a href="#model_hurricane-726"><span class="linenos">726</span></a>        <span class="c1"># recovery periods</span>
</span><span id="model_hurricane-727"><a href="#model_hurricane-727"><span class="linenos">727</span></a>        <span class="n">time_end_1_week</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="c1"># 7 days</span>
</span><span id="model_hurricane-728"><a href="#model_hurricane-728"><span class="linenos">728</span></a>        <span class="n">time_end_2_week</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="c1"># 7 days</span>
</span><span id="model_hurricane-729"><a href="#model_hurricane-729"><span class="linenos">729</span></a>        <span class="n">time_end_3_weeks</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">14</span> <span class="c1"># 14 days</span>
</span><span id="model_hurricane-730"><a href="#model_hurricane-730"><span class="linenos">730</span></a>        <span class="n">time_end_4_weeks</span> <span class="o">=</span> <span class="n">time_start</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">21</span> <span class="c1"># 21 days</span>
</span><span id="model_hurricane-731"><a href="#model_hurricane-731"><span class="linenos">731</span></a>
</span><span id="model_hurricane-732"><a href="#model_hurricane-732"><span class="linenos">732</span></a>         <span class="c1"># For 1st week, 100% of berths have one crane down, 25% of liquid and dry bulk terminals have one pipeline and conveyor down in 50% of berths</span>
</span><span id="model_hurricane-733"><a href="#model_hurricane-733"><span class="linenos">733</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="model_hurricane-734"><a href="#model_hurricane-734"><span class="linenos">734</span></a>                    <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
</span><span id="model_hurricane-735"><a href="#model_hurricane-735"><span class="linenos">735</span></a>        <span class="n">selected_liquid_terminals</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
</span><span id="model_hurricane-736"><a href="#model_hurricane-736"><span class="linenos">736</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">num_liquid_terminals</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">num_liquid_terminals</span><span class="p">))</span>
</span><span id="model_hurricane-737"><a href="#model_hurricane-737"><span class="linenos">737</span></a>        <span class="n">selected_drybulk_terminals</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
</span><span id="model_hurricane-738"><a href="#model_hurricane-738"><span class="linenos">738</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">num_drybulk_terminals</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">num_drybulk_terminals</span><span class="p">))</span> 
</span><span id="model_hurricane-739"><a href="#model_hurricane-739"><span class="linenos">739</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-740"><a href="#model_hurricane-740"><span class="linenos">740</span></a>                    <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
</span><span id="model_hurricane-741"><a href="#model_hurricane-741"><span class="linenos">741</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-742"><a href="#model_hurricane-742"><span class="linenos">742</span></a>                    <span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
</span><span id="model_hurricane-743"><a href="#model_hurricane-743"><span class="linenos">743</span></a>
</span><span id="model_hurricane-744"><a href="#model_hurricane-744"><span class="linenos">744</span></a>        <span class="c1"># For 1st week, 100% of berths have one crane down, 25% of liquid and dry bulk terminals have one pipeline and conveyor down in 50% of berths</span>
</span><span id="model_hurricane-745"><a href="#model_hurricane-745"><span class="linenos">745</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="model_hurricane-746"><a href="#model_hurricane-746"><span class="linenos">746</span></a>                    <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
</span><span id="model_hurricane-747"><a href="#model_hurricane-747"><span class="linenos">747</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-748"><a href="#model_hurricane-748"><span class="linenos">748</span></a>                    <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
</span><span id="model_hurricane-749"><a href="#model_hurricane-749"><span class="linenos">749</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-750"><a href="#model_hurricane-750"><span class="linenos">750</span></a>                    <span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
</span><span id="model_hurricane-751"><a href="#model_hurricane-751"><span class="linenos">751</span></a>
</span><span id="model_hurricane-752"><a href="#model_hurricane-752"><span class="linenos">752</span></a>        <span class="c1"># For 2nd week, 25% of berths have one crane down, 25% of (same) liquid and dry bulk terminals have one pipeline and conveyor down in 25% of berths</span>
</span><span id="model_hurricane-753"><a href="#model_hurricane-753"><span class="linenos">753</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="model_hurricane-754"><a href="#model_hurricane-754"><span class="linenos">754</span></a>                    <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
</span><span id="model_hurricane-755"><a href="#model_hurricane-755"><span class="linenos">755</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-756"><a href="#model_hurricane-756"><span class="linenos">756</span></a>                    <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
</span><span id="model_hurricane-757"><a href="#model_hurricane-757"><span class="linenos">757</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-758"><a href="#model_hurricane-758"><span class="linenos">758</span></a>                    <span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
</span><span id="model_hurricane-759"><a href="#model_hurricane-759"><span class="linenos">759</span></a>        
</span><span id="model_hurricane-760"><a href="#model_hurricane-760"><span class="linenos">760</span></a>        <span class="c1"># For 3rd week, 10% of berths have one crane down, 25% of (same) liquid and dry bulk terminals have one pipeline and conveyor down in 10% of berths</span>
</span><span id="model_hurricane-761"><a href="#model_hurricane-761"><span class="linenos">761</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_cranes</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_container_terminals</span><span class="p">)),</span>
</span><span id="model_hurricane-762"><a href="#model_hurricane-762"><span class="linenos">762</span></a>                    <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">,</span> <span class="n">port_berths_container_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</span><span id="model_hurricane-763"><a href="#model_hurricane-763"><span class="linenos">763</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_pipelines</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_liquid_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-764"><a href="#model_hurricane-764"><span class="linenos">764</span></a>                    <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">,</span> <span class="n">port_berth_liquid_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</span><span id="model_hurricane-765"><a href="#model_hurricane-765"><span class="linenos">765</span></a>        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">reduce_conveyors</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selected_drybulk_terminals</span><span class="p">,</span>
</span><span id="model_hurricane-766"><a href="#model_hurricane-766"><span class="linenos">766</span></a>                    <span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">,</span> <span class="n">port_berth_drybulk_terminals</span><span class="p">,</span> <span class="n">terminal_data</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</span><span id="model_hurricane-767"><a href="#model_hurricane-767"><span class="linenos">767</span></a>        
</span><span id="model_hurricane-768"><a href="#model_hurricane-768"><span class="linenos">768</span></a>        <span class="c1"># For 4th week, 10% of berths have one crane down, 25% of (same) liquid and dry bulk terminals have one pipeline and conveyor down in 10% of berths</span>
</span><span id="model_hurricane-769"><a href="#model_hurricane-769"><span class="linenos">769</span></a>        <span class="c1"># env.process(reduce_cranes(env, -1, list(range(num_container_terminals)),</span>
</span><span id="model_hurricane-770"><a href="#model_hurricane-770"><span class="linenos">770</span></a>        <span class="c1">#             time_end_3_weeks, time_end_1_month, port_berths_container_terminals, terminal_data, 0.1))</span>
</span><span id="model_hurricane-771"><a href="#model_hurricane-771"><span class="linenos">771</span></a>        <span class="c1"># env.process(reduce_pipelines(env, -1, selected_liquid_terminals,</span>
</span><span id="model_hurricane-772"><a href="#model_hurricane-772"><span class="linenos">772</span></a>        <span class="c1">#             time_end_3_weeks, time_end_1_month, port_berth_liquid_terminals, terminal_data, 0.1))</span>
</span><span id="model_hurricane-773"><a href="#model_hurricane-773"><span class="linenos">773</span></a>        <span class="c1"># env.process(reduce_conveyors(env, -1, selected_drybulk_terminals,</span>
</span><span id="model_hurricane-774"><a href="#model_hurricane-774"><span class="linenos">774</span></a>        <span class="c1">#             time_end_3_weeks, time_end_1_month, port_berth_drybulk_terminals, terminal_data, 0.1))</span>
</span><span id="model_hurricane-775"><a href="#model_hurricane-775"><span class="linenos">775</span></a>
</span><span id="model_hurricane-776"><a href="#model_hurricane-776"><span class="linenos">776</span></a>        <span class="c1"># for the first week only 50% of trucks/trains arrive and for the second week only 80% of trucks/trains arrive</span>
</span><span id="model_hurricane-777"><a href="#model_hurricane-777"><span class="linenos">777</span></a>
</span><span id="model_hurricane-778"><a href="#model_hurricane-778"><span class="linenos">778</span></a>        <span class="n">truck_time_arrival_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="model_hurricane-779"><a href="#model_hurricane-779"><span class="linenos">779</span></a>            <span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c1"># no trucks during hurricane</span>
</span><span id="model_hurricane-780"><a href="#model_hurricane-780"><span class="linenos">780</span></a>            <span class="p">(</span><span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">):</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="model_hurricane-781"><a href="#model_hurricane-781"><span class="linenos">781</span></a>            <span class="p">(</span><span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">):</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="model_hurricane-782"><a href="#model_hurricane-782"><span class="linenos">782</span></a>            <span class="p">(</span><span class="n">time_end_3_weeks</span><span class="p">,</span> <span class="n">time_end_4_weeks</span><span class="p">):</span> <span class="mf">0.5</span>
</span><span id="model_hurricane-783"><a href="#model_hurricane-783"><span class="linenos">783</span></a>        <span class="p">}</span>   
</span><span id="model_hurricane-784"><a href="#model_hurricane-784"><span class="linenos">784</span></a>
</span><span id="model_hurricane-785"><a href="#model_hurricane-785"><span class="linenos">785</span></a>        <span class="n">train_time_arrival_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="model_hurricane-786"><a href="#model_hurricane-786"><span class="linenos">786</span></a>            <span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c1"># no trains during hurricane</span>
</span><span id="model_hurricane-787"><a href="#model_hurricane-787"><span class="linenos">787</span></a>            <span class="p">(</span><span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="model_hurricane-788"><a href="#model_hurricane-788"><span class="linenos">788</span></a>            <span class="p">(</span><span class="n">time_end_2_week</span><span class="p">,</span> <span class="n">time_end_3_weeks</span><span class="p">):</span> <span class="mf">0.5</span>
</span><span id="model_hurricane-789"><a href="#model_hurricane-789"><span class="linenos">789</span></a>        <span class="p">}</span>
</span><span id="model_hurricane-790"><a href="#model_hurricane-790"><span class="linenos">790</span></a>
</span><span id="model_hurricane-791"><a href="#model_hurricane-791"><span class="linenos">791</span></a>        <span class="n">filter_truck_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">truck_time_arrival_dict</span><span class="p">)</span>
</span><span id="model_hurricane-792"><a href="#model_hurricane-792"><span class="linenos">792</span></a>        <span class="n">filter_train_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">train_time_arrival_dict</span><span class="p">)</span>
</span><span id="model_hurricane-793"><a href="#model_hurricane-793"><span class="linenos">793</span></a>
</span><span id="model_hurricane-794"><a href="#model_hurricane-794"><span class="linenos">794</span></a>    <span class="k">elif</span> <span class="n">TROPICAL_STORM</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">SEVERE_HURRICANE</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="model_hurricane-795"><a href="#model_hurricane-795"><span class="linenos">795</span></a>        
</span><span id="model_hurricane-796"><a href="#model_hurricane-796"><span class="linenos">796</span></a>        <span class="n">time_start</span> <span class="o">=</span> <span class="n">HURRICANE_START</span>
</span><span id="model_hurricane-797"><a href="#model_hurricane-797"><span class="linenos">797</span></a>        <span class="n">disruption_duration</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">4</span> <span class="c1"># 4 days</span>
</span><span id="model_hurricane-798"><a href="#model_hurricane-798"><span class="linenos">798</span></a>
</span><span id="model_hurricane-799"><a href="#model_hurricane-799"><span class="linenos">799</span></a>        <span class="n">time_end_1_week</span> <span class="o">=</span> <span class="n">HURRICANE_START</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="c1"># 7 days</span>
</span><span id="model_hurricane-800"><a href="#model_hurricane-800"><span class="linenos">800</span></a>        <span class="n">time_end_2_week</span> <span class="o">=</span> <span class="n">HURRICANE_START</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">14</span> <span class="c1"># 14 days</span>
</span><span id="model_hurricane-801"><a href="#model_hurricane-801"><span class="linenos">801</span></a>
</span><span id="model_hurricane-802"><a href="#model_hurricane-802"><span class="linenos">802</span></a>        <span class="c1"># No damage to port facilities</span>
</span><span id="model_hurricane-803"><a href="#model_hurricane-803"><span class="linenos">803</span></a>
</span><span id="model_hurricane-804"><a href="#model_hurricane-804"><span class="linenos">804</span></a>        <span class="c1"># No vessel arrivals for 1 week</span>
</span><span id="model_hurricane-805"><a href="#model_hurricane-805"><span class="linenos">805</span></a>        <span class="n">stop_and_bulk_arrival</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_start</span> <span class="o">+</span> <span class="n">disruption_duration</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">plot_input</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="model_hurricane-806"><a href="#model_hurricane-806"><span class="linenos">806</span></a>
</span><span id="model_hurricane-807"><a href="#model_hurricane-807"><span class="linenos">807</span></a>        <span class="c1"># for the first week only 70% of trucks arrive and no change to trains</span>
</span><span id="model_hurricane-808"><a href="#model_hurricane-808"><span class="linenos">808</span></a>        <span class="n">truck_time_arrival_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="model_hurricane-809"><a href="#model_hurricane-809"><span class="linenos">809</span></a>            <span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end_1_week</span><span class="p">):</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="model_hurricane-810"><a href="#model_hurricane-810"><span class="linenos">810</span></a>            <span class="p">(</span><span class="n">time_end_1_week</span><span class="p">,</span> <span class="n">time_end_2_week</span><span class="p">):</span> <span class="mf">0.8</span>
</span><span id="model_hurricane-811"><a href="#model_hurricane-811"><span class="linenos">811</span></a>        <span class="p">}</span>
</span><span id="model_hurricane-812"><a href="#model_hurricane-812"><span class="linenos">812</span></a>
</span><span id="model_hurricane-813"><a href="#model_hurricane-813"><span class="linenos">813</span></a>        <span class="n">filter_truck_data</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">truck_time_arrival_dict</span><span class="p">)</span>
</span><span id="model_hurricane-814"><a href="#model_hurricane-814"><span class="linenos">814</span></a>
</span><span id="model_hurricane-815"><a href="#model_hurricane-815"><span class="linenos">815</span></a>    <span class="k">elif</span> <span class="n">SEVERE_HURRICANE</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">TROPICAL_STORM</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="model_hurricane-816"><a href="#model_hurricane-816"><span class="linenos">816</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Both SEVERE_HURRICANE and TROPICAL_STORM flags cannot be True at the same time; update the config file.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function models a hurricane scenario by reducing the number of berths, cranes, pipelines, and conveyors in the port terminals.
It simulates the disruption by adjusting the resources available in the terminals between specified time periods.
Specificcally, the following changes are made:</p>

<ul>
<li>Reduces the number of berths in all container terminals by 1 from time 1165 to 2004.</li>
<li>Reduces the number of berths in 10% of liquid and dry bulk terminals by 1 from time 1165 to 2004.</li>
<li>Reduces the number of cranes in all container terminals by 1 from time 1165 to 2340.</li>
<li>Reduces the number of pipelines in 25% of liquid terminals by 1 from time 1165 to 2340.</li>
<li>Reduces the number of conveyors in 25% of dry bulk terminals by 1 from time 1165 to 2340.</li>
</ul>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>env (simpy.Environment):</strong>  The simulation environment.</li>
<li><strong>terminal_resouces (tuple):</strong>  A tuple containing the resources for the port terminals.</li>
<li><strong>num_terminals_list (list):</strong>  A list containing the number of container, liquid, and dry bulk terminals.</li>
<li><strong>terminal_data (dict):</strong>  A dictionary containing terminal data for crane transfer rates.</li>
<li><strong>run_id (str):</strong>  The unique identifier for the simulation run.</li>
<li><strong>seed (int):</strong>  The random seed for reproducibility.</li>
</ul>

<p>returns:
    None</p>
</div>


                </section>
                <section id="disruption_report_smoothed">
                            <input id="disruption_report_smoothed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disruption_report_smoothed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">smooth_window_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>, </span><span class="param"><span class="n">plot_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="disruption_report_smoothed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#disruption_report_smoothed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="disruption_report_smoothed-819"><a href="#disruption_report_smoothed-819"><span class="linenos"> 819</span></a><span class="k">def</span><span class="w"> </span><span class="nf">disruption_report_smoothed</span><span class="p">(</span><span class="n">smooth_window_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">plot_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-820"><a href="#disruption_report_smoothed-820"><span class="linenos"> 820</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="disruption_report_smoothed-821"><a href="#disruption_report_smoothed-821"><span class="linenos"> 821</span></a><span class="sd">    Inputs:</span>
</span><span id="disruption_report_smoothed-822"><a href="#disruption_report_smoothed-822"><span class="linenos"> 822</span></a><span class="sd">        - smooth_window_points: window size (odd integer) for rolling mean smoothing of raw queue</span>
</span><span id="disruption_report_smoothed-823"><a href="#disruption_report_smoothed-823"><span class="linenos"> 823</span></a><span class="sd">    Outputs (returned as a formatted string):</span>
</span><span id="disruption_report_smoothed-824"><a href="#disruption_report_smoothed-824"><span class="linenos"> 824</span></a><span class="sd">        1) times: onset, queue_in_point, mobilisation, peak, recovery</span>
</span><span id="disruption_report_smoothed-825"><a href="#disruption_report_smoothed-825"><span class="linenos"> 825</span></a><span class="sd">        2) a blank line</span>
</span><span id="disruption_report_smoothed-826"><a href="#disruption_report_smoothed-826"><span class="linenos"> 826</span></a><span class="sd">        3) durations: onset→queue_in_point, queue_in_point→mobilisation, mobilisation→peak, peak→recovery</span>
</span><span id="disruption_report_smoothed-827"><a href="#disruption_report_smoothed-827"><span class="linenos"> 827</span></a><span class="sd">        4) a blank line</span>
</span><span id="disruption_report_smoothed-828"><a href="#disruption_report_smoothed-828"><span class="linenos"> 828</span></a><span class="sd">        5) areas: positive (above baseline), negative (below baseline)</span>
</span><span id="disruption_report_smoothed-829"><a href="#disruption_report_smoothed-829"><span class="linenos"> 829</span></a><span class="sd">    Note: All event times are identified on RAW data, but areas are computed using SMOOTHED data.</span>
</span><span id="disruption_report_smoothed-830"><a href="#disruption_report_smoothed-830"><span class="linenos"> 830</span></a>
</span><span id="disruption_report_smoothed-831"><a href="#disruption_report_smoothed-831"><span class="linenos"> 831</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="disruption_report_smoothed-832"><a href="#disruption_report_smoothed-832"><span class="linenos"> 832</span></a>    <span class="n">warmup_time</span> <span class="o">=</span> <span class="n">WARMUP_ITERS</span>
</span><span id="disruption_report_smoothed-833"><a href="#disruption_report_smoothed-833"><span class="linenos"> 833</span></a>    <span class="n">onset_time</span> <span class="o">=</span> <span class="n">HURRICANE_START</span>
</span><span id="disruption_report_smoothed-834"><a href="#disruption_report_smoothed-834"><span class="linenos"> 834</span></a>
</span><span id="disruption_report_smoothed-835"><a href="#disruption_report_smoothed-835"><span class="linenos"> 835</span></a>    <span class="n">logfileid</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">NUM_MONTHS</span><span class="p">)</span><span class="si">}</span><span class="s2">_months_</span><span class="si">{</span><span class="n">NUM_RUNS</span><span class="si">}</span><span class="s2">_runs_run_</span><span class="si">{</span><span class="n">LOG_NUM</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="disruption_report_smoothed-836"><a href="#disruption_report_smoothed-836"><span class="linenos"> 836</span></a>    <span class="n">df_location</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/data/all_queue.csv&#39;</span>
</span><span id="disruption_report_smoothed-837"><a href="#disruption_report_smoothed-837"><span class="linenos"> 837</span></a>
</span><span id="disruption_report_smoothed-838"><a href="#disruption_report_smoothed-838"><span class="linenos"> 838</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">df_location</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-839"><a href="#disruption_report_smoothed-839"><span class="linenos"> 839</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">df_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;time&quot;</span><span class="p">})</span>
</span><span id="disruption_report_smoothed-840"><a href="#disruption_report_smoothed-840"><span class="linenos"> 840</span></a>    <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-841"><a href="#disruption_report_smoothed-841"><span class="linenos"> 841</span></a>
</span><span id="disruption_report_smoothed-842"><a href="#disruption_report_smoothed-842"><span class="linenos"> 842</span></a>    <span class="n">time_col</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="disruption_report_smoothed-843"><a href="#disruption_report_smoothed-843"><span class="linenos"> 843</span></a>    <span class="n">queue_col</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
</span><span id="disruption_report_smoothed-844"><a href="#disruption_report_smoothed-844"><span class="linenos"> 844</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[[</span><span class="n">time_col</span><span class="p">,</span> <span class="n">queue_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">time_col</span><span class="p">:</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">,</span> <span class="n">queue_col</span><span class="p">:</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">})</span>
</span><span id="disruption_report_smoothed-845"><a href="#disruption_report_smoothed-845"><span class="linenos"> 845</span></a>
</span><span id="disruption_report_smoothed-846"><a href="#disruption_report_smoothed-846"><span class="linenos"> 846</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time_hr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-847"><a href="#disruption_report_smoothed-847"><span class="linenos"> 847</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-848"><a href="#disruption_report_smoothed-848"><span class="linenos"> 848</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-849"><a href="#disruption_report_smoothed-849"><span class="linenos"> 849</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-850"><a href="#disruption_report_smoothed-850"><span class="linenos"> 850</span></a>
</span><span id="disruption_report_smoothed-851"><a href="#disruption_report_smoothed-851"><span class="linenos"> 851</span></a>    <span class="c1"># Smoothing for areas only</span>
</span><span id="disruption_report_smoothed-852"><a href="#disruption_report_smoothed-852"><span class="linenos"> 852</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">smooth_window_points</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-853"><a href="#disruption_report_smoothed-853"><span class="linenos"> 853</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="disruption_report_smoothed-854"><a href="#disruption_report_smoothed-854"><span class="linenos"> 854</span></a>    <span class="k">if</span> <span class="n">w</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="disruption_report_smoothed-855"><a href="#disruption_report_smoothed-855"><span class="linenos"> 855</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_smooth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="disruption_report_smoothed-856"><a href="#disruption_report_smoothed-856"><span class="linenos"> 856</span></a>
</span><span id="disruption_report_smoothed-857"><a href="#disruption_report_smoothed-857"><span class="linenos"> 857</span></a>    <span class="c1"># Baseline from [1000, 1500] on RAW</span>
</span><span id="disruption_report_smoothed-858"><a href="#disruption_report_smoothed-858"><span class="linenos"> 858</span></a>    <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">warmup_time</span><span class="p">,</span> <span class="n">onset_time</span>
</span><span id="disruption_report_smoothed-859"><a href="#disruption_report_smoothed-859"><span class="linenos"> 859</span></a>    <span class="n">base_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t1</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-860"><a href="#disruption_report_smoothed-860"><span class="linenos"> 860</span></a>    <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_mask</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="disruption_report_smoothed-861"><a href="#disruption_report_smoothed-861"><span class="linenos"> 861</span></a>
</span><span id="disruption_report_smoothed-862"><a href="#disruption_report_smoothed-862"><span class="linenos"> 862</span></a>    <span class="c1"># A: onset</span>
</span><span id="disruption_report_smoothed-863"><a href="#disruption_report_smoothed-863"><span class="linenos"> 863</span></a>    <span class="n">idx_A</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">onset_time</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">())</span>
</span><span id="disruption_report_smoothed-864"><a href="#disruption_report_smoothed-864"><span class="linenos"> 864</span></a>    <span class="n">A_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_A</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">A_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_A</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="disruption_report_smoothed-865"><a href="#disruption_report_smoothed-865"><span class="linenos"> 865</span></a>
</span><span id="disruption_report_smoothed-866"><a href="#disruption_report_smoothed-866"><span class="linenos"> 866</span></a>    <span class="c1"># t_queue_in_point: point where queue starts to increase (2 positive slopes)</span>
</span><span id="disruption_report_smoothed-867"><a href="#disruption_report_smoothed-867"><span class="linenos"> 867</span></a>    <span class="n">dQdt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="disruption_report_smoothed-868"><a href="#disruption_report_smoothed-868"><span class="linenos"> 868</span></a>    <span class="n">idx_queue_in</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="disruption_report_smoothed-869"><a href="#disruption_report_smoothed-869"><span class="linenos"> 869</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="disruption_report_smoothed-870"><a href="#disruption_report_smoothed-870"><span class="linenos"> 870</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">dQdt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dQdt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="disruption_report_smoothed-871"><a href="#disruption_report_smoothed-871"><span class="linenos"> 871</span></a>            <span class="n">idx_queue_in</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span>
</span><span id="disruption_report_smoothed-872"><a href="#disruption_report_smoothed-872"><span class="linenos"> 872</span></a>    <span class="k">if</span> <span class="n">idx_queue_in</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">idx_queue_in</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx_A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-873"><a href="#disruption_report_smoothed-873"><span class="linenos"> 873</span></a>    <span class="n">t_queue_in</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_queue_in</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">q_queue_in</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_queue_in</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="disruption_report_smoothed-874"><a href="#disruption_report_smoothed-874"><span class="linenos"> 874</span></a>
</span><span id="disruption_report_smoothed-875"><a href="#disruption_report_smoothed-875"><span class="linenos"> 875</span></a>    <span class="c1"># B: mobilisation (first upward crossing to baseline after t_queue_in_point)</span>
</span><span id="disruption_report_smoothed-876"><a href="#disruption_report_smoothed-876"><span class="linenos"> 876</span></a>    <span class="n">idx_B</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="disruption_report_smoothed-877"><a href="#disruption_report_smoothed-877"><span class="linenos"> 877</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_queue_in</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
</span><span id="disruption_report_smoothed-878"><a href="#disruption_report_smoothed-878"><span class="linenos"> 878</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">baseline</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-879"><a href="#disruption_report_smoothed-879"><span class="linenos"> 879</span></a>            <span class="n">idx_B</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span>
</span><span id="disruption_report_smoothed-880"><a href="#disruption_report_smoothed-880"><span class="linenos"> 880</span></a>    <span class="k">if</span> <span class="n">idx_B</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">idx_B</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="disruption_report_smoothed-881"><a href="#disruption_report_smoothed-881"><span class="linenos"> 881</span></a>    <span class="n">B_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_B</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">B_q</span> <span class="o">=</span> <span class="n">baseline</span>
</span><span id="disruption_report_smoothed-882"><a href="#disruption_report_smoothed-882"><span class="linenos"> 882</span></a>
</span><span id="disruption_report_smoothed-883"><a href="#disruption_report_smoothed-883"><span class="linenos"> 883</span></a>    <span class="c1"># C: peak (raw max after mobilisation)</span>
</span><span id="disruption_report_smoothed-884"><a href="#disruption_report_smoothed-884"><span class="linenos"> 884</span></a>    <span class="n">idx_C</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">B_t</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
</span><span id="disruption_report_smoothed-885"><a href="#disruption_report_smoothed-885"><span class="linenos"> 885</span></a>    <span class="n">C_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">C_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="disruption_report_smoothed-886"><a href="#disruption_report_smoothed-886"><span class="linenos"> 886</span></a>
</span><span id="disruption_report_smoothed-887"><a href="#disruption_report_smoothed-887"><span class="linenos"> 887</span></a>    <span class="c1"># D: recovery (first downward crossing to baseline after C; linear interpolation on RAW)</span>
</span><span id="disruption_report_smoothed-888"><a href="#disruption_report_smoothed-888"><span class="linenos"> 888</span></a>    <span class="c1"># D_t, D_q = None, None</span>
</span><span id="disruption_report_smoothed-889"><a href="#disruption_report_smoothed-889"><span class="linenos"> 889</span></a>    <span class="c1"># for i in range(idx_C, len(df) - 1):</span>
</span><span id="disruption_report_smoothed-890"><a href="#disruption_report_smoothed-890"><span class="linenos"> 890</span></a>    <span class="c1">#     y0, y1 = df.at[i, &quot;q_raw&quot;], df.at[i + 1, &quot;q_raw&quot;]</span>
</span><span id="disruption_report_smoothed-891"><a href="#disruption_report_smoothed-891"><span class="linenos"> 891</span></a>    <span class="c1">#     x0, x1 = df.at[i, &quot;time_hr&quot;], df.at[i + 1, &quot;time_hr&quot;]</span>
</span><span id="disruption_report_smoothed-892"><a href="#disruption_report_smoothed-892"><span class="linenos"> 892</span></a>    <span class="c1">#     if (y0 &gt; baseline) and (y1 &lt;= baseline):</span>
</span><span id="disruption_report_smoothed-893"><a href="#disruption_report_smoothed-893"><span class="linenos"> 893</span></a>    <span class="c1">#         D_t = float(x0 + (baseline - y0) * (x1 - x0) / (y1 - y0)) if y1 != y0 else float(x1)</span>
</span><span id="disruption_report_smoothed-894"><a href="#disruption_report_smoothed-894"><span class="linenos"> 894</span></a>    <span class="c1">#         D_q = baseline</span>
</span><span id="disruption_report_smoothed-895"><a href="#disruption_report_smoothed-895"><span class="linenos"> 895</span></a>    <span class="c1">#         break</span>
</span><span id="disruption_report_smoothed-896"><a href="#disruption_report_smoothed-896"><span class="linenos"> 896</span></a>    <span class="c1"># if D_t is None:</span>
</span><span id="disruption_report_smoothed-897"><a href="#disruption_report_smoothed-897"><span class="linenos"> 897</span></a>    <span class="c1">#     D_t = float(df.at[len(df) - 1, &quot;time_hr&quot;]); D_q = float(df.at[len(df) - 1, &quot;q_raw&quot;])</span>
</span><span id="disruption_report_smoothed-898"><a href="#disruption_report_smoothed-898"><span class="linenos"> 898</span></a>
</span><span id="disruption_report_smoothed-899"><a href="#disruption_report_smoothed-899"><span class="linenos"> 899</span></a>    <span class="c1"># D: recovery (average queue over 2 weeks post-recovery point is &lt;= baseline)</span>
</span><span id="disruption_report_smoothed-900"><a href="#disruption_report_smoothed-900"><span class="linenos"> 900</span></a>    <span class="n">two_weeks_in_hours</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">*</span> <span class="mi">24</span>
</span><span id="disruption_report_smoothed-901"><a href="#disruption_report_smoothed-901"><span class="linenos"> 901</span></a>    <span class="n">D_t</span><span class="p">,</span> <span class="n">D_q</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="disruption_report_smoothed-902"><a href="#disruption_report_smoothed-902"><span class="linenos"> 902</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_C</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
</span><span id="disruption_report_smoothed-903"><a href="#disruption_report_smoothed-903"><span class="linenos"> 903</span></a>        <span class="c1"># Calculate the end point of the 2-week window</span>
</span><span id="disruption_report_smoothed-904"><a href="#disruption_report_smoothed-904"><span class="linenos"> 904</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">two_weeks_in_hours</span>
</span><span id="disruption_report_smoothed-905"><a href="#disruption_report_smoothed-905"><span class="linenos"> 905</span></a>
</span><span id="disruption_report_smoothed-906"><a href="#disruption_report_smoothed-906"><span class="linenos"> 906</span></a>        <span class="c1"># Get the subset of data for the 2-week window</span>
</span><span id="disruption_report_smoothed-907"><a href="#disruption_report_smoothed-907"><span class="linenos"> 907</span></a>        <span class="n">window_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-908"><a href="#disruption_report_smoothed-908"><span class="linenos"> 908</span></a>        <span class="n">window_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">window_mask</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span>
</span><span id="disruption_report_smoothed-909"><a href="#disruption_report_smoothed-909"><span class="linenos"> 909</span></a>
</span><span id="disruption_report_smoothed-910"><a href="#disruption_report_smoothed-910"><span class="linenos"> 910</span></a>        <span class="c1"># If there&#39;s enough data for a full 2-week window, check the average</span>
</span><span id="disruption_report_smoothed-911"><a href="#disruption_report_smoothed-911"><span class="linenos"> 911</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Ensure there is at least one data point</span>
</span><span id="disruption_report_smoothed-912"><a href="#disruption_report_smoothed-912"><span class="linenos"> 912</span></a>            <span class="n">avg_queue</span> <span class="o">=</span> <span class="n">window_data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="disruption_report_smoothed-913"><a href="#disruption_report_smoothed-913"><span class="linenos"> 913</span></a>            <span class="k">if</span> <span class="n">avg_queue</span> <span class="o">&lt;=</span> <span class="n">baseline</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-914"><a href="#disruption_report_smoothed-914"><span class="linenos"> 914</span></a>                <span class="n">D_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span>
</span><span id="disruption_report_smoothed-915"><a href="#disruption_report_smoothed-915"><span class="linenos"> 915</span></a>                <span class="n">D_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="disruption_report_smoothed-916"><a href="#disruption_report_smoothed-916"><span class="linenos"> 916</span></a>                <span class="k">break</span>
</span><span id="disruption_report_smoothed-917"><a href="#disruption_report_smoothed-917"><span class="linenos"> 917</span></a>    
</span><span id="disruption_report_smoothed-918"><a href="#disruption_report_smoothed-918"><span class="linenos"> 918</span></a>    <span class="c1"># Fallback in case no such point is found</span>
</span><span id="disruption_report_smoothed-919"><a href="#disruption_report_smoothed-919"><span class="linenos"> 919</span></a>    <span class="k">if</span> <span class="n">D_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-920"><a href="#disruption_report_smoothed-920"><span class="linenos"> 920</span></a>        <span class="n">D_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]);</span> <span class="n">D_q</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="disruption_report_smoothed-921"><a href="#disruption_report_smoothed-921"><span class="linenos"> 921</span></a>
</span><span id="disruption_report_smoothed-922"><a href="#disruption_report_smoothed-922"><span class="linenos"> 922</span></a>    <span class="c1"># Durations</span>
</span><span id="disruption_report_smoothed-923"><a href="#disruption_report_smoothed-923"><span class="linenos"> 923</span></a>    <span class="n">dur_A_queue_in</span> <span class="o">=</span> <span class="n">t_queue_in</span> <span class="o">-</span> <span class="n">A_t</span>
</span><span id="disruption_report_smoothed-924"><a href="#disruption_report_smoothed-924"><span class="linenos"> 924</span></a>    <span class="n">dur_queue_in_B</span> <span class="o">=</span> <span class="n">B_t</span> <span class="o">-</span> <span class="n">t_queue_in</span>
</span><span id="disruption_report_smoothed-925"><a href="#disruption_report_smoothed-925"><span class="linenos"> 925</span></a>    <span class="n">dur_B_C</span> <span class="o">=</span> <span class="n">C_t</span> <span class="o">-</span> <span class="n">B_t</span>
</span><span id="disruption_report_smoothed-926"><a href="#disruption_report_smoothed-926"><span class="linenos"> 926</span></a>    <span class="n">dur_C_D</span> <span class="o">=</span> <span class="n">D_t</span> <span class="o">-</span> <span class="n">C_t</span>
</span><span id="disruption_report_smoothed-927"><a href="#disruption_report_smoothed-927"><span class="linenos"> 927</span></a>
</span><span id="disruption_report_smoothed-928"><a href="#disruption_report_smoothed-928"><span class="linenos"> 928</span></a>    <span class="c1"># Areas between A and D using q_smooth</span>
</span><span id="disruption_report_smoothed-929"><a href="#disruption_report_smoothed-929"><span class="linenos"> 929</span></a>    <span class="n">mask_AD</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">A_t</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">D_t</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-930"><a href="#disruption_report_smoothed-930"><span class="linenos"> 930</span></a>    <span class="n">xs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_AD</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-931"><a href="#disruption_report_smoothed-931"><span class="linenos"> 931</span></a>    <span class="n">ys_sm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_AD</span><span class="p">,</span> <span class="s2">&quot;q_smooth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-932"><a href="#disruption_report_smoothed-932"><span class="linenos"> 932</span></a>    <span class="k">if</span> <span class="n">xs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">D_t</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-933"><a href="#disruption_report_smoothed-933"><span class="linenos"> 933</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">D_t</span><span class="p">);</span> <span class="n">ys_sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ys_sm</span><span class="p">,</span> <span class="n">baseline</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-934"><a href="#disruption_report_smoothed-934"><span class="linenos"> 934</span></a>    <span class="n">area_pos</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ys_sm</span> <span class="o">-</span> <span class="n">baseline</span><span class="p">),</span> <span class="n">xs</span><span class="p">))</span>
</span><span id="disruption_report_smoothed-935"><a href="#disruption_report_smoothed-935"><span class="linenos"> 935</span></a>    <span class="n">area_neg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">baseline</span> <span class="o">-</span> <span class="n">ys_sm</span><span class="p">),</span> <span class="n">xs</span><span class="p">))</span>
</span><span id="disruption_report_smoothed-936"><a href="#disruption_report_smoothed-936"><span class="linenos"> 936</span></a>
</span><span id="disruption_report_smoothed-937"><a href="#disruption_report_smoothed-937"><span class="linenos"> 937</span></a>    <span class="c1"># Calculate new metrics</span>
</span><span id="disruption_report_smoothed-938"><a href="#disruption_report_smoothed-938"><span class="linenos"> 938</span></a>    <span class="c1"># Robustness (R): R = Q(t_min) / Q_0_bar</span>
</span><span id="disruption_report_smoothed-939"><a href="#disruption_report_smoothed-939"><span class="linenos"> 939</span></a>    <span class="n">idx_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">A_t</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t_queue_in</span><span class="p">),</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">())</span>
</span><span id="disruption_report_smoothed-940"><a href="#disruption_report_smoothed-940"><span class="linenos"> 940</span></a>    <span class="n">q_min</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_min</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span>
</span><span id="disruption_report_smoothed-941"><a href="#disruption_report_smoothed-941"><span class="linenos"> 941</span></a>    <span class="n">robustness</span> <span class="o">=</span> <span class="n">q_min</span> <span class="o">/</span> <span class="n">baseline</span>
</span><span id="disruption_report_smoothed-942"><a href="#disruption_report_smoothed-942"><span class="linenos"> 942</span></a>
</span><span id="disruption_report_smoothed-943"><a href="#disruption_report_smoothed-943"><span class="linenos"> 943</span></a>    <span class="c1"># Mobilization (M): M = time from onset to mobilisation</span>
</span><span id="disruption_report_smoothed-944"><a href="#disruption_report_smoothed-944"><span class="linenos"> 944</span></a>    <span class="n">mobilization</span> <span class="o">=</span> <span class="n">B_t</span> <span class="o">-</span> <span class="n">A_t</span>
</span><span id="disruption_report_smoothed-945"><a href="#disruption_report_smoothed-945"><span class="linenos"> 945</span></a>
</span><span id="disruption_report_smoothed-946"><a href="#disruption_report_smoothed-946"><span class="linenos"> 946</span></a>    <span class="c1"># Peak Queue Increase (P): P = (Q(t_max) - Q_0_bar) / Q_0_bar</span>
</span><span id="disruption_report_smoothed-947"><a href="#disruption_report_smoothed-947"><span class="linenos"> 947</span></a>    <span class="n">peak_increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">C_q</span> <span class="o">-</span> <span class="n">baseline</span><span class="p">)</span> <span class="o">/</span> <span class="n">baseline</span>
</span><span id="disruption_report_smoothed-948"><a href="#disruption_report_smoothed-948"><span class="linenos"> 948</span></a>
</span><span id="disruption_report_smoothed-949"><a href="#disruption_report_smoothed-949"><span class="linenos"> 949</span></a>    <span class="c1"># Max Recovery Rate (m_max): slope of the next &#39;n&#39; points from the peak</span>
</span><span id="disruption_report_smoothed-950"><a href="#disruption_report_smoothed-950"><span class="linenos"> 950</span></a>    <span class="c1"># Initialize variables to store the most negative slope and the corresponding lookahead</span>
</span><span id="disruption_report_smoothed-951"><a href="#disruption_report_smoothed-951"><span class="linenos"> 951</span></a>    <span class="n">max_negative_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="disruption_report_smoothed-952"><a href="#disruption_report_smoothed-952"><span class="linenos"> 952</span></a>    <span class="n">best_lookahead</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="disruption_report_smoothed-953"><a href="#disruption_report_smoothed-953"><span class="linenos"> 953</span></a>    <span class="n">best_lookahead_idx</span> <span class="o">=</span> <span class="n">idx_C</span>
</span><span id="disruption_report_smoothed-954"><a href="#disruption_report_smoothed-954"><span class="linenos"> 954</span></a>
</span><span id="disruption_report_smoothed-955"><a href="#disruption_report_smoothed-955"><span class="linenos"> 955</span></a>    <span class="c1"># Loop through lookahead values from 5 to 50</span>
</span><span id="disruption_report_smoothed-956"><a href="#disruption_report_smoothed-956"><span class="linenos"> 956</span></a>    <span class="k">for</span> <span class="n">recovery_rate_lookahead</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">51</span><span class="p">):</span>
</span><span id="disruption_report_smoothed-957"><a href="#disruption_report_smoothed-957"><span class="linenos"> 957</span></a>        <span class="n">idx_C_plus_n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx_C</span> <span class="o">+</span> <span class="n">recovery_rate_lookahead</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-958"><a href="#disruption_report_smoothed-958"><span class="linenos"> 958</span></a>        <span class="k">if</span> <span class="n">idx_C_plus_n</span> <span class="o">&gt;</span> <span class="n">idx_C</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-959"><a href="#disruption_report_smoothed-959"><span class="linenos"> 959</span></a>            <span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C_plus_n</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">C_q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_C_plus_n</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">C_t</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-960"><a href="#disruption_report_smoothed-960"><span class="linenos"> 960</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-961"><a href="#disruption_report_smoothed-961"><span class="linenos"> 961</span></a>            <span class="n">rate</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="disruption_report_smoothed-962"><a href="#disruption_report_smoothed-962"><span class="linenos"> 962</span></a>
</span><span id="disruption_report_smoothed-963"><a href="#disruption_report_smoothed-963"><span class="linenos"> 963</span></a>        <span class="c1"># Check if the current rate is more negative than the current maximum negative rate</span>
</span><span id="disruption_report_smoothed-964"><a href="#disruption_report_smoothed-964"><span class="linenos"> 964</span></a>        <span class="k">if</span> <span class="n">rate</span> <span class="o">&lt;</span> <span class="n">max_negative_rate</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-965"><a href="#disruption_report_smoothed-965"><span class="linenos"> 965</span></a>            <span class="n">max_negative_rate</span> <span class="o">=</span> <span class="n">rate</span>
</span><span id="disruption_report_smoothed-966"><a href="#disruption_report_smoothed-966"><span class="linenos"> 966</span></a>            <span class="n">best_lookahead</span> <span class="o">=</span> <span class="n">recovery_rate_lookahead</span>
</span><span id="disruption_report_smoothed-967"><a href="#disruption_report_smoothed-967"><span class="linenos"> 967</span></a>            <span class="n">best_lookahead_idx</span> <span class="o">=</span> <span class="n">idx_C_plus_n</span>
</span><span id="disruption_report_smoothed-968"><a href="#disruption_report_smoothed-968"><span class="linenos"> 968</span></a>
</span><span id="disruption_report_smoothed-969"><a href="#disruption_report_smoothed-969"><span class="linenos"> 969</span></a>
</span><span id="disruption_report_smoothed-970"><a href="#disruption_report_smoothed-970"><span class="linenos"> 970</span></a>
</span><span id="disruption_report_smoothed-971"><a href="#disruption_report_smoothed-971"><span class="linenos"> 971</span></a>    <span class="c1"># drop lat 200 points to avoid edge effects in smoothing</span>
</span><span id="disruption_report_smoothed-972"><a href="#disruption_report_smoothed-972"><span class="linenos"> 972</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-973"><a href="#disruption_report_smoothed-973"><span class="linenos"> 973</span></a>
</span><span id="disruption_report_smoothed-974"><a href="#disruption_report_smoothed-974"><span class="linenos"> 974</span></a>    <span class="c1"># Plot (PDF): raw &amp; smoothed; shading from smoothed</span>
</span><span id="disruption_report_smoothed-975"><a href="#disruption_report_smoothed-975"><span class="linenos"> 975</span></a>    <span class="n">logfileid</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">NUM_MONTHS</span><span class="p">)</span><span class="si">}</span><span class="s2">_months_</span><span class="si">{</span><span class="n">NUM_RUNS</span><span class="si">}</span><span class="s2">_runs_run_</span><span class="si">{</span><span class="n">LOG_NUM</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="disruption_report_smoothed-976"><a href="#disruption_report_smoothed-976"><span class="linenos"> 976</span></a>    <span class="n">pdf_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/hurricane_report.pdf&#39;</span>
</span><span id="disruption_report_smoothed-977"><a href="#disruption_report_smoothed-977"><span class="linenos"> 977</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">))</span>
</span><span id="disruption_report_smoothed-978"><a href="#disruption_report_smoothed-978"><span class="linenos"> 978</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Queue (raw)&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-979"><a href="#disruption_report_smoothed-979"><span class="linenos"> 979</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_smooth&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Queue (smoothed)&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-980"><a href="#disruption_report_smoothed-980"><span class="linenos"> 980</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-981"><a href="#disruption_report_smoothed-981"><span class="linenos"> 981</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys_sm</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">ys_sm</span> <span class="o">&lt;</span> <span class="n">baseline</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lost service&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-982"><a href="#disruption_report_smoothed-982"><span class="linenos"> 982</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys_sm</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">ys_sm</span> <span class="o">&gt;</span> <span class="n">baseline</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Excess queuing&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-983"><a href="#disruption_report_smoothed-983"><span class="linenos"> 983</span></a>
</span><span id="disruption_report_smoothed-984"><a href="#disruption_report_smoothed-984"><span class="linenos"> 984</span></a>    <span class="c1"># shade the warmup period</span>
</span><span id="disruption_report_smoothed-985"><a href="#disruption_report_smoothed-985"><span class="linenos"> 985</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">warmup_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Warmup period&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-986"><a href="#disruption_report_smoothed-986"><span class="linenos"> 986</span></a>
</span><span id="disruption_report_smoothed-987"><a href="#disruption_report_smoothed-987"><span class="linenos"> 987</span></a>    <span class="c1"># Plot the max recovery rate line segment</span>
</span><span id="disruption_report_smoothed-988"><a href="#disruption_report_smoothed-988"><span class="linenos"> 988</span></a>    <span class="n">x_rate</span> <span class="o">=</span> <span class="p">[</span><span class="n">C_t</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">best_lookahead_idx</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">]]</span>
</span><span id="disruption_report_smoothed-989"><a href="#disruption_report_smoothed-989"><span class="linenos"> 989</span></a>    <span class="n">y_rate</span> <span class="o">=</span> <span class="p">[</span><span class="n">C_q</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">best_lookahead_idx</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]]</span>
</span><span id="disruption_report_smoothed-990"><a href="#disruption_report_smoothed-990"><span class="linenos"> 990</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_rate</span><span class="p">,</span> <span class="n">y_rate</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Max recovery rate&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-991"><a href="#disruption_report_smoothed-991"><span class="linenos"> 991</span></a>
</span><span id="disruption_report_smoothed-992"><a href="#disruption_report_smoothed-992"><span class="linenos"> 992</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yv</span><span class="p">),</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="p">[((</span><span class="n">A_t</span><span class="p">,</span> <span class="n">A_q</span><span class="p">),</span> <span class="s2">&quot;Onset&quot;</span><span class="p">),</span> <span class="p">((</span><span class="n">B_t</span><span class="p">,</span> <span class="n">B_q</span><span class="p">),</span> <span class="s2">&quot;Mobilisation&quot;</span><span class="p">),</span>
</span><span id="disruption_report_smoothed-993"><a href="#disruption_report_smoothed-993"><span class="linenos"> 993</span></a>                         <span class="p">((</span><span class="n">C_t</span><span class="p">,</span> <span class="n">C_q</span><span class="p">),</span> <span class="s2">&quot;Peak&quot;</span><span class="p">),</span> <span class="p">((</span><span class="n">D_t</span><span class="p">,</span> <span class="n">D_q</span><span class="p">),</span> <span class="s2">&quot;Recovery&quot;</span><span class="p">)]:</span>
</span><span id="disruption_report_smoothed-994"><a href="#disruption_report_smoothed-994"><span class="linenos"> 994</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">xt</span><span class="p">],</span> <span class="p">[</span><span class="n">yv</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-995"><a href="#disruption_report_smoothed-995"><span class="linenos"> 995</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (hr)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Queue length&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="disruption_report_smoothed-996"><a href="#disruption_report_smoothed-996"><span class="linenos"> 996</span></a>    <span class="k">if</span> <span class="n">plot_legend</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-997"><a href="#disruption_report_smoothed-997"><span class="linenos"> 997</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-998"><a href="#disruption_report_smoothed-998"><span class="linenos"> 998</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-999"><a href="#disruption_report_smoothed-999"><span class="linenos"> 999</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-1000"><a href="#disruption_report_smoothed-1000"><span class="linenos">1000</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="disruption_report_smoothed-1001"><a href="#disruption_report_smoothed-1001"><span class="linenos">1001</span></a>
</span><span id="disruption_report_smoothed-1002"><a href="#disruption_report_smoothed-1002"><span class="linenos">1002</span></a>    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="disruption_report_smoothed-1003"><a href="#disruption_report_smoothed-1003"><span class="linenos">1003</span></a>        <span class="sa">f</span><span class="s2">&quot;onset: </span><span class="si">{</span><span class="n">A_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1004"><a href="#disruption_report_smoothed-1004"><span class="linenos">1004</span></a>        <span class="sa">f</span><span class="s2">&quot;queue-in-point: </span><span class="si">{</span><span class="n">t_queue_in</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1005"><a href="#disruption_report_smoothed-1005"><span class="linenos">1005</span></a>        <span class="sa">f</span><span class="s2">&quot;mobilisation: </span><span class="si">{</span><span class="n">B_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1006"><a href="#disruption_report_smoothed-1006"><span class="linenos">1006</span></a>        <span class="sa">f</span><span class="s2">&quot;peak: </span><span class="si">{</span><span class="n">C_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1007"><a href="#disruption_report_smoothed-1007"><span class="linenos">1007</span></a>        <span class="sa">f</span><span class="s2">&quot;recovery: </span><span class="si">{</span><span class="n">D_t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1008"><a href="#disruption_report_smoothed-1008"><span class="linenos">1008</span></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1009"><a href="#disruption_report_smoothed-1009"><span class="linenos">1009</span></a>        <span class="sa">f</span><span class="s2">&quot;time onset to queue-in-point (days): </span><span class="si">{</span><span class="n">dur_A_queue_in</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1010"><a href="#disruption_report_smoothed-1010"><span class="linenos">1010</span></a>        <span class="sa">f</span><span class="s2">&quot;time queue-in-point to mobilisation (days): </span><span class="si">{</span><span class="n">dur_queue_in_B</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1011"><a href="#disruption_report_smoothed-1011"><span class="linenos">1011</span></a>        <span class="sa">f</span><span class="s2">&quot;time mobilisation to peak (days): </span><span class="si">{</span><span class="n">dur_B_C</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1012"><a href="#disruption_report_smoothed-1012"><span class="linenos">1012</span></a>        <span class="sa">f</span><span class="s2">&quot;time peak to recovery (days): </span><span class="si">{</span><span class="n">dur_C_D</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1013"><a href="#disruption_report_smoothed-1013"><span class="linenos">1013</span></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1014"><a href="#disruption_report_smoothed-1014"><span class="linenos">1014</span></a>        <span class="sa">f</span><span class="s2">&quot;area above baseline (vessel days): </span><span class="si">{</span><span class="n">area_pos</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1015"><a href="#disruption_report_smoothed-1015"><span class="linenos">1015</span></a>        <span class="sa">f</span><span class="s2">&quot;area below baseline (vessel days): </span><span class="si">{</span><span class="n">area_neg</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">24</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1016"><a href="#disruption_report_smoothed-1016"><span class="linenos">1016</span></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1017"><a href="#disruption_report_smoothed-1017"><span class="linenos">1017</span></a>        <span class="sa">f</span><span class="s2">&quot;Robustness: </span><span class="si">{</span><span class="n">robustness</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1018"><a href="#disruption_report_smoothed-1018"><span class="linenos">1018</span></a>        <span class="sa">f</span><span class="s2">&quot;Mobilization: </span><span class="si">{</span><span class="n">mobilization</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1019"><a href="#disruption_report_smoothed-1019"><span class="linenos">1019</span></a>        <span class="sa">f</span><span class="s2">&quot;Peak Queue Increase: </span><span class="si">{</span><span class="n">peak_increase</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="disruption_report_smoothed-1020"><a href="#disruption_report_smoothed-1020"><span class="linenos">1020</span></a>        <span class="sa">f</span><span class="s2">&quot;Max Recovery Rate: </span><span class="si">{</span><span class="n">max_negative_rate</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="disruption_report_smoothed-1021"><a href="#disruption_report_smoothed-1021"><span class="linenos">1021</span></a>    <span class="p">]</span>
</span><span id="disruption_report_smoothed-1022"><a href="#disruption_report_smoothed-1022"><span class="linenos">1022</span></a>
</span><span id="disruption_report_smoothed-1023"><a href="#disruption_report_smoothed-1023"><span class="linenos">1023</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/hurricane_report.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-1024"><a href="#disruption_report_smoothed-1024"><span class="linenos">1024</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="disruption_report_smoothed-1025"><a href="#disruption_report_smoothed-1025"><span class="linenos">1025</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-1026"><a href="#disruption_report_smoothed-1026"><span class="linenos">1026</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="disruption_report_smoothed-1027"><a href="#disruption_report_smoothed-1027"><span class="linenos">1027</span></a>
</span><span id="disruption_report_smoothed-1028"><a href="#disruption_report_smoothed-1028"><span class="linenos">1028</span></a>    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="inputs">Inputs:</h6>

<blockquote>
  <ul>
  <li>smooth_window_points: window size (odd integer) for rolling mean smoothing of raw queue</li>
  </ul>
</blockquote>

<p>Outputs (returned as a formatted string):
    1) times: onset, queue_in_point, mobilisation, peak, recovery
    2) a blank line
    3) durations: onset→queue_in_point, queue_in_point→mobilisation, mobilisation→peak, peak→recovery
    4) a blank line
    5) areas: positive (above baseline), negative (below baseline)
Note: All event times are identified on RAW data, but areas are computed using SMOOTHED data.</p>
</div>


                </section>
                <section id="fog_peak_slopes">
                            <input id="fog_peak_slopes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fog_peak_slopes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">slope_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>, </span><span class="param"><span class="n">baseline_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">196</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="fog_peak_slopes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fog_peak_slopes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fog_peak_slopes-1031"><a href="#fog_peak_slopes-1031"><span class="linenos">1031</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fog_peak_slopes</span><span class="p">(</span><span class="n">slope_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">baseline_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">7</span><span class="o">*</span><span class="mi">14</span><span class="p">):</span>
</span><span id="fog_peak_slopes-1032"><a href="#fog_peak_slopes-1032"><span class="linenos">1032</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="fog_peak_slopes-1033"><a href="#fog_peak_slopes-1033"><span class="linenos">1033</span></a><span class="sd">    - Shades inbound/outbound closure windows.</span>
</span><span id="fog_peak_slopes-1034"><a href="#fog_peak_slopes-1034"><span class="linenos">1034</span></a><span class="sd">    - For each pair i, finds the raw peak within the union window [min(in_i, out_i), max(in_i, out_i)].</span>
</span><span id="fog_peak_slopes-1035"><a href="#fog_peak_slopes-1035"><span class="linenos">1035</span></a><span class="sd">    - Computes slope from peak -&gt; next `slope_steps` points: (q[t+k]-q[t])/(time[t+k]-time[t]).</span>
</span><span id="fog_peak_slopes-1036"><a href="#fog_peak_slopes-1036"><span class="linenos">1036</span></a><span class="sd">    - Produces TWO plots:</span>
</span><span id="fog_peak_slopes-1037"><a href="#fog_peak_slopes-1037"><span class="linenos">1037</span></a><span class="sd">        1) Full view: queue with inbound/outbound shaded (no slope segments).</span>
</span><span id="fog_peak_slopes-1038"><a href="#fog_peak_slopes-1038"><span class="linenos">1038</span></a><span class="sd">        2) Zoomed to [first_closure_start, last_closure_end]: queue with closures shaded AND slope segments.</span>
</span><span id="fog_peak_slopes-1039"><a href="#fog_peak_slopes-1039"><span class="linenos">1039</span></a><span class="sd">    - Prints a compact table (no CSV) with: i, peak_time, peak_queue, slope_peak_to_nextK.</span>
</span><span id="fog_peak_slopes-1040"><a href="#fog_peak_slopes-1040"><span class="linenos">1040</span></a>
</span><span id="fog_peak_slopes-1041"><a href="#fog_peak_slopes-1041"><span class="linenos">1041</span></a><span class="sd">    Uses default Matplotlib colors; markers are circles; no text annotations.</span>
</span><span id="fog_peak_slopes-1042"><a href="#fog_peak_slopes-1042"><span class="linenos">1042</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fog_peak_slopes-1043"><a href="#fog_peak_slopes-1043"><span class="linenos">1043</span></a>    <span class="c1"># ---- Load data ----</span>
</span><span id="fog_peak_slopes-1044"><a href="#fog_peak_slopes-1044"><span class="linenos">1044</span></a>    <span class="n">warmup_time</span> <span class="o">=</span> <span class="n">WARMUP_ITERS</span>
</span><span id="fog_peak_slopes-1045"><a href="#fog_peak_slopes-1045"><span class="linenos">1045</span></a>    <span class="n">inbound_closed</span> <span class="o">=</span> <span class="n">INBOUND_CLOSED</span>
</span><span id="fog_peak_slopes-1046"><a href="#fog_peak_slopes-1046"><span class="linenos">1046</span></a>    <span class="n">outbound_closed</span> <span class="o">=</span> <span class="n">OUTBOUND_CLOSED</span>
</span><span id="fog_peak_slopes-1047"><a href="#fog_peak_slopes-1047"><span class="linenos">1047</span></a>
</span><span id="fog_peak_slopes-1048"><a href="#fog_peak_slopes-1048"><span class="linenos">1048</span></a>    <span class="n">logfileid</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">NUM_MONTHS</span><span class="p">)</span><span class="si">}</span><span class="s2">_months_</span><span class="si">{</span><span class="n">NUM_RUNS</span><span class="si">}</span><span class="s2">_runs_run_</span><span class="si">{</span><span class="n">LOG_NUM</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="fog_peak_slopes-1049"><a href="#fog_peak_slopes-1049"><span class="linenos">1049</span></a>    <span class="n">df_location</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/data/all_queue.csv&#39;</span>
</span><span id="fog_peak_slopes-1050"><a href="#fog_peak_slopes-1050"><span class="linenos">1050</span></a>
</span><span id="fog_peak_slopes-1051"><a href="#fog_peak_slopes-1051"><span class="linenos">1051</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">df_location</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1052"><a href="#fog_peak_slopes-1052"><span class="linenos">1052</span></a>    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">df_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;time&quot;</span><span class="p">})</span>
</span><span id="fog_peak_slopes-1053"><a href="#fog_peak_slopes-1053"><span class="linenos">1053</span></a>    <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1054"><a href="#fog_peak_slopes-1054"><span class="linenos">1054</span></a>
</span><span id="fog_peak_slopes-1055"><a href="#fog_peak_slopes-1055"><span class="linenos">1055</span></a>
</span><span id="fog_peak_slopes-1056"><a href="#fog_peak_slopes-1056"><span class="linenos">1056</span></a>    <span class="n">time_col</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
</span><span id="fog_peak_slopes-1057"><a href="#fog_peak_slopes-1057"><span class="linenos">1057</span></a>    <span class="n">mean_col</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
</span><span id="fog_peak_slopes-1058"><a href="#fog_peak_slopes-1058"><span class="linenos">1058</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[[</span><span class="n">time_col</span><span class="p">,</span> <span class="n">mean_col</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">time_col</span><span class="p">:</span><span class="s2">&quot;time_hr&quot;</span><span class="p">,</span> <span class="n">mean_col</span><span class="p">:</span><span class="s2">&quot;q_raw&quot;</span><span class="p">})</span>
</span><span id="fog_peak_slopes-1059"><a href="#fog_peak_slopes-1059"><span class="linenos">1059</span></a>
</span><span id="fog_peak_slopes-1060"><a href="#fog_peak_slopes-1060"><span class="linenos">1060</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time_hr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1061"><a href="#fog_peak_slopes-1061"><span class="linenos">1061</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1062"><a href="#fog_peak_slopes-1062"><span class="linenos">1062</span></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1063"><a href="#fog_peak_slopes-1063"><span class="linenos">1063</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">,</span><span class="s2">&quot;q_raw&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1064"><a href="#fog_peak_slopes-1064"><span class="linenos">1064</span></a>
</span><span id="fog_peak_slopes-1065"><a href="#fog_peak_slopes-1065"><span class="linenos">1065</span></a>    <span class="c1"># Baseline from 1000 to 1500 (raw)</span>
</span><span id="fog_peak_slopes-1066"><a href="#fog_peak_slopes-1066"><span class="linenos">1066</span></a>    <span class="n">base_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">warmup_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">baseline_end</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1067"><a href="#fog_peak_slopes-1067"><span class="linenos">1067</span></a>    <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">base_mask</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="fog_peak_slopes-1068"><a href="#fog_peak_slopes-1068"><span class="linenos">1068</span></a>
</span><span id="fog_peak_slopes-1069"><a href="#fog_peak_slopes-1069"><span class="linenos">1069</span></a>    <span class="c1"># ---- Per-pair peak and slope to next K steps ----</span>
</span><span id="fog_peak_slopes-1070"><a href="#fog_peak_slopes-1070"><span class="linenos">1070</span></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="fog_peak_slopes-1071"><a href="#fog_peak_slopes-1071"><span class="linenos">1071</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inbound_closed</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">outbound_closed</span><span class="p">))</span>
</span><span id="fog_peak_slopes-1072"><a href="#fog_peak_slopes-1072"><span class="linenos">1072</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="fog_peak_slopes-1073"><a href="#fog_peak_slopes-1073"><span class="linenos">1073</span></a>        <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">inbound_closed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="fog_peak_slopes-1074"><a href="#fog_peak_slopes-1074"><span class="linenos">1074</span></a>        <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">outbound_closed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="fog_peak_slopes-1075"><a href="#fog_peak_slopes-1075"><span class="linenos">1075</span></a>        <span class="n">win_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1076"><a href="#fog_peak_slopes-1076"><span class="linenos">1076</span></a>        <span class="n">win_end</span>   <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1077"><a href="#fog_peak_slopes-1077"><span class="linenos">1077</span></a>        <span class="n">mask_win</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">win_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">win_end</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1078"><a href="#fog_peak_slopes-1078"><span class="linenos">1078</span></a>        <span class="k">if</span> <span class="n">mask_win</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1079"><a href="#fog_peak_slopes-1079"><span class="linenos">1079</span></a>            <span class="k">continue</span>
</span><span id="fog_peak_slopes-1080"><a href="#fog_peak_slopes-1080"><span class="linenos">1080</span></a>        <span class="n">idx_peak</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_win</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
</span><span id="fog_peak_slopes-1081"><a href="#fog_peak_slopes-1081"><span class="linenos">1081</span></a>        <span class="n">t_peak</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_peak</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span>
</span><span id="fog_peak_slopes-1082"><a href="#fog_peak_slopes-1082"><span class="linenos">1082</span></a>        <span class="n">q_peak</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_peak</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="fog_peak_slopes-1083"><a href="#fog_peak_slopes-1083"><span class="linenos">1083</span></a>        
</span><span id="fog_peak_slopes-1084"><a href="#fog_peak_slopes-1084"><span class="linenos">1084</span></a>        <span class="c1"># Check if the queue decreases after the peak</span>
</span><span id="fog_peak_slopes-1085"><a href="#fog_peak_slopes-1085"><span class="linenos">1085</span></a>        <span class="n">idx_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">idx_peak</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">slope_steps</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1086"><a href="#fog_peak_slopes-1086"><span class="linenos">1086</span></a>        <span class="n">t_k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_k</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">])</span>
</span><span id="fog_peak_slopes-1087"><a href="#fog_peak_slopes-1087"><span class="linenos">1087</span></a>        <span class="n">q_k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx_k</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">])</span>
</span><span id="fog_peak_slopes-1088"><a href="#fog_peak_slopes-1088"><span class="linenos">1088</span></a>        
</span><span id="fog_peak_slopes-1089"><a href="#fog_peak_slopes-1089"><span class="linenos">1089</span></a>        <span class="c1"># Only calculate and append the result if the queue decreases</span>
</span><span id="fog_peak_slopes-1090"><a href="#fog_peak_slopes-1090"><span class="linenos">1090</span></a>        <span class="k">if</span> <span class="n">q_k</span> <span class="o">&lt;=</span> <span class="n">q_peak</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1091"><a href="#fog_peak_slopes-1091"><span class="linenos">1091</span></a>            <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">q_k</span> <span class="o">-</span> <span class="n">q_peak</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">t_k</span> <span class="o">-</span> <span class="n">t_peak</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">t_k</span> <span class="o">-</span> <span class="n">t_peak</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="fog_peak_slopes-1092"><a href="#fog_peak_slopes-1092"><span class="linenos">1092</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="fog_peak_slopes-1093"><a href="#fog_peak_slopes-1093"><span class="linenos">1093</span></a>                <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
</span><span id="fog_peak_slopes-1094"><a href="#fog_peak_slopes-1094"><span class="linenos">1094</span></a>                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="n">t_peak</span><span class="p">,</span>
</span><span id="fog_peak_slopes-1095"><a href="#fog_peak_slopes-1095"><span class="linenos">1095</span></a>                <span class="s2">&quot;peak_queue&quot;</span><span class="p">:</span> <span class="n">q_peak</span><span class="p">,</span>
</span><span id="fog_peak_slopes-1096"><a href="#fog_peak_slopes-1096"><span class="linenos">1096</span></a>                <span class="s2">&quot;nextK_time&quot;</span><span class="p">:</span> <span class="n">t_k</span><span class="p">,</span>
</span><span id="fog_peak_slopes-1097"><a href="#fog_peak_slopes-1097"><span class="linenos">1097</span></a>                <span class="s2">&quot;nextK_queue&quot;</span><span class="p">:</span> <span class="n">q_k</span><span class="p">,</span>
</span><span id="fog_peak_slopes-1098"><a href="#fog_peak_slopes-1098"><span class="linenos">1098</span></a>                <span class="s2">&quot;slope_peak_to_nextK&quot;</span><span class="p">:</span> <span class="n">slope</span>
</span><span id="fog_peak_slopes-1099"><a href="#fog_peak_slopes-1099"><span class="linenos">1099</span></a>            <span class="p">})</span>
</span><span id="fog_peak_slopes-1100"><a href="#fog_peak_slopes-1100"><span class="linenos">1100</span></a>
</span><span id="fog_peak_slopes-1101"><a href="#fog_peak_slopes-1101"><span class="linenos">1101</span></a>    <span class="c1"># ---- PLOTS ----</span>
</span><span id="fog_peak_slopes-1102"><a href="#fog_peak_slopes-1102"><span class="linenos">1102</span></a>    <span class="c1"># 1) Full view: open/closed only</span>
</span><span id="fog_peak_slopes-1103"><a href="#fog_peak_slopes-1103"><span class="linenos">1103</span></a>    <span class="n">pdf_full</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/fog_report_full.pdf&#39;</span>
</span><span id="fog_peak_slopes-1104"><a href="#fog_peak_slopes-1104"><span class="linenos">1104</span></a>    <span class="n">export_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/fog_report&#39;</span>
</span><span id="fog_peak_slopes-1105"><a href="#fog_peak_slopes-1105"><span class="linenos">1105</span></a>    
</span><span id="fog_peak_slopes-1106"><a href="#fog_peak_slopes-1106"><span class="linenos">1106</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</span><span id="fog_peak_slopes-1107"><a href="#fog_peak_slopes-1107"><span class="linenos">1107</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Queue&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1108"><a href="#fog_peak_slopes-1108"><span class="linenos">1108</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1109"><a href="#fog_peak_slopes-1109"><span class="linenos">1109</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1110"><a href="#fog_peak_slopes-1110"><span class="linenos">1110</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Inbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">inbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1111"><a href="#fog_peak_slopes-1111"><span class="linenos">1111</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1112"><a href="#fog_peak_slopes-1112"><span class="linenos">1112</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Outbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">outbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1113"><a href="#fog_peak_slopes-1113"><span class="linenos">1113</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (hr)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Queue length&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1114"><a href="#fog_peak_slopes-1114"><span class="linenos">1114</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1115"><a href="#fog_peak_slopes-1115"><span class="linenos">1115</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_full</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="fog_peak_slopes-1116"><a href="#fog_peak_slopes-1116"><span class="linenos">1116</span></a>
</span><span id="fog_peak_slopes-1117"><a href="#fog_peak_slopes-1117"><span class="linenos">1117</span></a>    <span class="c1"># 2) Zoomed: show slopes too</span>
</span><span id="fog_peak_slopes-1118"><a href="#fog_peak_slopes-1118"><span class="linenos">1118</span></a>    <span class="n">pdf_zoom</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_prefix</span><span class="si">}</span><span class="s2">_zoom.pdf&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1119"><a href="#fog_peak_slopes-1119"><span class="linenos">1119</span></a>    <span class="n">fog_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">))</span>
</span><span id="fog_peak_slopes-1120"><a href="#fog_peak_slopes-1120"><span class="linenos">1120</span></a>    <span class="n">fog_end</span>   <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">))</span>
</span><span id="fog_peak_slopes-1121"><a href="#fog_peak_slopes-1121"><span class="linenos">1121</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">fog_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time_hr&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">fog_end</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1122"><a href="#fog_peak_slopes-1122"><span class="linenos">1122</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</span><span id="fog_peak_slopes-1123"><a href="#fog_peak_slopes-1123"><span class="linenos">1123</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;time_hr&quot;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;q_raw&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Queue&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1124"><a href="#fog_peak_slopes-1124"><span class="linenos">1124</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1125"><a href="#fog_peak_slopes-1125"><span class="linenos">1125</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">inbound_closed</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1126"><a href="#fog_peak_slopes-1126"><span class="linenos">1126</span></a>        <span class="k">if</span> <span class="n">e</span><span class="o">&gt;=</span><span class="n">fog_start</span> <span class="ow">and</span> <span class="n">s</span><span class="o">&lt;=</span><span class="n">fog_end</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1127"><a href="#fog_peak_slopes-1127"><span class="linenos">1127</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Inbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">inbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1128"><a href="#fog_peak_slopes-1128"><span class="linenos">1128</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="n">outbound_closed</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1129"><a href="#fog_peak_slopes-1129"><span class="linenos">1129</span></a>        <span class="k">if</span> <span class="n">e</span><span class="o">&gt;=</span><span class="n">fog_start</span> <span class="ow">and</span> <span class="n">s</span><span class="o">&lt;=</span><span class="n">fog_end</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1130"><a href="#fog_peak_slopes-1130"><span class="linenos">1130</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Outbound closed&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="n">outbound_closed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1131"><a href="#fog_peak_slopes-1131"><span class="linenos">1131</span></a>    <span class="c1"># circle markers + slope segments</span>
</span><span id="fog_peak_slopes-1132"><a href="#fog_peak_slopes-1132"><span class="linenos">1132</span></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1133"><a href="#fog_peak_slopes-1133"><span class="linenos">1133</span></a>        <span class="k">if</span> <span class="n">fog_start</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">fog_end</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1134"><a href="#fog_peak_slopes-1134"><span class="linenos">1134</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_queue&quot;</span><span class="p">]],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1135"><a href="#fog_peak_slopes-1135"><span class="linenos">1135</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;nextK_time&quot;</span><span class="p">]],</span>
</span><span id="fog_peak_slopes-1136"><a href="#fog_peak_slopes-1136"><span class="linenos">1136</span></a>                     <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;peak_queue&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;nextK_queue&quot;</span><span class="p">]],</span>
</span><span id="fog_peak_slopes-1137"><a href="#fog_peak_slopes-1137"><span class="linenos">1137</span></a>                     <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1138"><a href="#fog_peak_slopes-1138"><span class="linenos">1138</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (hr)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Queue length&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1139"><a href="#fog_peak_slopes-1139"><span class="linenos">1139</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
</span><span id="fog_peak_slopes-1140"><a href="#fog_peak_slopes-1140"><span class="linenos">1140</span></a>        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>           <span class="c1"># anchor relative to top center</span>
</span><span id="fog_peak_slopes-1141"><a href="#fog_peak_slopes-1141"><span class="linenos">1141</span></a>        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span>  <span class="c1"># shift it below the axes</span>
</span><span id="fog_peak_slopes-1142"><a href="#fog_peak_slopes-1142"><span class="linenos">1142</span></a>        <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
</span><span id="fog_peak_slopes-1143"><a href="#fog_peak_slopes-1143"><span class="linenos">1143</span></a>        <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span>                        <span class="c1"># optional: spread entries into multiple columns</span>
</span><span id="fog_peak_slopes-1144"><a href="#fog_peak_slopes-1144"><span class="linenos">1144</span></a>    <span class="p">)</span>
</span><span id="fog_peak_slopes-1145"><a href="#fog_peak_slopes-1145"><span class="linenos">1145</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1146"><a href="#fog_peak_slopes-1146"><span class="linenos">1146</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_zoom</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="fog_peak_slopes-1147"><a href="#fog_peak_slopes-1147"><span class="linenos">1147</span></a>
</span><span id="fog_peak_slopes-1148"><a href="#fog_peak_slopes-1148"><span class="linenos">1148</span></a>    <span class="c1"># ---- PRINT TABLE ----</span>
</span><span id="fog_peak_slopes-1149"><a href="#fog_peak_slopes-1149"><span class="linenos">1149</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;i, peak_time, peak_queue, slope_peak_to_nextK&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1150"><a href="#fog_peak_slopes-1150"><span class="linenos">1150</span></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1151"><a href="#fog_peak_slopes-1151"><span class="linenos">1151</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_queue&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;slope_peak_to_nextK&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1152"><a href="#fog_peak_slopes-1152"><span class="linenos">1152</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Average slope is&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;slope_peak_to_nextK&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]))</span>
</span><span id="fog_peak_slopes-1153"><a href="#fog_peak_slopes-1153"><span class="linenos">1153</span></a>
</span><span id="fog_peak_slopes-1154"><a href="#fog_peak_slopes-1154"><span class="linenos">1154</span></a>    <span class="c1"># save results as a text file</span>
</span><span id="fog_peak_slopes-1155"><a href="#fog_peak_slopes-1155"><span class="linenos">1155</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;collatedResults/</span><span class="si">{</span><span class="n">logfileid</span><span class="si">}</span><span class="s1">/fog_report.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1156"><a href="#fog_peak_slopes-1156"><span class="linenos">1156</span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;i, peak_time, peak_queue, slope_peak_to_nextK</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1157"><a href="#fog_peak_slopes-1157"><span class="linenos">1157</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="fog_peak_slopes-1158"><a href="#fog_peak_slopes-1158"><span class="linenos">1158</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;peak_queue&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;slope_peak_to_nextK&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="fog_peak_slopes-1159"><a href="#fog_peak_slopes-1159"><span class="linenos">1159</span></a>            
</span><span id="fog_peak_slopes-1160"><a href="#fog_peak_slopes-1160"><span class="linenos">1160</span></a>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_full</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdf_zoom</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><ul>
<li>Shades inbound/outbound closure windows.</li>
<li>For each pair i, finds the raw peak within the union window [min(in_i, out_i), max(in_i, out_i)].</li>
<li>Computes slope from peak -> next <code>slope_steps</code> points: (q[t+k]-q[t])/(time[t+k]-time[t]).</li>
<li>Produces TWO plots:
1) Full view: queue with inbound/outbound shaded (no slope segments).
2) Zoomed to [first_closure_start, last_closure_end]: queue with closures shaded AND slope segments.</li>
<li>Prints a compact table (no CSV) with: i, peak_time, peak_queue, slope_peak_to_nextK.</li>
</ul>

<p>Uses default Matplotlib colors; markers are circles; no text annotations.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>